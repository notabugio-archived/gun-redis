!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("ramda"),require("redis"),require("flat")):"function"==typeof define&&define.amd?define("@notabug/gun-redis",["ramda","redis","flat"],t):"object"==typeof exports?exports["@notabug/gun-redis"]=t(require("ramda"),require("redis"),require("flat")):e["@notabug/gun-redis"]=t(e.ramda,e.redis,e.flat)}("undefined"!=typeof self?self:this,function(e,t,r){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(t,r){t.exports=e},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createClient=void 0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(0)),o=r(4),i=r(5);var u=/^_\..*/,c=/(\.#$)/;t.createClient=function(e){for(var t=[],r=arguments.length,f=new Array(r>1?r-1:0),a=1;a<r;a++)f[a-1]=arguments[a];var l=o.createClient.apply(void 0,f),s=function(e){return new Promise(function(t,r){if(!e)return t(null);l.hgetall(e,function(e,n){e?(console.error("get error",e),r(e)):t((0,i.fromRedis)(n))})})};return{get:s,read:function(t){return s(t).then(function(r){var o=r?{...r}:r;return e.SEA&&-1!==t.indexOf("~")?(n.without(["_"],n.keys(o)).forEach(function(n){e.SEA.verify(e.SEA.opt.pack(r[n],n,r,t),!1,function(t){return o[n]=e.SEA.opt.unpack(t,n,r)})}),o):r})},batchedGet:function(e,t){return new Promise(function(r,n){l.hkeys(e,function(o,f){if(o)return console.error("error",o.stack||o),n(o);if(f.length<=1e4)return s(e).then(function(e){t(e),r(e)});console.log("get big soul",e,f.length);var a=f.filter(function(e){return!e.match(u)}),p=function(){return new Promise(function(r,n){var o=a.splice(0,1e4);return o.length?function(e,t){return new Promise(function(r,n){var o=t.map(function(e){return"_.>.".concat(e).replace(c,"")});return l.hmget(e,o,function(u,c){if(u)return console.error("hmget err",u.stack||u)||n(u);var f={"_.#":e};return c.forEach(function(e,t){return f[o[t]]=e}),l.hmget(e,t,function(e,o){return e?console.error("hmget err",e.stack||e)||n(e):(o.forEach(function(e,r){return f[t[r]]=e}),r((0,i.fromRedis)(f)))})})})}(e,o).then(function(e){return t(e),r()},n):r(!0)})};return function e(){return p().then(function(t){return!t&&e})}().then(function(e){r(e)}).catch(n)})})},write:function(e){return Promise.all(n.keys(e).map(function(r){return new Promise(function(o,u){var c=e[r],f=n.path(["_",">"],c)||{},a=n.keys(f);return function e(){var p=a.splice(0,1e4);if(!p.length)return o();var d={_:{"#":r,">":n.pick(p,f)},...n.pick(p,c)};return s(r).then(function(o){var c=p.filter(function(e){var t=n.prop(e,d),r=n.prop(e,o);if(!(e in d))return!1;if(t===r)return!1;var i=n.path([e,"#"],d),u=n.path([e,"#"],o);return!((i||u)&&i===u||"number"==typeof t&&parseFloat(r)===t)});if(!c.length)return e();var a={_:n.assoc(">",n.pick(c,f),d._),...n.pick(c,d)};return l.hmset(r,(0,i.toRedis)(a),function(n){n?u(n):e(),function(e,r,n){t.map(function(t){return t(e,r,n)})}(r,a,o)})})}()})}))},onChange:function(e){return t.push(e)},offChange:function(e){return t=n.without([e],t)},redis:l}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"attachToGun",{enumerable:!0,get:function(){return o.attachToGun}}),Object.defineProperty(t,"createClient",{enumerable:!0,get:function(){return i.createClient}}),t.receiver=void 0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(3)),o=r(7),i=r(1);var u=n;t.receiver=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.acceptWrites=t.respondToGets=void 0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(0)),o=r(1);t.respondToGets=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.disableRelay,i=void 0===r||r,u=t.skipValidation,c=void 0===u||u;return function(t){var r=e.redis=e.redis||(0,o.createClient)(e);return t.onIn(function(e){var t=e.from,o=e.json,u=e.fromCluster,f=n.path(["get","#"],o),a=n.prop("#",o);return!f||u?e:r.batchedGet(f,function(e){var r,n,o,i={"#":t.msgId(),"@":a,put:e?(r={},n=f,o=e,n in r?Object.defineProperty(r,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[n]=o,r):null};t.send({json:i,ignoreLeeching:!0,skipValidation:!e||c})}).then(function(){return i?n.assoc("noRelay",!0,e):e}).catch(function(r){var n={"#":t.msgId(),"@":a,err:"".concat(r)};return t.send({json:n,ignoreLeeching:!0,skipValidation:c}),e})}),t}};t.acceptWrites=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).disableRelay,r=void 0!==t&&t;return function(t){var i=e.redis=e.redis||(0,o.createClient)(e);return t.onIn(function(e){return e.fromCluster?e:e.json.put?t.getDiff(e.json.put).then(function(t){return n.keys(t).length?i.write(t).then(function(){var t={"@":e.json["#"],ok:!0,err:null};return e.from&&e.from.send&&e.from.send({json:t,noRelay:!0,ignoreLeeching:!0,skipValidation:!0}),r?n.assoc("noRelay",!0,e):e}).catch(function(t){var n={"@":e.json["#"],ok:!1,err:"".concat(t)};return e.from&&e.from.send&&e.from.send({json:n,noRelay:r,ignoreLeeching:!0,skipValidation:!0}),e}):e}).catch(function(e){return console.error("error accepting writes",e.stack||e)}):e}),t}}},function(e,r){e.exports=t},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fromRedis=function(e){if(!e)return e;var t={};return(0,n.keys)(e).forEach(function(t){"."===t[0]&&delete e[t],"|NULL|"===e[t]&&(e[t]=null),"|UNDEFINED|"===e[t]&&(e[t]=void 0),/>\./.test(t)&&(e[t]=parseFloat(e[t],10)||e[t]),e[t]&&e[t].length>u&&(e[t]=e[t].slice(0,u),console.log("truncated",t))}),e=c(i.unflatten(e,{object:!0})),Object.keys(e).sort().forEach(function(r){return t[r]=e[r]}),t},t.toRedis=function(e){return e?(e=i(c(e)),(0,n.keys)(e).forEach(function(t){null===e[t]&&(e[t]="|NULL|"),void 0===o(e[t])&&(e[t]="|UNDEFINED|"),e[t]&&e[t].length>u&&(e[t]=e[t].slice(0,u),console.log("truncated input",t)),"."===t[0]&&delete e[t]}),e):e};var n=r(0);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=r(6),u=1e5;function c(e){if(!e)return e;var t=e._&&e._[">"]||{};return(0,n.keys)(t).forEach(function(r){if(r in e){var i=t[r];if("object"===o(i)){var u=(0,n.keys)(i),c=u[0];if(c){var f=[r,u].join("."),a=i[c];delete t[r],t[f]=a,a=e[r]&&e[r][c]||null,delete e[r],e[f]=a}}}else delete t[r]}),(0,n.keys)(e).forEach(function(r){r[0],"_"!==r&&(r in t||delete e[r])}),e}},function(e,t){e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.attachToGun=void 0;var n=r(1);t.attachToGun=function(e){return e.on("create",function(t){this.to.next(t);var r=e.redis=t.redis=(0,n.createClient)(e);t.on("get",function(e){this.to.next(e);var n=e["#"],o=e.get["#"];r.batchedGet(o,function(e){return t.on("in",{"@":n,put:e?(r={},i=o,u=e,i in r?Object.defineProperty(r,i,{value:u,enumerable:!0,configurable:!0,writable:!0}):r[i]=u,r):null,err:null});var r,i,u}).catch(function(e){return console.error("error",e.stack||e)||t.on("in",{"@":n,put:null,err:e})})}),t.on("put",function(e){this.to.next(e);var n=e["#"];r.write(e.put).then(function(){return t.on("in",{"@":n,ok:!0,err:null})}).catch(function(e){return t.on("in",{"@":n,ok:!1,err:e})})})})}}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Abm90YWJ1Zy9ndW4tcmVkaXMvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL0Bub3RhYnVnL2d1bi1yZWRpcy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9Abm90YWJ1Zy9ndW4tcmVkaXMvZXh0ZXJuYWwgXCJyYW1kYVwiIiwid2VicGFjazovL0Bub3RhYnVnL2d1bi1yZWRpcy8uL3NyYy9jbGllbnQuanMiLCJ3ZWJwYWNrOi8vQG5vdGFidWcvZ3VuLXJlZGlzLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL0Bub3RhYnVnL2d1bi1yZWRpcy8uL3NyYy9yZWNlaXZlci5qcyIsIndlYnBhY2s6Ly9Abm90YWJ1Zy9ndW4tcmVkaXMvZXh0ZXJuYWwgXCJyZWRpc1wiIiwid2VicGFjazovL0Bub3RhYnVnL2d1bi1yZWRpcy8uL3NyYy9zZXJpYWxpemUuanMiLCJ3ZWJwYWNrOi8vQG5vdGFidWcvZ3VuLXJlZGlzL2V4dGVybmFsIFwiZmxhdFwiIiwid2VicGFjazovL0Bub3RhYnVnL2d1bi1yZWRpcy8uL3NyYy9ndW4uanMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwicmVxdWlyZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJ0aGlzIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMF9fIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fNF9fIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fNl9fIiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIlIiLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsIl9yZWRpcyIsIl9zZXJpYWxpemUiLCJtZXRhUmUiLCJlZGdlUmUiLCJHdW4iLCJjaGFuZ2VTdWJzY3JpYmVycyIsIl9sZW4iLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJjb25maWciLCJBcnJheSIsIl9rZXkiLCJyZWRpcyIsImNyZWF0ZUNsaWVudCIsImFwcGx5Iiwic291bCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiaGdldGFsbCIsImVyciIsInJlcyIsImNvbnNvbGUiLCJlcnJvciIsImZyb21SZWRpcyIsInJlYWQiLCJ0aGVuIiwicmF3RGF0YSIsImRhdGEiLCJTRUEiLCJpbmRleE9mIiwid2l0aG91dCIsImtleXMiLCJmb3JFYWNoIiwidmVyaWZ5Iiwib3B0IiwicGFjayIsInVucGFjayIsImJhdGNoZWRHZXQiLCJjYiIsImhrZXlzIiwibm9kZUtleXMiLCJzdGFjayIsImxvZyIsImF0dHJLZXlzIiwiZmlsdGVyIiwibWF0Y2giLCJyZWFkQmF0Y2giLCJvayIsImZhaWwiLCJiYXRjaCIsInNwbGljZSIsImJhdGNoTWV0YSIsIm1hcCIsImNvbmNhdCIsInJlcGxhY2UiLCJobWdldCIsIm1ldGEiLCJvYmoiLCJfLiMiLCJ2YWwiLCJpZHgiLCJyZWFkS2V5QmF0Y2giLCJyZXN1bHQiLCJyZWFkTmV4dEJhdGNoIiwiZG9uZSIsImNhdGNoIiwid3JpdGUiLCJwdXQiLCJhbGwiLCJub2RlIiwicGF0aCIsIndyaXRlTmV4dEJhdGNoIiwidXBkYXRlZCIsIl8iLCIjIiwiPiIsInBpY2siLCJleGlzdGluZyIsIm1vZGlmaWVkS2V5cyIsInVwZGF0ZWRWYWwiLCJwcm9wIiwiZXhpc3RpbmdWYWwiLCJ1cGRhdGVkU291bCIsImV4aXN0aW5nU291bCIsInBhcnNlRmxvYXQiLCJkaWZmIiwiYXNzb2MiLCJobXNldCIsInRvUmVkaXMiLCJvcmlnaW5hbCIsImZuIiwibm90aWZ5Q2hhbmdlU3Vic2NyaWJlcnMiLCJvbkNoYW5nZSIsInB1c2giLCJvZmZDaGFuZ2UiLCJyZWNlaXZlckZucyIsIl9ndW4iLCJfY2xpZW50IiwicmVjZWl2ZXIiLCJfcmVmIiwidW5kZWZpbmVkIiwiX3JlZiRkaXNhYmxlUmVsYXkiLCJkaXNhYmxlUmVsYXkiLCJfcmVmJHNraXBWYWxpZGF0aW9uIiwic2tpcFZhbGlkYXRpb24iLCJkYiIsIm9uSW4iLCJtc2ciLCJmcm9tIiwianNvbiIsImZyb21DbHVzdGVyIiwiZGVkdXBJZCIsIm1zZ0lkIiwiQCIsInNlbmQiLCJpZ25vcmVMZWVjaGluZyIsIl9yZWYzJGRpc2FibGVSZWxheSIsImdldERpZmYiLCJub1JlbGF5Iiwic29ydGVkIiwiX3JhbWRhIiwidGVzdCIsIkZJRUxEX1NJWkVfTElNSVQiLCJzbGljZSIsInBvc3RVbmZsYXR0ZW4iLCJmbGF0dGVuIiwidW5mbGF0dGVuIiwic29ydCIsIl90eXBlb2YiLCJhcnJvdyIsInZhbEtleXMiLCJyZW1haW5kZXIiLCJyZWFsS2V5Iiwiam9pbiIsInJlYWxWYWx1ZSIsIm9uIiwidG8iLCJuZXh0IiwicmVxdWVzdCJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsR0FDQSxpQkFBQUMsU0FBQSxpQkFBQUMsT0FDQUEsT0FBQUQsUUFBQUQsRUFBQUcsUUFBQSxTQUFBQSxRQUFBLFNBQUFBLFFBQUEsU0FDQSxtQkFBQUMsZUFBQUMsSUFDQUQsT0FBQSw4Q0FBQUosR0FDQSxpQkFBQUMsUUFDQUEsUUFBQSxzQkFBQUQsRUFBQUcsUUFBQSxTQUFBQSxRQUFBLFNBQUFBLFFBQUEsU0FFQUosRUFBQSxzQkFBQUMsRUFBQUQsRUFBQSxNQUFBQSxFQUFBLE1BQUFBLEVBQUEsTUFSQSxDQVNDLG9CQUFBTyxVQUFBQyxLQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEdBQ0QsbUJDVEEsSUFBQUMsRUFB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S2tMLEdBQUdDLEtBQUtDLEdBQ2IsSUFBTTNCLEVBQVUyQixFQUFRLEtBRWxCNUgsRUFETTRILEVBQVFoSyxJQUNILEtBRWpCaUMsRUFBTTBCLFdBQVd2QixFQUFNLFNBQUFnRCxHQUFNLE9BQUkyQyxFQUFHOEIsR0FBRyxLQUFNLENBQzNDdEIsSUFBS0YsRUFDTDVDLElBQUtMLEtBQU0sS0FBTWhELElBQU9nRCxrR0FBVyxLQUNuQzNDLElBQUssbUJBQ0g4QyxNQUFNLFNBQUE5QyxHQUFHLE9BQ1hFLFFBQVFDLE1BQU0sUUFBU0gsRUFBSXNCLE9BQVN0QixJQUNwQ3NGLEVBQUc4QixHQUFHLEtBQU0sQ0FDVnRCLElBQUtGLEVBQ0w1QyxJQUFLLEtBQ0xoRCxZQUtOc0YsRUFBRzhCLEdBQUcsTUFBTyxTQUFTRyxHQUNwQnBMLEtBQUtrTCxHQUFHQyxLQUFLQyxHQUNiLElBQU0zQixFQUFVMkIsRUFBUSxLQUV4Qi9ILEVBQU11RCxNQUFNd0UsRUFBUXZFLEtBQ2pCMUMsS0FBSyxrQkFDSmdGLEVBQUc4QixHQUFHLEtBQU0sQ0FDVnRCLElBQUtGLEVBQ0xoRSxJQUFJLEVBQ0o1QixJQUFLLFNBR1I4QyxNQUFNLFNBQUE5QyxHQUFHLE9BQ1JzRixFQUFHOEIsR0FBRyxLQUFNLENBQ1Z0QixJQUFLRixFQUNMaEUsSUFBSSxFQUNKNUIsSUFBS0EiLCJmaWxlIjoiQG5vdGFidWcvZ3VuLXJlZGlzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZShcInJhbWRhXCIpLCByZXF1aXJlKFwicmVkaXNcIiksIHJlcXVpcmUoXCJmbGF0XCIpKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFwiQG5vdGFidWcvZ3VuLXJlZGlzXCIsIFtcInJhbWRhXCIsIFwicmVkaXNcIiwgXCJmbGF0XCJdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcIkBub3RhYnVnL2d1bi1yZWRpc1wiXSA9IGZhY3RvcnkocmVxdWlyZShcInJhbWRhXCIpLCByZXF1aXJlKFwicmVkaXNcIiksIHJlcXVpcmUoXCJmbGF0XCIpKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJAbm90YWJ1Zy9ndW4tcmVkaXNcIl0gPSBmYWN0b3J5KHJvb3RbXCJyYW1kYVwiXSwgcm9vdFtcInJlZGlzXCJdLCByb290W1wiZmxhdFwiXSk7XG59KSh0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0aGlzLCBmdW5jdGlvbihfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX18wX18sIF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzRfXywgX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fNl9fKSB7XG5yZXR1cm4gIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDIpO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX18wX187IiwiaW1wb3J0ICogYXMgUiBmcm9tIFwicmFtZGFcIjtcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCBhcyBjcmVhdGVSZWRpc0NsaWVudCB9IGZyb20gXCJyZWRpc1wiO1xuaW1wb3J0IHsgdG9SZWRpcywgZnJvbVJlZGlzIH0gZnJvbSBcIi4vc2VyaWFsaXplXCI7XG5cbmNvbnN0IEdFVF9CQVRDSF9TSVpFID0gMTAwMDA7XG5jb25zdCBQVVRfQkFUQ0hfU0laRSA9IDEwMDAwO1xuXG5jb25zdCBtZXRhUmUgPSAvXl9cXC4uKi87XG5jb25zdCBlZGdlUmUgPSAvKFxcLiMkKS87XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVDbGllbnQgPSAoR3VuLCAuLi5jb25maWcpID0+IHtcbiAgbGV0IGNoYW5nZVN1YnNjcmliZXJzID0gW107XG4gIGNvbnN0IHJlZGlzID0gY3JlYXRlUmVkaXNDbGllbnQoLi4uY29uZmlnKTtcbiAgY29uc3Qgbm90aWZ5Q2hhbmdlU3Vic2NyaWJlcnMgPSAoc291bCwgZGlmZiwgb3JpZ2luYWwpID0+XG4gICAgY2hhbmdlU3Vic2NyaWJlcnMubWFwKGZuID0+IGZuKHNvdWwsIGRpZmYsIG9yaWdpbmFsKSk7XG4gIGNvbnN0IG9uQ2hhbmdlID0gZm4gPT4gY2hhbmdlU3Vic2NyaWJlcnMucHVzaChmbik7XG4gIGNvbnN0IG9mZkNoYW5nZSA9IGZuID0+XG4gICAgKGNoYW5nZVN1YnNjcmliZXJzID0gUi53aXRob3V0KFtmbl0sIGNoYW5nZVN1YnNjcmliZXJzKSk7XG5cbiAgY29uc3QgZ2V0ID0gc291bCA9PlxuICAgIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGlmICghc291bCkgcmV0dXJuIHJlc29sdmUobnVsbCk7XG4gICAgICByZWRpcy5oZ2V0YWxsKHNvdWwsIGZ1bmN0aW9uKGVyciwgcmVzKSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiZ2V0IGVycm9yXCIsIGVycik7XG4gICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzb2x2ZShmcm9tUmVkaXMocmVzKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9KTtcblxuICBjb25zdCByZWFkID0gc291bCA9PlxuICAgIGdldChzb3VsKS50aGVuKHJhd0RhdGEgPT4ge1xuICAgICAgY29uc3QgZGF0YSA9IHJhd0RhdGEgPyB7IC4uLnJhd0RhdGEgfSA6IHJhd0RhdGE7XG5cbiAgICAgIGlmICghR3VuLlNFQSB8fCBzb3VsLmluZGV4T2YoXCJ+XCIpID09PSAtMSkgcmV0dXJuIHJhd0RhdGE7XG4gICAgICBSLndpdGhvdXQoW1wiX1wiXSwgUi5rZXlzKGRhdGEpKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgIEd1bi5TRUEudmVyaWZ5KFxuICAgICAgICAgIEd1bi5TRUEub3B0LnBhY2socmF3RGF0YVtrZXldLCBrZXksIHJhd0RhdGEsIHNvdWwpLFxuICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgIHJlcyA9PiAoZGF0YVtrZXldID0gR3VuLlNFQS5vcHQudW5wYWNrKHJlcywga2V5LCByYXdEYXRhKSlcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSk7XG5cbiAgY29uc3QgcmVhZEtleUJhdGNoID0gKHNvdWwsIGJhdGNoKSA9PlxuICAgIG5ldyBQcm9taXNlKChvaywgZmFpbCkgPT4ge1xuICAgICAgY29uc3QgYmF0Y2hNZXRhID0gYmF0Y2gubWFwKGtleSA9PiBgXy4+LiR7a2V5fWAucmVwbGFjZShlZGdlUmUsIFwiXCIpKTtcblxuICAgICAgcmV0dXJuIHJlZGlzLmhtZ2V0KHNvdWwsIGJhdGNoTWV0YSwgKGVyciwgbWV0YSkgPT4ge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoXCJobWdldCBlcnJcIiwgZXJyLnN0YWNrIHx8IGVycikgfHwgZmFpbChlcnIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG9iaiA9IHtcbiAgICAgICAgICBcIl8uI1wiOiBzb3VsXG4gICAgICAgIH07XG5cbiAgICAgICAgbWV0YS5mb3JFYWNoKCh2YWwsIGlkeCkgPT4gKG9ialtiYXRjaE1ldGFbaWR4XV0gPSB2YWwpKTtcbiAgICAgICAgcmV0dXJuIHJlZGlzLmhtZ2V0KHNvdWwsIGJhdGNoLCAoZXJyLCByZXMpID0+IHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS5lcnJvcihcImhtZ2V0IGVyclwiLCBlcnIuc3RhY2sgfHwgZXJyKSB8fCBmYWlsKGVycik7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlcy5mb3JFYWNoKCh2YWwsIGlkeCkgPT4gKG9ialtiYXRjaFtpZHhdXSA9IHZhbCkpO1xuICAgICAgICAgIHJldHVybiBvayhmcm9tUmVkaXMob2JqKSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgY29uc3QgYmF0Y2hlZEdldCA9IChzb3VsLCBjYikgPT5cbiAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICByZWRpcy5oa2V5cyhzb3VsLCAoZXJyLCBub2RlS2V5cykgPT4ge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcImVycm9yXCIsIGVyci5zdGFjayB8fCBlcnIpO1xuICAgICAgICAgIHJldHVybiByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm9kZUtleXMubGVuZ3RoIDw9IEdFVF9CQVRDSF9TSVpFKSB7XG4gICAgICAgICAgcmV0dXJuIGdldChzb3VsKS50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgICBjYihyZXMpO1xuICAgICAgICAgICAgcmVzb2x2ZShyZXMpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKFwiZ2V0IGJpZyBzb3VsXCIsIHNvdWwsIG5vZGVLZXlzLmxlbmd0aCk7XG4gICAgICAgIGNvbnN0IGF0dHJLZXlzID0gbm9kZUtleXMuZmlsdGVyKGtleSA9PiAha2V5Lm1hdGNoKG1ldGFSZSkpO1xuICAgICAgICBjb25zdCByZWFkQmF0Y2ggPSAoKSA9PlxuICAgICAgICAgIG5ldyBQcm9taXNlKChvaywgZmFpbCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYmF0Y2ggPSBhdHRyS2V5cy5zcGxpY2UoMCwgR0VUX0JBVENIX1NJWkUpO1xuXG4gICAgICAgICAgICBpZiAoIWJhdGNoLmxlbmd0aCkgcmV0dXJuIG9rKHRydWUpO1xuXG4gICAgICAgICAgICByZXR1cm4gcmVhZEtleUJhdGNoKHNvdWwsIGJhdGNoKS50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgIGNiKHJlc3VsdCk7XG4gICAgICAgICAgICAgIHJldHVybiBvaygpO1xuICAgICAgICAgICAgfSwgZmFpbCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHJlYWROZXh0QmF0Y2ggPSAoKSA9PlxuICAgICAgICAgIHJlYWRCYXRjaCgpLnRoZW4oZG9uZSA9PiAhZG9uZSAmJiByZWFkTmV4dEJhdGNoKTtcblxuICAgICAgICByZXR1cm4gcmVhZE5leHRCYXRjaCgpXG4gICAgICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgICAgIHJlc29sdmUocmVzKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaChyZWplY3QpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgY29uc3Qgd3JpdGUgPSBwdXQgPT5cbiAgICBQcm9taXNlLmFsbChcbiAgICAgIFIua2V5cyhwdXQpLm1hcChcbiAgICAgICAgc291bCA9PlxuICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBwdXRbc291bF07XG4gICAgICAgICAgICBjb25zdCBtZXRhID0gUi5wYXRoKFtcIl9cIiwgXCI+XCJdLCBub2RlKSB8fCB7fTtcbiAgICAgICAgICAgIGNvbnN0IG5vZGVLZXlzID0gUi5rZXlzKG1ldGEpO1xuICAgICAgICAgICAgY29uc3Qgd3JpdGVOZXh0QmF0Y2ggPSAoKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IGJhdGNoID0gbm9kZUtleXMuc3BsaWNlKDAsIFBVVF9CQVRDSF9TSVpFKTtcblxuICAgICAgICAgICAgICBpZiAoIWJhdGNoLmxlbmd0aCkgcmV0dXJuIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZCA9IHtcbiAgICAgICAgICAgICAgICBfOiB7XG4gICAgICAgICAgICAgICAgICBcIiNcIjogc291bCxcbiAgICAgICAgICAgICAgICAgIFwiPlwiOiBSLnBpY2soYmF0Y2gsIG1ldGEpXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAuLi5SLnBpY2soYmF0Y2gsIG5vZGUpXG4gICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgLy8gcmV0dXJuIHJlYWRLZXlCYXRjaChzb3VsLCBiYXRjaCkudGhlbihleGlzdGluZyA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiBnZXQoc291bCkudGhlbihleGlzdGluZyA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbW9kaWZpZWRLZXlzID0gYmF0Y2guZmlsdGVyKGtleSA9PiB7XG4gICAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVkVmFsID0gUi5wcm9wKGtleSwgdXBkYXRlZCk7XG4gICAgICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ1ZhbCA9IFIucHJvcChrZXksIGV4aXN0aW5nKTtcblxuICAgICAgICAgICAgICAgICAgaWYgKCEoa2V5IGluIHVwZGF0ZWQpKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICBpZiAodXBkYXRlZFZhbCA9PT0gZXhpc3RpbmdWYWwpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRTb3VsID0gUi5wYXRoKFtrZXksIFwiI1wiXSwgdXBkYXRlZCk7XG4gICAgICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ1NvdWwgPSBSLnBhdGgoW2tleSwgXCIjXCJdLCBleGlzdGluZyk7XG5cbiAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgKHVwZGF0ZWRTb3VsIHx8IGV4aXN0aW5nU291bCkgJiZcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlZFNvdWwgPT09IGV4aXN0aW5nU291bFxuICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgdHlwZW9mIHVwZGF0ZWRWYWwgPT09IFwibnVtYmVyXCIgJiZcbiAgICAgICAgICAgICAgICAgICAgcGFyc2VGbG9hdChleGlzdGluZ1ZhbCkgPT09IHVwZGF0ZWRWYWxcbiAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFtb2RpZmllZEtleXMubGVuZ3RoKSByZXR1cm4gd3JpdGVOZXh0QmF0Y2goKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGRpZmYgPSB7XG4gICAgICAgICAgICAgICAgICBfOiBSLmFzc29jKFwiPlwiLCBSLnBpY2sobW9kaWZpZWRLZXlzLCBtZXRhKSwgdXBkYXRlZC5fKSxcbiAgICAgICAgICAgICAgICAgIC4uLlIucGljayhtb2RpZmllZEtleXMsIHVwZGF0ZWQpXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHJldHVybiByZWRpcy5obXNldChzb3VsLCB0b1JlZGlzKGRpZmYpLCBlcnIgPT4ge1xuICAgICAgICAgICAgICAgICAgZXJyID8gcmVqZWN0KGVycikgOiB3cml0ZU5leHRCYXRjaCgpO1xuICAgICAgICAgICAgICAgICAgbm90aWZ5Q2hhbmdlU3Vic2NyaWJlcnMoc291bCwgZGlmZiwgZXhpc3RpbmcpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJldHVybiB3cml0ZU5leHRCYXRjaCgpO1xuICAgICAgICAgIH0pXG4gICAgICApXG4gICAgKTtcblxuICAvLyBvbkNoYW5nZSgoc291bCwgZGlmZikgPT4gY29uc29sZS5sb2coXCJtb2RpZnlcIiwgc291bCwgUi5rZXlzKGRpZmYpKSk7XG5cbiAgcmV0dXJuIHsgZ2V0LCByZWFkLCBiYXRjaGVkR2V0LCB3cml0ZSwgb25DaGFuZ2UsIG9mZkNoYW5nZSwgcmVkaXMgfTtcbn07XG4iLCJpbXBvcnQgKiBhcyByZWNlaXZlckZucyBmcm9tIFwiLi9yZWNlaXZlclwiO1xuZXhwb3J0IHsgYXR0YWNoVG9HdW4gfSBmcm9tIFwiLi9ndW5cIjtcbmV4cG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCIuL2NsaWVudFwiO1xuXG5leHBvcnQgY29uc3QgcmVjZWl2ZXIgPSByZWNlaXZlckZucztcbiIsImltcG9ydCAqIGFzIFIgZnJvbSBcInJhbWRhXCI7XG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tIFwiLi9jbGllbnRcIjtcblxuZXhwb3J0IGNvbnN0IHJlc3BvbmRUb0dldHMgPSAoXG4gIEd1bixcbiAgeyBkaXNhYmxlUmVsYXkgPSB0cnVlLCBza2lwVmFsaWRhdGlvbiA9IHRydWUgfSA9IHt9XG4pID0+IGRiID0+IHtcbiAgY29uc3QgcmVkaXMgPSAoR3VuLnJlZGlzID0gR3VuLnJlZGlzIHx8IGNyZWF0ZUNsaWVudChHdW4pKTtcblxuICBkYi5vbkluKG1zZyA9PiB7XG4gICAgY29uc3QgeyBmcm9tLCBqc29uLCBmcm9tQ2x1c3RlciB9ID0gbXNnO1xuICAgIGNvbnN0IHNvdWwgPSBSLnBhdGgoW1wiZ2V0XCIsIFwiI1wiXSwganNvbik7XG4gICAgY29uc3QgZGVkdXBJZCA9IFIucHJvcChcIiNcIiwganNvbik7XG5cbiAgICBpZiAoIXNvdWwgfHwgZnJvbUNsdXN0ZXIpIHJldHVybiBtc2c7XG4gICAgcmV0dXJuIHJlZGlzXG4gICAgICAuYmF0Y2hlZEdldChzb3VsLCByZXN1bHQgPT4ge1xuICAgICAgICBjb25zdCBqc29uID0ge1xuICAgICAgICAgIFwiI1wiOiBmcm9tLm1zZ0lkKCksXG4gICAgICAgICAgXCJAXCI6IGRlZHVwSWQsXG4gICAgICAgICAgcHV0OiByZXN1bHQgPyB7IFtzb3VsXTogcmVzdWx0IH0gOiBudWxsXG4gICAgICAgIH07XG5cbiAgICAgICAgZnJvbS5zZW5kKHtcbiAgICAgICAgICBqc29uLFxuICAgICAgICAgIGlnbm9yZUxlZWNoaW5nOiB0cnVlLFxuICAgICAgICAgIHNraXBWYWxpZGF0aW9uOiAhcmVzdWx0IHx8IHNraXBWYWxpZGF0aW9uXG4gICAgICAgIH0pO1xuICAgICAgfSlcbiAgICAgIC50aGVuKCgpID0+IChkaXNhYmxlUmVsYXkgPyBSLmFzc29jKFwibm9SZWxheVwiLCB0cnVlLCBtc2cpIDogbXNnKSlcbiAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICBjb25zdCBqc29uID0ge1xuICAgICAgICAgIFwiI1wiOiBmcm9tLm1zZ0lkKCksXG4gICAgICAgICAgXCJAXCI6IGRlZHVwSWQsXG4gICAgICAgICAgZXJyOiBgJHtlcnJ9YFxuICAgICAgICB9O1xuXG4gICAgICAgIGZyb20uc2VuZCh7IGpzb24sIGlnbm9yZUxlZWNoaW5nOiB0cnVlLCBza2lwVmFsaWRhdGlvbiB9KTtcbiAgICAgICAgcmV0dXJuIG1zZztcbiAgICAgIH0pO1xuICB9KTtcblxuICByZXR1cm4gZGI7XG59O1xuXG5leHBvcnQgY29uc3QgYWNjZXB0V3JpdGVzID0gKEd1biwgeyBkaXNhYmxlUmVsYXkgPSBmYWxzZSB9ID0ge30pID0+IGRiID0+IHtcbiAgY29uc3QgcmVkaXMgPSAoR3VuLnJlZGlzID0gR3VuLnJlZGlzIHx8IGNyZWF0ZUNsaWVudChHdW4pKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuXG4gIGRiLm9uSW4obXNnID0+IHtcbiAgICBpZiAobXNnLmZyb21DbHVzdGVyKSByZXR1cm4gbXNnO1xuICAgIGlmIChtc2cuanNvbi5wdXQpIHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAuZ2V0RGlmZihtc2cuanNvbi5wdXQpXG4gICAgICAgIC50aGVuKGRpZmYgPT4ge1xuICAgICAgICAgIGNvbnN0IHNvdWxzID0gUi5rZXlzKGRpZmYpO1xuXG4gICAgICAgICAgaWYgKCFzb3Vscy5sZW5ndGgpIHJldHVybiBtc2c7XG4gICAgICAgICAgLy8gcmV0dXJuIGNvbnNvbGUubG9nKFwid291bGQgd3JpdGVcIiwgZGlmZikgfHwgbXNnO1xuICAgICAgICAgIHJldHVybiByZWRpc1xuICAgICAgICAgICAgLndyaXRlKGRpZmYpXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IGpzb24gPSB7IFwiQFwiOiBtc2cuanNvbltcIiNcIl0sIG9rOiB0cnVlLCBlcnI6IG51bGwgfTtcblxuICAgICAgICAgICAgICBtc2cuZnJvbSAmJlxuICAgICAgICAgICAgICAgIG1zZy5mcm9tLnNlbmQgJiZcbiAgICAgICAgICAgICAgICBtc2cuZnJvbS5zZW5kKHtcbiAgICAgICAgICAgICAgICAgIGpzb24sXG4gICAgICAgICAgICAgICAgICBub1JlbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgaWdub3JlTGVlY2hpbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgICBza2lwVmFsaWRhdGlvbjogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICByZXR1cm4gZGlzYWJsZVJlbGF5ID8gUi5hc3NvYyhcIm5vUmVsYXlcIiwgdHJ1ZSwgbXNnKSA6IG1zZztcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICAgICAgY29uc3QganNvbiA9IHsgXCJAXCI6IG1zZy5qc29uW1wiI1wiXSwgb2s6IGZhbHNlLCBlcnI6IGAke2Vycn1gIH07XG5cbiAgICAgICAgICAgICAgbXNnLmZyb20gJiZcbiAgICAgICAgICAgICAgICBtc2cuZnJvbS5zZW5kICYmXG4gICAgICAgICAgICAgICAgbXNnLmZyb20uc2VuZCh7XG4gICAgICAgICAgICAgICAgICBqc29uLFxuICAgICAgICAgICAgICAgICAgbm9SZWxheTogZGlzYWJsZVJlbGF5LFxuICAgICAgICAgICAgICAgICAgaWdub3JlTGVlY2hpbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgICBza2lwVmFsaWRhdGlvbjogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICByZXR1cm4gbXNnO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChlcnIgPT5cbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiZXJyb3IgYWNjZXB0aW5nIHdyaXRlc1wiLCBlcnIuc3RhY2sgfHwgZXJyKVxuICAgICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gbXNnO1xuICB9KTtcblxuICByZXR1cm4gZGI7XG59O1xuIiwibW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX180X187IiwiaW1wb3J0IHsga2V5cyB9IGZyb20gXCJyYW1kYVwiO1xuY29uc3QgZmxhdHRlbiA9IHJlcXVpcmUoXCJmbGF0XCIpO1xuXG5jb25zdCBGSUVMRF9TSVpFX0xJTUlUID0gMTAwMDAwO1xuXG5mdW5jdGlvbiBwb3N0VW5mbGF0dGVuKG9iaikge1xuICAvLyBUaGlzIGlzIHByb2JhYmx5IG9ubHkgbmVjZXNzYXJ5IGlmIHlvdSBhcmUgc3R1cGlkIGxpa2UgbWUgYW5kIHVzZSB0aGUgZGVmYXVsdCAuIGRlbGltaXRlciBmb3IgZmxhdHRlblxuICBpZiAoIW9iaikgcmV0dXJuIG9iajtcbiAgbGV0IGFycm93ID0gKG9iai5fICYmIG9iai5fW1wiPlwiXSkgfHwge307XG5cbiAga2V5cyhhcnJvdykuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICBpZiAoIShrZXkgaW4gb2JqKSkge1xuICAgICAgZGVsZXRlIGFycm93W2tleV07XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGV0IHZhbHVlID0gYXJyb3dba2V5XTtcblxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgIGxldCB2YWxLZXlzID0ga2V5cyh2YWx1ZSk7XG4gICAgICBsZXQgcmVtYWluZGVyID0gdmFsS2V5c1swXTtcblxuICAgICAgaWYgKHJlbWFpbmRlcikge1xuICAgICAgICBsZXQgcmVhbEtleSA9IFtrZXksIHZhbEtleXNdLmpvaW4oXCIuXCIpO1xuICAgICAgICBsZXQgcmVhbFZhbHVlID0gdmFsdWVbcmVtYWluZGVyXTtcblxuICAgICAgICBkZWxldGUgYXJyb3dba2V5XTtcbiAgICAgICAgYXJyb3dbcmVhbEtleV0gPSByZWFsVmFsdWU7XG4gICAgICAgIHJlYWxWYWx1ZSA9IChvYmpba2V5XSAmJiBvYmpba2V5XVtyZW1haW5kZXJdKSB8fCBudWxsO1xuICAgICAgICBkZWxldGUgb2JqW2tleV07XG4gICAgICAgIG9ialtyZWFsS2V5XSA9IHJlYWxWYWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuICBrZXlzKG9iaikuZm9yRWFjaChrZXkgPT4ge1xuICAgIGlmIChrZXlbMF0gPT09IFwiLlwiKSBkZWxldGUgW2tleV07XG4gICAgaWYgKGtleSA9PT0gXCJfXCIpIHJldHVybjtcbiAgICBpZiAoIShrZXkgaW4gYXJyb3cpKSB7XG4gICAgICBkZWxldGUgb2JqW2tleV07XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIG9iajtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZyb21SZWRpcyhvYmopIHtcbiAgaWYgKCFvYmopIHJldHVybiBvYmo7XG4gIGNvbnN0IHNvcnRlZCA9IHt9O1xuXG4gIGtleXMob2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgIGlmIChrZXlbMF0gPT09IFwiLlwiKSBkZWxldGUgb2JqW2tleV07XG5cbiAgICBpZiAob2JqW2tleV0gPT09IFwifE5VTEx8XCIpIHtcbiAgICAgIG9ialtrZXldID0gbnVsbDtcbiAgICB9XG4gICAgaWYgKG9ialtrZXldID09PSBcInxVTkRFRklORUR8XCIpIHtcbiAgICAgIG9ialtrZXldID0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGlmICgvPlxcLi8udGVzdChrZXkpKSB7XG4gICAgICBvYmpba2V5XSA9IHBhcnNlRmxvYXQob2JqW2tleV0sIDEwKSB8fCBvYmpba2V5XTtcbiAgICB9XG4gICAgaWYgKG9ialtrZXldICYmIG9ialtrZXldLmxlbmd0aCA+IEZJRUxEX1NJWkVfTElNSVQpIHtcbiAgICAgIG9ialtrZXldID0gb2JqW2tleV0uc2xpY2UoMCwgRklFTERfU0laRV9MSU1JVCk7XG4gICAgICBjb25zb2xlLmxvZyhcInRydW5jYXRlZFwiLCBrZXkpO1xuICAgIH1cbiAgfSk7XG5cbiAgb2JqID0gcG9zdFVuZmxhdHRlbihmbGF0dGVuLnVuZmxhdHRlbihvYmosIHsgb2JqZWN0OiB0cnVlIH0pKTtcblxuICBPYmplY3Qua2V5cyhvYmopXG4gICAgLnNvcnQoKVxuICAgIC5mb3JFYWNoKGtleSA9PiAoc29ydGVkW2tleV0gPSBvYmpba2V5XSkpO1xuXG4gIHJldHVybiBzb3J0ZWQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0b1JlZGlzKG9iaikge1xuICBpZiAoIW9iaikgcmV0dXJuIG9iajtcblxuICBvYmogPSBmbGF0dGVuKHBvc3RVbmZsYXR0ZW4ob2JqKSk7XG4gIGtleXMob2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgIGlmIChvYmpba2V5XSA9PT0gbnVsbCkge1xuICAgICAgb2JqW2tleV0gPSBcInxOVUxMfFwiO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIG9ialtrZXldID09PSB1bmRlZmluZWQpIHtcbiAgICAgIG9ialtrZXldID0gXCJ8VU5ERUZJTkVEfFwiO1xuICAgIH1cbiAgICBpZiAob2JqW2tleV0gJiYgb2JqW2tleV0ubGVuZ3RoID4gRklFTERfU0laRV9MSU1JVCkge1xuICAgICAgb2JqW2tleV0gPSBvYmpba2V5XS5zbGljZSgwLCBGSUVMRF9TSVpFX0xJTUlUKTtcbiAgICAgIGNvbnNvbGUubG9nKFwidHJ1bmNhdGVkIGlucHV0XCIsIGtleSk7XG4gICAgfVxuICAgIGlmIChrZXlbMF0gPT09IFwiLlwiKSBkZWxldGUgb2JqW2tleV07XG4gIH0pO1xuICByZXR1cm4gb2JqO1xufVxuIiwibW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX182X187IiwiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSBcIi4vY2xpZW50XCI7XG5cbmV4cG9ydCBjb25zdCBhdHRhY2hUb0d1biA9IEd1biA9PiBHdW4ub24oXCJjcmVhdGVcIiwgZnVuY3Rpb24oZGIpIHtcbiAgdGhpcy50by5uZXh0KGRiKTtcbiAgY29uc3QgcmVkaXMgPSBHdW4ucmVkaXMgPSBkYi5yZWRpcyA9IGNyZWF0ZUNsaWVudChHdW4pO1xuXG4gIGRiLm9uKFwiZ2V0XCIsIGZ1bmN0aW9uKHJlcXVlc3QpIHtcbiAgICB0aGlzLnRvLm5leHQocmVxdWVzdCk7XG4gICAgY29uc3QgZGVkdXBJZCA9IHJlcXVlc3RbXCIjXCJdO1xuICAgIGNvbnN0IGdldCA9IHJlcXVlc3QuZ2V0O1xuICAgIGNvbnN0IHNvdWwgPSBnZXRbXCIjXCJdO1xuXG4gICAgcmVkaXMuYmF0Y2hlZEdldChzb3VsLCByZXN1bHQgPT4gZGIub24oXCJpblwiLCB7XG4gICAgICBcIkBcIjogZGVkdXBJZCxcbiAgICAgIHB1dDogcmVzdWx0ID8geyBbc291bF06IHJlc3VsdCB9IDogbnVsbCxcbiAgICAgIGVycjogbnVsbFxuICAgIH0pKS5jYXRjaChlcnIgPT5cbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJlcnJvclwiLCBlcnIuc3RhY2sgfHwgZXJyKSB8fFxuICAgICAgZGIub24oXCJpblwiLCB7XG4gICAgICAgIFwiQFwiOiBkZWR1cElkLFxuICAgICAgICBwdXQ6IG51bGwsXG4gICAgICAgIGVyclxuICAgICAgfSlcbiAgICApO1xuICB9KTtcblxuICBkYi5vbihcInB1dFwiLCBmdW5jdGlvbihyZXF1ZXN0KSB7XG4gICAgdGhpcy50by5uZXh0KHJlcXVlc3QpO1xuICAgIGNvbnN0IGRlZHVwSWQgPSByZXF1ZXN0W1wiI1wiXTtcblxuICAgIHJlZGlzLndyaXRlKHJlcXVlc3QucHV0KVxuICAgICAgLnRoZW4oKCkgPT5cbiAgICAgICAgZGIub24oXCJpblwiLCB7XG4gICAgICAgICAgXCJAXCI6IGRlZHVwSWQsXG4gICAgICAgICAgb2s6IHRydWUsXG4gICAgICAgICAgZXJyOiBudWxsXG4gICAgICAgIH0pXG4gICAgICApXG4gICAgICAuY2F0Y2goZXJyID0+XG4gICAgICAgIGRiLm9uKFwiaW5cIiwge1xuICAgICAgICAgIFwiQFwiOiBkZWR1cElkLFxuICAgICAgICAgIG9rOiBmYWxzZSxcbiAgICAgICAgICBlcnI6IGVyclxuICAgICAgICB9KVxuICAgICAgKTtcbiAgfSk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiIn0=