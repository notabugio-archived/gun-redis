!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("ramda"),require("redis"),require("flat")):"function"==typeof define&&define.amd?define("gun-redis",["ramda","redis","flat"],r):"object"==typeof exports?exports["gun-redis"]=r(require("ramda"),require("redis"),require("flat")):e["gun-redis"]=r(e.ramda,e.redis,e.flat)}("undefined"!=typeof self?self:this,function(e,r,t){return function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=2)}([function(r,t){r.exports=e},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createClient=void 0;var n=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};n.get||n.set?Object.defineProperty(r,t,n):r[t]=e[t]}return r.default=e,r}(t(0)),o=t(4),i=t(5);var u=/^_\..*/,c=/(\.#$)/;r.createClient=function(e){for(var r=[],t=arguments.length,f=new Array(t>1?t-1:0),a=1;a<t;a++)f[a-1]=arguments[a];var l=o.createClient.apply(void 0,f),s=function(e){return r.push(e)},p=function(e){return new Promise(function(r,t){if(!e)return r(null);l.hgetall(e,function(e,n){e?(console.error("get error",e),t(e)):r((0,i.fromRedis)(n))})})};return s(function(e,r){return console.log("modify",e,r)}),{get:p,read:function(r){return p(r).then(function(t){var o=t?{...t}:t;return e.SEA&&-1!==r.indexOf("~")?(n.without(["_"],n.keys(o)).forEach(function(n){e.SEA.verify(e.SEA.opt.pack(t[n],n,t,r),!1,function(r){return o[n]=e.SEA.opt.unpack(r,n,t)})}),o):t})},batchedGet:function(e,r){return new Promise(function(t,n){l.hkeys(e,function(o,f){if(o)return console.error("error",o.stack||o),n(o);if(f.length<=1e4)return p(e).then(function(e){r(e),t(e)});console.log("get big soul",e,f.length);var a=f.filter(function(e){return!e.match(u)}),s=function(){return new Promise(function(t,n){var o=a.splice(0,1e4);return o.length?function(e,r){return new Promise(function(t,n){var o=r.map(function(e){return"_.>.".concat(e).replace(c,"")});return l.hmget(e,o,function(u,c){if(u)return console.error("hmget err",u.stack||u)||n(u);var f={"_.#":e};return c.forEach(function(e,r){return f[o[r]]=e}),l.hmget(e,r,function(e,o){return e?console.error("hmget err",e.stack||e)||n(e):(o.forEach(function(e,t){return f[r[t]]=e}),t((0,i.fromRedis)(f)))})})})}(e,o).then(function(e){return r(e),t()},n):t(!0)})};return function e(){return s().then(function(r){return!r&&e})}().then(function(e){t(e)}).catch(n)})})},write:function(e){return Promise.all(n.keys(e).map(function(t){return new Promise(function(o,u){var c=!1,f=e[t],a=n.path(["_",">"],f)||{},s=n.keys(a);return function e(){var d=s.splice(0,1e4);if(!d.length)return c&&function(e,t){r.map(function(r){return r(e,t)})}(t,c),o();var v={_:{"#":t,">":n.pick(d,a)},...n.pick(d,f)},y=(0,i.toRedis)(v);return p(t).then(function(r){var o=d.find(function(e){var t=n.prop(e,v),o=n.prop(e,r);if(t===o)return!1;var i=n.path([e,"#"],v),u=n.path([e,"#"],r);return!((i||u)&&i===u||"number"==typeof t&&parseFloat(o)===t)});return o?l.hmset(t,(0,i.toRedis)(y),function(r){c=o,r?u(r):e()}):e()})}()})}))},onChange:s,offChange:function(e){return r=n.without([e],r)}}}},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"attachToGun",{enumerable:!0,get:function(){return o.attachToGun}}),r.receiver=void 0;var n=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};n.get||n.set?Object.defineProperty(r,t,n):r[t]=e[t]}return r.default=e,r}(t(3)),o=t(7);var i=n;r.receiver=i},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.acceptWrites=r.respondToGets=void 0;var n=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};n.get||n.set?Object.defineProperty(r,t,n):r[t]=e[t]}return r.default=e,r}(t(0)),o=t(1);r.respondToGets=function(e){var r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).skipValidation,t=void 0===r||r;return function(r){var i=e.redis=e.redis||(0,o.createClient)(e);return r.onIn(function(e){var r=e.from,o=e.json,u=e.fromCluster,c=n.path(["get","#"],o),f=n.prop("#",o);return!c||u?e:i.batchedGet(c,function(e){var n,o,i,u={"#":r.msgId(),"@":f,put:e?(n={},o=c,i=e,o in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i,n):null};r.send({json:u,ignoreLeeching:!0,skipValidation:!e||t})}).catch(function(e){var n={"#":r.msgId(),"@":f,err:"".concat(e)};r.send({json:n,ignoreLeeching:!0,skipValidation:t})}).then(function(){return e})}),r}};r.acceptWrites=function(e){return function(r){var t=e.redis=e.redis||(0,o.createClient)(e);return r.onIn(function(e){return e.fromCluster?e:e.json.put?r.getDiff(e.json.put).then(function(r){return n.keys(r).length?t.write(r).then(function(){var r={"@":e.json["#"],ok:!0,err:null};return e.from&&e.from.send&&e.from.send({json:r,ignoreLeeching:!0,skipValidation:!0}),e}).catch(function(r){var t={"@":e.json["#"],ok:!1,err:"".concat(r)};return e.from&&e.from.send&&e.from.send({json:t,ignoreLeeching:!0,skipValidation:!0}),e}):e}).catch(function(e){return console.error("error accepting writes",e.stack||e)}):e}),r}}},function(e,t){e.exports=r},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.fromRedis=function(e){if(!e)return e;var r={};return(0,n.keys)(e).forEach(function(r){"."===r[0]&&delete e[r],"|NULL|"===e[r]&&(e[r]=null),"|UNDEFINED|"===e[r]&&(e[r]=void 0),/>\./.test(r)&&(e[r]=parseFloat(e[r],10)||e[r]),e[r]&&e[r].length>u&&(e[r]=e[r].slice(0,u),console.log("truncated",r))}),e=function(e){if(!e)return e;var r=e._&&e._[">"]||{};return(0,n.keys)(r).forEach(function(t){var i=r[t];if("object"===o(i)){var u=(0,n.keys)(i),c=u[0];if(c){var f=[t,u].join("."),a=i[c];delete r[t],r[f]=a,a=e[t]&&e[t][c]||null,delete e[t],e[f]=a}}}),(0,n.keys)(e).forEach(function(e){e[0]}),e}(i.unflatten(e)),Object.keys(e).sort().forEach(function(t){return r[t]=e[t]}),r},r.toRedis=function(e){return e?(e=i(e),(0,n.keys)(e).forEach(function(r){null===e[r]&&(e[r]="|NULL|"),void 0===o(e[r])&&(e[r]="|UNDEFINED|"),e[r]&&e[r].length>u&&(e[r]=e[r].slice(0,u),console.log("truncated input",r)),"."===r[0]&&delete e[r]}),e):e};var n=t(0);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=t(6),u=1e5},function(e,r){e.exports=t},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.attachToGun=void 0;var n=t(1);r.attachToGun=function(e){return e.on("create",function(r){this.to.next(r);var t=e.redis=r.redis=(0,n.createClient)(e);r.on("get",function(e){this.to.next(e);var n=e["#"],o=e.get["#"];t.batchedGet(o,function(e){return r.on("in",{"@":n,put:e?(t={},i=o,u=e,i in t?Object.defineProperty(t,i,{value:u,enumerable:!0,configurable:!0,writable:!0}):t[i]=u,t):null,err:null});var t,i,u}).catch(function(e){return console.error("error",e.stack||e)||r.on("in",{"@":n,put:null,err:e})})}),r.on("put",function(e){this.to.next(e);var n=e["#"];t.write(e.put).then(function(){return r.on("in",{"@":n,ok:!0,err:null})}).catch(function(e){return r.on("in",{"@":n,ok:!1,err:e})})})})}}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ndW4tcmVkaXMvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL2d1bi1yZWRpcy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9ndW4tcmVkaXMvZXh0ZXJuYWwgXCJyYW1kYVwiIiwid2VicGFjazovL2d1bi1yZWRpcy8uL3NyYy9jbGllbnQuanMiLCJ3ZWJwYWNrOi8vZ3VuLXJlZGlzLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL2d1bi1yZWRpcy8uL3NyYy9yZWNlaXZlci5qcyIsIndlYnBhY2s6Ly9ndW4tcmVkaXMvZXh0ZXJuYWwgXCJyZWRpc1wiIiwid2VicGFjazovL2d1bi1yZWRpcy8uL3NyYy9zZXJpYWxpemUuanMiLCJ3ZWJwYWNrOi8vZ3VuLXJlZGlzL2V4dGVybmFsIFwiZmxhdFwiIiwid2VicGFjazovL2d1bi1yZWRpcy8uL3NyYy9ndW4uanMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwicmVxdWlyZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJ0aGlzIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMF9fIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fNF9fIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fNl9fIiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIlIiLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsIl9yZWRpcyIsIl9zZXJpYWxpemUiLCJtZXRhUmUiLCJlZGdlUmUiLCJHdW4iLCJjaGFuZ2VTdWJzY3JpYmVycyIsIl9sZW4iLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJjb25maWciLCJBcnJheSIsIl9rZXkiLCJyZWRpcyIsImNyZWF0ZUNsaWVudCIsImFwcGx5Iiwib25DaGFuZ2UiLCJmbiIsInB1c2giLCJzb3VsIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJoZ2V0YWxsIiwiZXJyIiwicmVzIiwiY29uc29sZSIsImVycm9yIiwiZnJvbVJlZGlzIiwibG9nIiwicmVhZCIsInRoZW4iLCJyYXdEYXRhIiwiZGF0YSIsIlNFQSIsImluZGV4T2YiLCJ3aXRob3V0Iiwia2V5cyIsImZvckVhY2giLCJ2ZXJpZnkiLCJvcHQiLCJwYWNrIiwidW5wYWNrIiwiYmF0Y2hlZEdldCIsImNiIiwiaGtleXMiLCJub2RlS2V5cyIsInN0YWNrIiwiYXR0cktleXMiLCJmaWx0ZXIiLCJtYXRjaCIsInJlYWRCYXRjaCIsIm9rIiwiZmFpbCIsImJhdGNoIiwic3BsaWNlIiwiYmF0Y2hNZXRhIiwibWFwIiwiY29uY2F0IiwicmVwbGFjZSIsImhtZ2V0IiwibWV0YSIsIm9iaiIsIl8uIyIsInZhbCIsImlkeCIsInJlYWRLZXlCYXRjaCIsInJlc3VsdCIsInJlYWROZXh0QmF0Y2giLCJkb25lIiwiY2F0Y2giLCJ3cml0ZSIsInB1dCIsImFsbCIsImhhc0NoYW5nZWQiLCJub2RlIiwicGF0aCIsIndyaXRlTmV4dEJhdGNoIiwibm90aWZ5Q2hhbmdlU3Vic2NyaWJlcnMiLCJ1cGRhdGVkIiwiXyIsIiMiLCI+IiwicGljayIsInVwZGF0ZXMiLCJ0b1JlZGlzIiwiZXhpc3RpbmciLCJtb2RpZmllZEtleSIsImZpbmQiLCJ1cGRhdGVkVmFsIiwicHJvcCIsImV4aXN0aW5nVmFsIiwidXBkYXRlZFNvdWwiLCJleGlzdGluZ1NvdWwiLCJwYXJzZUZsb2F0IiwiaG1zZXQiLCJvZmZDaGFuZ2UiLCJyZWNlaXZlckZucyIsIl9ndW4iLCJyZWNlaXZlciIsIl9jbGllbnQiLCJfcmVmJHNraXBWYWxpZGF0aW9uIiwidW5kZWZpbmVkIiwic2tpcFZhbGlkYXRpb24iLCJkYiIsIm9uSW4iLCJtc2ciLCJmcm9tIiwianNvbiIsImZyb21DbHVzdGVyIiwiZGVkdXBJZCIsIm1zZ0lkIiwiQCIsInNlbmQiLCJpZ25vcmVMZWVjaGluZyIsImdldERpZmYiLCJkaWZmIiwic29ydGVkIiwiX3JhbWRhIiwidGVzdCIsIkZJRUxEX1NJWkVfTElNSVQiLCJzbGljZSIsImFycm93IiwiX3R5cGVvZiIsInZhbEtleXMiLCJyZW1haW5kZXIiLCJyZWFsS2V5Iiwiam9pbiIsInJlYWxWYWx1ZSIsInBvc3RVbmZsYXR0ZW4iLCJmbGF0dGVuIiwidW5mbGF0dGVuIiwic29ydCIsIm9uIiwidG8iLCJuZXh0IiwicmVxdWVzdCJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsR0FDQSxpQkFBQUMsU0FBQSxpQkFBQUMsT0FDQUEsT0FBQUQsUUFBQUQsRUFBQUcsUUFBQSxTQUFBQSxRQUFBLFNBQUFBLFFBQUEsU0FDQSxtQkFBQUMsZUFBQUMsSUFDQUQsT0FBQSxxQ0FBQUosR0FDQSxpQkFBQUMsUUFDQUEsUUFBQSxhQUFBRCxFQUFBRyxRQUFBLFNBQUFBLFFBQUEsU0FBQUEsUUFBQSxTQUVBSixFQUFBLGFBQUFDLEVBQUFELEVBQUEsTUFBQUEsRUFBQSxNQUFBQSxFQUFBLE1BUkEsQ0FTQyxvQkFBQU8sVUFBQUMsS0FBQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUNELG1CQ1RBLElBQUFDLEVBQUEsR0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQVosUUFHQSxJQUFBQyxFQUFBUyxFQUFBRSxHQUFBLENBQ0FDLEVBQUFELEVBQ0FFLEdBQUEsRUFDQWQsUUFBQSxJQVVBLE9BTkFlLEVBQUFILEdBQUFJLEtBQUFmLEVBQUFE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IiwiZmlsZSI6Imd1bi1yZWRpcy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoXCJyYW1kYVwiKSwgcmVxdWlyZShcInJlZGlzXCIpLCByZXF1aXJlKFwiZmxhdFwiKSk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShcImd1bi1yZWRpc1wiLCBbXCJyYW1kYVwiLCBcInJlZGlzXCIsIFwiZmxhdFwiXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJndW4tcmVkaXNcIl0gPSBmYWN0b3J5KHJlcXVpcmUoXCJyYW1kYVwiKSwgcmVxdWlyZShcInJlZGlzXCIpLCByZXF1aXJlKFwiZmxhdFwiKSk7XG5cdGVsc2Vcblx0XHRyb290W1wiZ3VuLXJlZGlzXCJdID0gZmFjdG9yeShyb290W1wicmFtZGFcIl0sIHJvb3RbXCJyZWRpc1wiXSwgcm9vdFtcImZsYXRcIl0pO1xufSkodHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDogdGhpcywgZnVuY3Rpb24oX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMF9fLCBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX180X18sIF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzZfXykge1xucmV0dXJuICIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAyKTtcbiIsIm1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMF9fOyIsImltcG9ydCAqIGFzIFIgZnJvbSBcInJhbWRhXCI7XG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgYXMgY3JlYXRlUmVkaXNDbGllbnQgfSBmcm9tIFwicmVkaXNcIjtcbmltcG9ydCB7IHRvUmVkaXMsIGZyb21SZWRpcyB9IGZyb20gXCIuL3NlcmlhbGl6ZVwiO1xuXG5jb25zdCBHRVRfQkFUQ0hfU0laRSA9IDEwMDAwO1xuY29uc3QgUFVUX0JBVENIX1NJWkUgPSAxMDAwMDtcblxuY29uc3QgbWV0YVJlID0gL15fXFwuLiovO1xuY29uc3QgZWRnZVJlID0gLyhcXC4jJCkvO1xuXG5leHBvcnQgY29uc3QgY3JlYXRlQ2xpZW50ID0gKEd1biwgLi4uY29uZmlnKSA9PiB7XG4gIGxldCBjaGFuZ2VTdWJzY3JpYmVycyA9IFtdO1xuICBjb25zdCByZWRpcyA9IGNyZWF0ZVJlZGlzQ2xpZW50KC4uLmNvbmZpZyk7XG4gIGNvbnN0IG5vdGlmeUNoYW5nZVN1YnNjcmliZXJzID0gKHNvdWwsIGtleSkgPT5cbiAgICBjaGFuZ2VTdWJzY3JpYmVycy5tYXAoZm4gPT4gZm4oc291bCwga2V5KSk7XG4gIGNvbnN0IG9uQ2hhbmdlID0gZm4gPT4gY2hhbmdlU3Vic2NyaWJlcnMucHVzaChmbik7XG4gIGNvbnN0IG9mZkNoYW5nZSA9IGZuID0+XG4gICAgKGNoYW5nZVN1YnNjcmliZXJzID0gUi53aXRob3V0KFtmbl0sIGNoYW5nZVN1YnNjcmliZXJzKSk7XG5cbiAgY29uc3QgZ2V0ID0gc291bCA9PlxuICAgIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGlmICghc291bCkgcmV0dXJuIHJlc29sdmUobnVsbCk7XG4gICAgICByZWRpcy5oZ2V0YWxsKHNvdWwsIGZ1bmN0aW9uKGVyciwgcmVzKSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiZ2V0IGVycm9yXCIsIGVycik7XG4gICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzb2x2ZShmcm9tUmVkaXMocmVzKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9KTtcblxuICBjb25zdCByZWFkID0gc291bCA9PlxuICAgIGdldChzb3VsKS50aGVuKHJhd0RhdGEgPT4ge1xuICAgICAgY29uc3QgZGF0YSA9IHJhd0RhdGEgPyB7IC4uLnJhd0RhdGEgfSA6IHJhd0RhdGE7XG5cbiAgICAgIGlmICghR3VuLlNFQSB8fCBzb3VsLmluZGV4T2YoXCJ+XCIpID09PSAtMSkgcmV0dXJuIHJhd0RhdGE7XG4gICAgICBSLndpdGhvdXQoW1wiX1wiXSwgUi5rZXlzKGRhdGEpKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgIEd1bi5TRUEudmVyaWZ5KFxuICAgICAgICAgIEd1bi5TRUEub3B0LnBhY2socmF3RGF0YVtrZXldLCBrZXksIHJhd0RhdGEsIHNvdWwpLFxuICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgIHJlcyA9PiAoZGF0YVtrZXldID0gR3VuLlNFQS5vcHQudW5wYWNrKHJlcywga2V5LCByYXdEYXRhKSlcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSk7XG5cbiAgY29uc3QgcmVhZEtleUJhdGNoID0gKHNvdWwsIGJhdGNoKSA9PlxuICAgIG5ldyBQcm9taXNlKChvaywgZmFpbCkgPT4ge1xuICAgICAgY29uc3QgYmF0Y2hNZXRhID0gYmF0Y2gubWFwKGtleSA9PiBgXy4+LiR7a2V5fWAucmVwbGFjZShlZGdlUmUsIFwiXCIpKTtcblxuICAgICAgcmV0dXJuIHJlZGlzLmhtZ2V0KHNvdWwsIGJhdGNoTWV0YSwgKGVyciwgbWV0YSkgPT4ge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoXCJobWdldCBlcnJcIiwgZXJyLnN0YWNrIHx8IGVycikgfHwgZmFpbChlcnIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG9iaiA9IHtcbiAgICAgICAgICBcIl8uI1wiOiBzb3VsXG4gICAgICAgIH07XG5cbiAgICAgICAgbWV0YS5mb3JFYWNoKCh2YWwsIGlkeCkgPT4gKG9ialtiYXRjaE1ldGFbaWR4XV0gPSB2YWwpKTtcbiAgICAgICAgcmV0dXJuIHJlZGlzLmhtZ2V0KHNvdWwsIGJhdGNoLCAoZXJyLCByZXMpID0+IHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS5lcnJvcihcImhtZ2V0IGVyclwiLCBlcnIuc3RhY2sgfHwgZXJyKSB8fCBmYWlsKGVycik7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlcy5mb3JFYWNoKCh2YWwsIGlkeCkgPT4gKG9ialtiYXRjaFtpZHhdXSA9IHZhbCkpO1xuICAgICAgICAgIHJldHVybiBvayhmcm9tUmVkaXMob2JqKSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgY29uc3QgYmF0Y2hlZEdldCA9IChzb3VsLCBjYikgPT5cbiAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICByZWRpcy5oa2V5cyhzb3VsLCAoZXJyLCBub2RlS2V5cykgPT4ge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcImVycm9yXCIsIGVyci5zdGFjayB8fCBlcnIpO1xuICAgICAgICAgIHJldHVybiByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm9kZUtleXMubGVuZ3RoIDw9IEdFVF9CQVRDSF9TSVpFKSB7XG4gICAgICAgICAgcmV0dXJuIGdldChzb3VsKS50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgICBjYihyZXMpO1xuICAgICAgICAgICAgcmVzb2x2ZShyZXMpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKFwiZ2V0IGJpZyBzb3VsXCIsIHNvdWwsIG5vZGVLZXlzLmxlbmd0aCk7XG4gICAgICAgIGNvbnN0IGF0dHJLZXlzID0gbm9kZUtleXMuZmlsdGVyKGtleSA9PiAha2V5Lm1hdGNoKG1ldGFSZSkpO1xuICAgICAgICBjb25zdCByZWFkQmF0Y2ggPSAoKSA9PlxuICAgICAgICAgIG5ldyBQcm9taXNlKChvaywgZmFpbCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYmF0Y2ggPSBhdHRyS2V5cy5zcGxpY2UoMCwgR0VUX0JBVENIX1NJWkUpO1xuXG4gICAgICAgICAgICBpZiAoIWJhdGNoLmxlbmd0aCkgcmV0dXJuIG9rKHRydWUpO1xuXG4gICAgICAgICAgICByZXR1cm4gcmVhZEtleUJhdGNoKHNvdWwsIGJhdGNoKS50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgIGNiKHJlc3VsdCk7XG4gICAgICAgICAgICAgIHJldHVybiBvaygpO1xuICAgICAgICAgICAgfSwgZmFpbCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHJlYWROZXh0QmF0Y2ggPSAoKSA9PlxuICAgICAgICAgIHJlYWRCYXRjaCgpLnRoZW4oZG9uZSA9PiAhZG9uZSAmJiByZWFkTmV4dEJhdGNoKTtcblxuICAgICAgICByZXR1cm4gcmVhZE5leHRCYXRjaCgpXG4gICAgICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgICAgIHJlc29sdmUocmVzKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaChyZWplY3QpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgY29uc3Qgd3JpdGUgPSBwdXQgPT5cbiAgICBQcm9taXNlLmFsbChcbiAgICAgIFIua2V5cyhwdXQpLm1hcChcbiAgICAgICAgc291bCA9PlxuICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGxldCBoYXNDaGFuZ2VkID0gZmFsc2U7XG4gICAgICAgICAgICBjb25zdCBub2RlID0gcHV0W3NvdWxdO1xuICAgICAgICAgICAgY29uc3QgbWV0YSA9IFIucGF0aChbXCJfXCIsIFwiPlwiXSwgbm9kZSkgfHwge307XG4gICAgICAgICAgICBjb25zdCBub2RlS2V5cyA9IFIua2V5cyhtZXRhKTtcbiAgICAgICAgICAgIGNvbnN0IHdyaXRlTmV4dEJhdGNoID0gKCkgPT4ge1xuICAgICAgICAgICAgICBjb25zdCBiYXRjaCA9IG5vZGVLZXlzLnNwbGljZSgwLCBQVVRfQkFUQ0hfU0laRSk7XG5cbiAgICAgICAgICAgICAgaWYgKCFiYXRjaC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBpZiAoaGFzQ2hhbmdlZCkgbm90aWZ5Q2hhbmdlU3Vic2NyaWJlcnMoc291bCwgaGFzQ2hhbmdlZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjb25zdCB1cGRhdGVkID0ge1xuICAgICAgICAgICAgICAgIF86IHtcbiAgICAgICAgICAgICAgICAgIFwiI1wiOiBzb3VsLFxuICAgICAgICAgICAgICAgICAgXCI+XCI6IFIucGljayhiYXRjaCwgbWV0YSlcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIC4uLlIucGljayhiYXRjaCwgbm9kZSlcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgY29uc3QgdXBkYXRlcyA9IHRvUmVkaXModXBkYXRlZCk7XG5cbiAgICAgICAgICAgICAgLy8gcmV0dXJuIHJlYWRLZXlCYXRjaChzb3VsLCBiYXRjaCkudGhlbihleGlzdGluZyA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiBnZXQoc291bCkudGhlbihleGlzdGluZyA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbW9kaWZpZWRLZXkgPSBiYXRjaC5maW5kKGtleSA9PiB7XG4gICAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVkVmFsID0gUi5wcm9wKGtleSwgdXBkYXRlZCk7XG4gICAgICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ1ZhbCA9IFIucHJvcChrZXksIGV4aXN0aW5nKTtcblxuICAgICAgICAgICAgICAgICAgaWYgKHVwZGF0ZWRWYWwgPT09IGV4aXN0aW5nVmFsKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVkU291bCA9IFIucGF0aChba2V5LCBcIiNcIl0sIHVwZGF0ZWQpO1xuICAgICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdTb3VsID0gUi5wYXRoKFtrZXksIFwiI1wiXSwgZXhpc3RpbmcpO1xuXG4gICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgICh1cGRhdGVkU291bCB8fCBleGlzdGluZ1NvdWwpICYmXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRTb3VsID09PSBleGlzdGluZ1NvdWxcbiAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgIHR5cGVvZiB1cGRhdGVkVmFsID09PSBcIm51bWJlclwiICYmXG4gICAgICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQoZXhpc3RpbmdWYWwpID09PSB1cGRhdGVkVmFsXG4gICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmICghbW9kaWZpZWRLZXkpIHJldHVybiB3cml0ZU5leHRCYXRjaCgpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlZGlzLmhtc2V0KHNvdWwsIHRvUmVkaXModXBkYXRlcyksIGVyciA9PiB7XG4gICAgICAgICAgICAgICAgICBoYXNDaGFuZ2VkID0gbW9kaWZpZWRLZXk7XG4gICAgICAgICAgICAgICAgICBlcnIgPyByZWplY3QoZXJyKSA6IHdyaXRlTmV4dEJhdGNoKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmV0dXJuIHdyaXRlTmV4dEJhdGNoKCk7XG4gICAgICAgICAgfSlcbiAgICAgIClcbiAgICApO1xuXG4gIG9uQ2hhbmdlKChzb3VsLCBrZXkpID0+IGNvbnNvbGUubG9nKFwibW9kaWZ5XCIsIHNvdWwsIGtleSkpO1xuXG4gIHJldHVybiB7IGdldCwgcmVhZCwgYmF0Y2hlZEdldCwgd3JpdGUsIG9uQ2hhbmdlLCBvZmZDaGFuZ2UgfTtcbn07XG4iLCJpbXBvcnQgKiBhcyByZWNlaXZlckZucyBmcm9tIFwiLi9yZWNlaXZlclwiO1xuZXhwb3J0IHsgYXR0YWNoVG9HdW4gfSBmcm9tIFwiLi9ndW5cIjtcblxuZXhwb3J0IGNvbnN0IHJlY2VpdmVyID0gcmVjZWl2ZXJGbnM7XG4iLCJpbXBvcnQgKiBhcyBSIGZyb20gXCJyYW1kYVwiO1xuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSBcIi4vY2xpZW50XCI7XG5cbmV4cG9ydCBjb25zdCByZXNwb25kVG9HZXRzID0gKEd1biwgeyBza2lwVmFsaWRhdGlvbiA9IHRydWUgfSA9IHt9KSA9PiBkYiA9PiB7XG4gIGNvbnN0IHJlZGlzID0gKEd1bi5yZWRpcyA9IEd1bi5yZWRpcyB8fCBjcmVhdGVDbGllbnQoR3VuKSk7XG5cbiAgZGIub25Jbihtc2cgPT4ge1xuICAgIGNvbnN0IHsgZnJvbSwganNvbiwgZnJvbUNsdXN0ZXIgfSA9IG1zZztcbiAgICBjb25zdCBzb3VsID0gUi5wYXRoKFtcImdldFwiLCBcIiNcIl0sIGpzb24pO1xuICAgIGNvbnN0IGRlZHVwSWQgPSBSLnByb3AoXCIjXCIsIGpzb24pO1xuXG4gICAgaWYgKCFzb3VsIHx8IGZyb21DbHVzdGVyKSByZXR1cm4gbXNnO1xuICAgIHJldHVybiByZWRpc1xuICAgICAgLmJhdGNoZWRHZXQoc291bCwgcmVzdWx0ID0+IHtcbiAgICAgICAgY29uc3QganNvbiA9IHtcbiAgICAgICAgICBcIiNcIjogZnJvbS5tc2dJZCgpLFxuICAgICAgICAgIFwiQFwiOiBkZWR1cElkLFxuICAgICAgICAgIHB1dDogcmVzdWx0ID8geyBbc291bF06IHJlc3VsdCB9IDogbnVsbFxuICAgICAgICB9O1xuXG4gICAgICAgIGZyb20uc2VuZCh7XG4gICAgICAgICAganNvbixcbiAgICAgICAgICBpZ25vcmVMZWVjaGluZzogdHJ1ZSxcbiAgICAgICAgICBza2lwVmFsaWRhdGlvbjogIXJlc3VsdCB8fCBza2lwVmFsaWRhdGlvblxuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgY29uc3QganNvbiA9IHtcbiAgICAgICAgICBcIiNcIjogZnJvbS5tc2dJZCgpLFxuICAgICAgICAgIFwiQFwiOiBkZWR1cElkLFxuICAgICAgICAgIGVycjogYCR7ZXJyfWBcbiAgICAgICAgfTtcblxuICAgICAgICBmcm9tLnNlbmQoeyBqc29uLCBpZ25vcmVMZWVjaGluZzogdHJ1ZSwgc2tpcFZhbGlkYXRpb24gfSk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oKCkgPT4gbXNnKTtcbiAgfSk7XG5cbiAgcmV0dXJuIGRiO1xufTtcblxuZXhwb3J0IGNvbnN0IGFjY2VwdFdyaXRlcyA9IEd1biA9PiBkYiA9PiB7XG4gIGNvbnN0IHJlZGlzID0gKEd1bi5yZWRpcyA9IEd1bi5yZWRpcyB8fCBjcmVhdGVDbGllbnQoR3VuKSk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcblxuICBkYi5vbkluKG1zZyA9PiB7XG4gICAgaWYgKG1zZy5mcm9tQ2x1c3RlcikgcmV0dXJuIG1zZztcbiAgICBpZiAobXNnLmpzb24ucHV0KSB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLmdldERpZmYobXNnLmpzb24ucHV0KVxuICAgICAgICAudGhlbihkaWZmID0+IHtcbiAgICAgICAgICBjb25zdCBzb3VscyA9IFIua2V5cyhkaWZmKTtcblxuICAgICAgICAgIGlmICghc291bHMubGVuZ3RoKSByZXR1cm4gbXNnO1xuICAgICAgICAgIC8vIHJldHVybiBjb25zb2xlLmxvZyhcIndvdWxkIHdyaXRlXCIsIGRpZmYpIHx8IG1zZztcbiAgICAgICAgICByZXR1cm4gcmVkaXNcbiAgICAgICAgICAgIC53cml0ZShkaWZmKVxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICBjb25zdCBqc29uID0geyBcIkBcIjogbXNnLmpzb25bXCIjXCJdLCBvazogdHJ1ZSwgZXJyOiBudWxsIH07XG5cbiAgICAgICAgICAgICAgbXNnLmZyb20gJiZcbiAgICAgICAgICAgICAgICBtc2cuZnJvbS5zZW5kICYmXG4gICAgICAgICAgICAgICAgbXNnLmZyb20uc2VuZCh7XG4gICAgICAgICAgICAgICAgICBqc29uLFxuICAgICAgICAgICAgICAgICAgaWdub3JlTGVlY2hpbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgICBza2lwVmFsaWRhdGlvbjogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICByZXR1cm4gbXNnO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICBjb25zdCBqc29uID0geyBcIkBcIjogbXNnLmpzb25bXCIjXCJdLCBvazogZmFsc2UsIGVycjogYCR7ZXJyfWAgfTtcblxuICAgICAgICAgICAgICBtc2cuZnJvbSAmJlxuICAgICAgICAgICAgICAgIG1zZy5mcm9tLnNlbmQgJiZcbiAgICAgICAgICAgICAgICBtc2cuZnJvbS5zZW5kKHtcbiAgICAgICAgICAgICAgICAgIGpzb24sXG4gICAgICAgICAgICAgICAgICBpZ25vcmVMZWVjaGluZzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIHNraXBWYWxpZGF0aW9uOiB0cnVlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHJldHVybiBtc2c7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGVyciA9PlxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJlcnJvciBhY2NlcHRpbmcgd3JpdGVzXCIsIGVyci5zdGFjayB8fCBlcnIpXG4gICAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiBtc2c7XG4gIH0pO1xuXG4gIHJldHVybiBkYjtcbn07XG4iLCJtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzRfXzsiLCJpbXBvcnQgeyBrZXlzIH0gZnJvbSBcInJhbWRhXCI7XG5jb25zdCBmbGF0dGVuID0gcmVxdWlyZShcImZsYXRcIik7XG5cbmNvbnN0IEZJRUxEX1NJWkVfTElNSVQgPSAxMDAwMDA7XG5cbmZ1bmN0aW9uIHBvc3RVbmZsYXR0ZW4ob2JqKSB7XG4gIC8vIFRoaXMgaXMgcHJvYmFibHkgb25seSBuZWNlc3NhcnkgaWYgeW91IGFyZSBzdHVwaWQgbGlrZSBtZSBhbmQgdXNlIHRoZSBkZWZhdWx0IC4gZGVsaW1pdGVyIGZvciBmbGF0dGVuXG4gIGlmICghb2JqKSByZXR1cm4gb2JqO1xuICBsZXQgYXJyb3cgPSAob2JqLl8gJiYgb2JqLl9bXCI+XCJdKSB8fCB7fTtcblxuICBrZXlzKGFycm93KS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgIGxldCB2YWx1ZSA9IGFycm93W2tleV07XG5cbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiKSB7XG4gICAgICBsZXQgdmFsS2V5cyA9IGtleXModmFsdWUpO1xuICAgICAgbGV0IHJlbWFpbmRlciA9IHZhbEtleXNbMF07XG5cbiAgICAgIGlmIChyZW1haW5kZXIpIHtcbiAgICAgICAgbGV0IHJlYWxLZXkgPSBba2V5LCB2YWxLZXlzXS5qb2luKFwiLlwiKTtcbiAgICAgICAgbGV0IHJlYWxWYWx1ZSA9IHZhbHVlW3JlbWFpbmRlcl07XG5cbiAgICAgICAgZGVsZXRlIGFycm93W2tleV07XG4gICAgICAgIGFycm93W3JlYWxLZXldID0gcmVhbFZhbHVlO1xuICAgICAgICByZWFsVmFsdWUgPSAob2JqW2tleV0gJiYgb2JqW2tleV1bcmVtYWluZGVyXSkgfHwgbnVsbDtcbiAgICAgICAgZGVsZXRlIG9ialtrZXldO1xuICAgICAgICBvYmpbcmVhbEtleV0gPSByZWFsVmFsdWU7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAga2V5cyhvYmopLmZvckVhY2goa2V5ID0+IHtcbiAgICBpZiAoa2V5WzBdID09PSBcIi5cIikgZGVsZXRlIFtrZXldO1xuICB9KTtcbiAgcmV0dXJuIG9iajtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZyb21SZWRpcyhvYmopIHtcbiAgaWYgKCFvYmopIHJldHVybiBvYmo7XG4gIGNvbnN0IHNvcnRlZCA9IHt9O1xuXG4gIGtleXMob2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgIGlmIChrZXlbMF0gPT09IFwiLlwiKSBkZWxldGUgb2JqW2tleV07XG5cbiAgICBpZiAob2JqW2tleV0gPT09IFwifE5VTEx8XCIpIHtcbiAgICAgIG9ialtrZXldID0gbnVsbDtcbiAgICB9XG4gICAgaWYgKG9ialtrZXldID09PSBcInxVTkRFRklORUR8XCIpIHtcbiAgICAgIG9ialtrZXldID0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGlmICgvPlxcLi8udGVzdChrZXkpKSB7XG4gICAgICBvYmpba2V5XSA9IHBhcnNlRmxvYXQob2JqW2tleV0sIDEwKSB8fCBvYmpba2V5XTtcbiAgICB9XG4gICAgaWYgKG9ialtrZXldICYmIG9ialtrZXldLmxlbmd0aCA+IEZJRUxEX1NJWkVfTElNSVQpIHtcbiAgICAgIG9ialtrZXldID0gb2JqW2tleV0uc2xpY2UoMCwgRklFTERfU0laRV9MSU1JVCk7XG4gICAgICBjb25zb2xlLmxvZyhcInRydW5jYXRlZFwiLCBrZXkpO1xuICAgIH1cbiAgfSk7XG5cbiAgb2JqID0gcG9zdFVuZmxhdHRlbihmbGF0dGVuLnVuZmxhdHRlbihvYmopKTtcblxuICBPYmplY3Qua2V5cyhvYmopXG4gICAgLnNvcnQoKVxuICAgIC5mb3JFYWNoKGtleSA9PiAoc29ydGVkW2tleV0gPSBvYmpba2V5XSkpO1xuXG4gIHJldHVybiBzb3J0ZWQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0b1JlZGlzKG9iaikge1xuICBpZiAoIW9iaikgcmV0dXJuIG9iajtcbiAgb2JqID0gZmxhdHRlbihvYmopO1xuICBrZXlzKG9iaikuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICBpZiAob2JqW2tleV0gPT09IG51bGwpIHtcbiAgICAgIG9ialtrZXldID0gXCJ8TlVMTHxcIjtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBvYmpba2V5XSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBvYmpba2V5XSA9IFwifFVOREVGSU5FRHxcIjtcbiAgICB9XG4gICAgaWYgKG9ialtrZXldICYmIG9ialtrZXldLmxlbmd0aCA+IEZJRUxEX1NJWkVfTElNSVQpIHtcbiAgICAgIG9ialtrZXldID0gb2JqW2tleV0uc2xpY2UoMCwgRklFTERfU0laRV9MSU1JVCk7XG4gICAgICBjb25zb2xlLmxvZyhcInRydW5jYXRlZCBpbnB1dFwiLCBrZXkpO1xuICAgIH1cbiAgICBpZiAoa2V5WzBdID09PSBcIi5cIikgZGVsZXRlIG9ialtrZXldO1xuICB9KTtcbiAgcmV0dXJuIG9iajtcbn1cbiIsIm1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fNl9fOyIsImltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCIuL2NsaWVudFwiO1xuXG5leHBvcnQgY29uc3QgYXR0YWNoVG9HdW4gPSBHdW4gPT4gR3VuLm9uKFwiY3JlYXRlXCIsIGZ1bmN0aW9uKGRiKSB7XG4gIHRoaXMudG8ubmV4dChkYik7XG4gIGNvbnN0IHJlZGlzID0gR3VuLnJlZGlzID0gZGIucmVkaXMgPSBjcmVhdGVDbGllbnQoR3VuKTtcblxuICBkYi5vbihcImdldFwiLCBmdW5jdGlvbihyZXF1ZXN0KSB7XG4gICAgdGhpcy50by5uZXh0KHJlcXVlc3QpO1xuICAgIGNvbnN0IGRlZHVwSWQgPSByZXF1ZXN0W1wiI1wiXTtcbiAgICBjb25zdCBnZXQgPSByZXF1ZXN0LmdldDtcbiAgICBjb25zdCBzb3VsID0gZ2V0W1wiI1wiXTtcblxuICAgIHJlZGlzLmJhdGNoZWRHZXQoc291bCwgcmVzdWx0ID0+IGRiLm9uKFwiaW5cIiwge1xuICAgICAgXCJAXCI6IGRlZHVwSWQsXG4gICAgICBwdXQ6IHJlc3VsdCA/IHsgW3NvdWxdOiByZXN1bHQgfSA6IG51bGwsXG4gICAgICBlcnI6IG51bGxcbiAgICB9KSkuY2F0Y2goZXJyID0+XG4gICAgICBjb25zb2xlLmVycm9yKFwiZXJyb3JcIiwgZXJyLnN0YWNrIHx8IGVycikgfHxcbiAgICAgIGRiLm9uKFwiaW5cIiwge1xuICAgICAgICBcIkBcIjogZGVkdXBJZCxcbiAgICAgICAgcHV0OiBudWxsLFxuICAgICAgICBlcnJcbiAgICAgIH0pXG4gICAgKTtcbiAgfSk7XG5cbiAgZGIub24oXCJwdXRcIiwgZnVuY3Rpb24ocmVxdWVzdCkge1xuICAgIHRoaXMudG8ubmV4dChyZXF1ZXN0KTtcbiAgICBjb25zdCBkZWR1cElkID0gcmVxdWVzdFtcIiNcIl07XG5cbiAgICByZWRpcy53cml0ZShyZXF1ZXN0LnB1dClcbiAgICAgIC50aGVuKCgpID0+XG4gICAgICAgIGRiLm9uKFwiaW5cIiwge1xuICAgICAgICAgIFwiQFwiOiBkZWR1cElkLFxuICAgICAgICAgIG9rOiB0cnVlLFxuICAgICAgICAgIGVycjogbnVsbFxuICAgICAgICB9KVxuICAgICAgKVxuICAgICAgLmNhdGNoKGVyciA9PlxuICAgICAgICBkYi5vbihcImluXCIsIHtcbiAgICAgICAgICBcIkBcIjogZGVkdXBJZCxcbiAgICAgICAgICBvazogZmFsc2UsXG4gICAgICAgICAgZXJyOiBlcnJcbiAgICAgICAgfSlcbiAgICAgICk7XG4gIH0pO1xufSk7XG4iXSwic291cmNlUm9vdCI6IiJ9