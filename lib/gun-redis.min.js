!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("ramda"),require("redis"),require("flat")):"function"==typeof define&&define.amd?define("gun-redis",["ramda","redis","flat"],r):"object"==typeof exports?exports["gun-redis"]=r(require("ramda"),require("redis"),require("flat")):e["gun-redis"]=r(e.ramda,e.redis,e.flat)}("undefined"!=typeof self?self:this,function(e,r,t){return function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=2)}([function(r,t){r.exports=e},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createClient=void 0;var n=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};n.get||n.set?Object.defineProperty(r,t,n):r[t]=e[t]}return r.default=e,r}(t(0)),o=t(4),i=t(5);var u=/^_\..*/,c=/(\.#$)/;r.createClient=function(e){for(var r=[],t=arguments.length,f=new Array(t>1?t-1:0),a=1;a<t;a++)f[a-1]=arguments[a];var l=o.createClient.apply(void 0,f),s=function(e){return r.push(e)},p=function(e){return new Promise(function(r,t){if(!e)return r(null);l.hgetall(e,function(e,n){e?(console.error("get error",e),t(e)):r((0,i.fromRedis)(n))})})};return s(function(e,r){return console.log("modify",e,n.keys(r))}),{get:p,read:function(r){return p(r).then(function(t){var o=t?{...t}:t;return e.SEA&&-1!==r.indexOf("~")?(n.without(["_"],n.keys(o)).forEach(function(n){e.SEA.verify(e.SEA.opt.pack(t[n],n,t,r),!1,function(r){return o[n]=e.SEA.opt.unpack(r,n,t)})}),o):t})},batchedGet:function(e,r){return new Promise(function(t,n){l.hkeys(e,function(o,f){if(o)return console.error("error",o.stack||o),n(o);if(f.length<=1e4)return p(e).then(function(e){r(e),t(e)});console.log("get big soul",e,f.length);var a=f.filter(function(e){return!e.match(u)}),s=function(){return new Promise(function(t,n){var o=a.splice(0,1e4);return o.length?function(e,r){return new Promise(function(t,n){var o=r.map(function(e){return"_.>.".concat(e).replace(c,"")});return l.hmget(e,o,function(u,c){if(u)return console.error("hmget err",u.stack||u)||n(u);var f={"_.#":e};return c.forEach(function(e,r){return f[o[r]]=e}),l.hmget(e,r,function(e,o){return e?console.error("hmget err",e.stack||e)||n(e):(o.forEach(function(e,t){return f[r[t]]=e}),t((0,i.fromRedis)(f)))})})})}(e,o).then(function(e){return r(e),t()},n):t(!0)})};return function e(){return s().then(function(r){return!r&&e})}().then(function(e){t(e)}).catch(n)})})},write:function(e){return Promise.all(n.keys(e).map(function(t){return new Promise(function(o,u){var c=e[t],f=n.path(["_",">"],c)||{},a=n.keys(f);return function e(){var s=a.splice(0,1e4);if(!s.length)return o();var d={_:{"#":t,">":n.pick(s,f)},...n.pick(s,c)};return p(t).then(function(o){var c=s.filter(function(e){var r=n.prop(e,d),t=n.prop(e,o);if(r===t)return!1;var i=n.path([e,"#"],d),u=n.path([e,"#"],o);return!((i||u)&&i===u||"number"==typeof r&&parseFloat(t)===r)});if(!c.length)return e();var a={_:n.assoc(">",n.pick(c,f),d._),...n.pick(c,d)};return l.hmset(t,(0,i.toRedis)(a),function(n){n?u(n):e(),function(e,t,n){r.map(function(r){return r(e,t,n)})}(t,a,o)})})}()})}))},onChange:s,offChange:function(e){return r=n.without([e],r)}}}},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"attachToGun",{enumerable:!0,get:function(){return o.attachToGun}}),r.receiver=void 0;var n=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};n.get||n.set?Object.defineProperty(r,t,n):r[t]=e[t]}return r.default=e,r}(t(3)),o=t(7);var i=n;r.receiver=i},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.acceptWrites=r.respondToGets=void 0;var n=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};n.get||n.set?Object.defineProperty(r,t,n):r[t]=e[t]}return r.default=e,r}(t(0)),o=t(1);r.respondToGets=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=r.disableRelay,i=void 0===t||t,u=r.skipValidation,c=void 0===u||u;return function(r){var t=e.redis=e.redis||(0,o.createClient)(e);return r.onIn(function(e){var r=e.from,o=e.json,u=e.fromCluster,f=n.path(["get","#"],o),a=n.prop("#",o);return!f||u?e:t.batchedGet(f,function(e){var t,n,o,i={"#":r.msgId(),"@":a,put:e?(t={},n=f,o=e,n in t?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o,t):null};r.send({json:i,ignoreLeeching:!0,skipValidation:!e||c})}).then(function(){return i?n.assoc("noRelay",!0,e):e}).catch(function(t){var n={"#":r.msgId(),"@":a,err:"".concat(t)};return r.send({json:n,ignoreLeeching:!0,skipValidation:c}),e})}),r}};r.acceptWrites=function(e){var r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).disableRelay,t=void 0!==r&&r;return function(r){var i=e.redis=e.redis||(0,o.createClient)(e);return r.onIn(function(e){return e.fromCluster?e:e.json.put?r.getDiff(e.json.put).then(function(r){return n.keys(r).length?i.write(r).then(function(){var r={"@":e.json["#"],ok:!0,err:null};return e.from&&e.from.send&&e.from.send({json:r,noRelay:!0,ignoreLeeching:!0,skipValidation:!0}),t?n.assoc("noRelay",!0,e):e}).catch(function(r){var n={"@":e.json["#"],ok:!1,err:"".concat(r)};return e.from&&e.from.send&&e.from.send({json:n,noRelay:t,ignoreLeeching:!0,skipValidation:!0}),e}):e}).catch(function(e){return console.error("error accepting writes",e.stack||e)}):e}),r}}},function(e,t){e.exports=r},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.fromRedis=function(e){if(!e)return e;var r={};return(0,n.keys)(e).forEach(function(r){"."===r[0]&&delete e[r],"|NULL|"===e[r]&&(e[r]=null),"|UNDEFINED|"===e[r]&&(e[r]=void 0),/>\./.test(r)&&(e[r]=parseFloat(e[r],10)||e[r]),e[r]&&e[r].length>u&&(e[r]=e[r].slice(0,u),console.log("truncated",r))}),e=function(e){if(!e)return e;var r=e._&&e._[">"]||{};return(0,n.keys)(r).forEach(function(t){var i=r[t];if("object"===o(i)){var u=(0,n.keys)(i),c=u[0];if(c){var f=[t,u].join("."),a=i[c];delete r[t],r[f]=a,a=e[t]&&e[t][c]||null,delete e[t],e[f]=a}}}),(0,n.keys)(e).forEach(function(e){e[0]}),e}(i.unflatten(e)),Object.keys(e).sort().forEach(function(t){return r[t]=e[t]}),r},r.toRedis=function(e){return e?(e=i(e),(0,n.keys)(e).forEach(function(r){null===e[r]&&(e[r]="|NULL|"),void 0===o(e[r])&&(e[r]="|UNDEFINED|"),e[r]&&e[r].length>u&&(e[r]=e[r].slice(0,u),console.log("truncated input",r)),"."===r[0]&&delete e[r]}),e):e};var n=t(0);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=t(6),u=1e5},function(e,r){e.exports=t},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.attachToGun=void 0;var n=t(1);r.attachToGun=function(e){return e.on("create",function(r){this.to.next(r);var t=e.redis=r.redis=(0,n.createClient)(e);r.on("get",function(e){this.to.next(e);var n=e["#"],o=e.get["#"];t.batchedGet(o,function(e){return r.on("in",{"@":n,put:e?(t={},i=o,u=e,i in t?Object.defineProperty(t,i,{value:u,enumerable:!0,configurable:!0,writable:!0}):t[i]=u,t):null,err:null});var t,i,u}).catch(function(e){return console.error("error",e.stack||e)||r.on("in",{"@":n,put:null,err:e})})}),r.on("put",function(e){this.to.next(e);var n=e["#"];t.write(e.put).then(function(){return r.on("in",{"@":n,ok:!0,err:null})}).catch(function(e){return r.on("in",{"@":n,ok:!1,err:e})})})})}}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ndW4tcmVkaXMvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL2d1bi1yZWRpcy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9ndW4tcmVkaXMvZXh0ZXJuYWwgXCJyYW1kYVwiIiwid2VicGFjazovL2d1bi1yZWRpcy8uL3NyYy9jbGllbnQuanMiLCJ3ZWJwYWNrOi8vZ3VuLXJlZGlzLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL2d1bi1yZWRpcy8uL3NyYy9yZWNlaXZlci5qcyIsIndlYnBhY2s6Ly9ndW4tcmVkaXMvZXh0ZXJuYWwgXCJyZWRpc1wiIiwid2VicGFjazovL2d1bi1yZWRpcy8uL3NyYy9zZXJpYWxpemUuanMiLCJ3ZWJwYWNrOi8vZ3VuLXJlZGlzL2V4dGVybmFsIFwiZmxhdFwiIiwid2VicGFjazovL2d1bi1yZWRpcy8uL3NyYy9ndW4uanMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwicmVxdWlyZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJ0aGlzIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMF9fIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fNF9fIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fNl9fIiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIlIiLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsIl9yZWRpcyIsIl9zZXJpYWxpemUiLCJtZXRhUmUiLCJlZGdlUmUiLCJHdW4iLCJjaGFuZ2VTdWJzY3JpYmVycyIsIl9sZW4iLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJjb25maWciLCJBcnJheSIsIl9rZXkiLCJyZWRpcyIsImNyZWF0ZUNsaWVudCIsImFwcGx5Iiwib25DaGFuZ2UiLCJmbiIsInB1c2giLCJzb3VsIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJoZ2V0YWxsIiwiZXJyIiwicmVzIiwiY29uc29sZSIsImVycm9yIiwiZnJvbVJlZGlzIiwiZGlmZiIsImxvZyIsImtleXMiLCJyZWFkIiwidGhlbiIsInJhd0RhdGEiLCJkYXRhIiwiU0VBIiwiaW5kZXhPZiIsIndpdGhvdXQiLCJmb3JFYWNoIiwidmVyaWZ5Iiwib3B0IiwicGFjayIsInVucGFjayIsImJhdGNoZWRHZXQiLCJjYiIsImhrZXlzIiwibm9kZUtleXMiLCJzdGFjayIsImF0dHJLZXlzIiwiZmlsdGVyIiwibWF0Y2giLCJyZWFkQmF0Y2giLCJvayIsImZhaWwiLCJiYXRjaCIsInNwbGljZSIsImJhdGNoTWV0YSIsIm1hcCIsImNvbmNhdCIsInJlcGxhY2UiLCJobWdldCIsIm1ldGEiLCJvYmoiLCJfLiMiLCJ2YWwiLCJpZHgiLCJyZWFkS2V5QmF0Y2giLCJyZXN1bHQiLCJyZWFkTmV4dEJhdGNoIiwiZG9uZSIsImNhdGNoIiwid3JpdGUiLCJwdXQiLCJhbGwiLCJub2RlIiwicGF0aCIsIndyaXRlTmV4dEJhdGNoIiwidXBkYXRlZCIsIl8iLCIjIiwiPiIsInBpY2siLCJleGlzdGluZyIsIm1vZGlmaWVkS2V5cyIsInVwZGF0ZWRWYWwiLCJwcm9wIiwiZXhpc3RpbmdWYWwiLCJ1cGRhdGVkU291bCIsImV4aXN0aW5nU291bCIsInBhcnNlRmxvYXQiLCJhc3NvYyIsImhtc2V0IiwidG9SZWRpcyIsIm9yaWdpbmFsIiwibm90aWZ5Q2hhbmdlU3Vic2NyaWJlcnMiLCJvZmZDaGFuZ2UiLCJyZWNlaXZlckZucyIsIl9ndW4iLCJyZWNlaXZlciIsIl9jbGllbnQiLCJfcmVmIiwidW5kZWZpbmVkIiwiX3JlZiRkaXNhYmxlUmVsYXkiLCJkaXNhYmxlUmVsYXkiLCJfcmVmJHNraXBWYWxpZGF0aW9uIiwic2tpcFZhbGlkYXRpb24iLCJkYiIsIm9uSW4iLCJtc2ciLCJmcm9tIiwianNvbiIsImZyb21DbHVzdGVyIiwiZGVkdXBJZCIsIm1zZ0lkIiwiQCIsInNlbmQiLCJpZ25vcmVMZWVjaGluZyIsIl9yZWYzJGRpc2FibGVSZWxheSIsImdldERpZmYiLCJub1JlbGF5Iiwic29ydGVkIiwiX3JhbWRhIiwidGVzdCIsIkZJRUxEX1NJWkVfTElNSVQiLCJzbGljZSIsImFycm93IiwiX3R5cGVvZiIsInZhbEtleXMiLCJyZW1haW5kZXIiLCJyZWFsS2V5Iiwiam9pbiIsInJlYWxWYWx1ZSIsInBvc3RVbmZsYXR0ZW4iLCJmbGF0dGVuIiwidW5mbGF0dGVuIiwic29ydCIsIm9uIiwidG8iLCJuZXh0IiwicmVxdWVzdCJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsR0FDQSxpQkFBQUMsU0FBQSxpQkFBQUMsT0FDQUEsT0FBQUQsUUFBQUQsRUFBQUcsUUFBQSxTQUFBQSxRQUFBLFNBQUFBLFFBQUEsU0FDQSxtQkFBQUMsZUFBQUMsSUFDQUQsT0FBQSxxQ0FBQUosR0FDQSxpQkFBQUMsUUFDQUEsUUFBQSxhQUFBRCxFQUFBRyxRQUFBLFNBQUFBLFFBQUEsU0FBQUEsUUFBQSxTQUVBSixFQUFBLGFBQUFDLEVBQUFELEVBQUEsTUFBQUEsRUFBQSxNQUFBQSxFQUFBLE1BUkEsQ0FTQyxvQkFBQU8sVUFBQUMsS0FBQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUNELG1CQ1RBLElBQUFDLEVBQUEsR0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQVosUUFHQSxJQUFBQyxFQUFBUyxFQUFBRSxHQUFBLENBQ0FD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QzVDLElBQUssbUJBQ0grQyxNQUFNLFNBQUEvQyxHQUFHLE9BQ1hFLFFBQVFDLE1BQU0sUUFBU0gsRUFBSXdCLE9BQVN4QixJQUNwQ21GLEVBQUc4QixHQUFHLEtBQU0sQ0FDVnRCLElBQUtGLEVBQ0x4QyxJQUFLLEtBQ0xqRCxZQUtObUYsRUFBRzhCLEdBQUcsTUFBTyxTQUFTRyxHQUNwQnBMLEtBQUtrTCxHQUFHQyxLQUFLQyxHQUNiLElBQU0zQixFQUFVMkIsRUFBUSxLQUV4Qi9ILEVBQU0yRCxNQUFNb0UsRUFBUW5FLEtBQ2pCeEMsS0FBSyxrQkFDSjBFLEVBQUc4QixHQUFHLEtBQU0sQ0FDVnRCLElBQUtGLEVBQ0w1RCxJQUFJLEVBQ0o3QixJQUFLLFNBR1IrQyxNQUFNLFNBQUEvQyxHQUFHLE9BQ1JtRixFQUFHOEIsR0FBRyxLQUFNLENBQ1Z0QixJQUFLRixFQUNMNUQsSUFBSSxFQUNKN0IsSUFBS0EiLCJmaWxlIjoiZ3VuLXJlZGlzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZShcInJhbWRhXCIpLCByZXF1aXJlKFwicmVkaXNcIiksIHJlcXVpcmUoXCJmbGF0XCIpKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFwiZ3VuLXJlZGlzXCIsIFtcInJhbWRhXCIsIFwicmVkaXNcIiwgXCJmbGF0XCJdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcImd1bi1yZWRpc1wiXSA9IGZhY3RvcnkocmVxdWlyZShcInJhbWRhXCIpLCByZXF1aXJlKFwicmVkaXNcIiksIHJlcXVpcmUoXCJmbGF0XCIpKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJndW4tcmVkaXNcIl0gPSBmYWN0b3J5KHJvb3RbXCJyYW1kYVwiXSwgcm9vdFtcInJlZGlzXCJdLCByb290W1wiZmxhdFwiXSk7XG59KSh0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0aGlzLCBmdW5jdGlvbihfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX18wX18sIF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzRfXywgX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fNl9fKSB7XG5yZXR1cm4gIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDIpO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX18wX187IiwiaW1wb3J0ICogYXMgUiBmcm9tIFwicmFtZGFcIjtcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCBhcyBjcmVhdGVSZWRpc0NsaWVudCB9IGZyb20gXCJyZWRpc1wiO1xuaW1wb3J0IHsgdG9SZWRpcywgZnJvbVJlZGlzIH0gZnJvbSBcIi4vc2VyaWFsaXplXCI7XG5cbmNvbnN0IEdFVF9CQVRDSF9TSVpFID0gMTAwMDA7XG5jb25zdCBQVVRfQkFUQ0hfU0laRSA9IDEwMDAwO1xuXG5jb25zdCBtZXRhUmUgPSAvXl9cXC4uKi87XG5jb25zdCBlZGdlUmUgPSAvKFxcLiMkKS87XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVDbGllbnQgPSAoR3VuLCAuLi5jb25maWcpID0+IHtcbiAgbGV0IGNoYW5nZVN1YnNjcmliZXJzID0gW107XG4gIGNvbnN0IHJlZGlzID0gY3JlYXRlUmVkaXNDbGllbnQoLi4uY29uZmlnKTtcbiAgY29uc3Qgbm90aWZ5Q2hhbmdlU3Vic2NyaWJlcnMgPSAoc291bCwgZGlmZiwgb3JpZ2luYWwpID0+XG4gICAgY2hhbmdlU3Vic2NyaWJlcnMubWFwKGZuID0+IGZuKHNvdWwsIGRpZmYsIG9yaWdpbmFsKSk7XG4gIGNvbnN0IG9uQ2hhbmdlID0gZm4gPT4gY2hhbmdlU3Vic2NyaWJlcnMucHVzaChmbik7XG4gIGNvbnN0IG9mZkNoYW5nZSA9IGZuID0+XG4gICAgKGNoYW5nZVN1YnNjcmliZXJzID0gUi53aXRob3V0KFtmbl0sIGNoYW5nZVN1YnNjcmliZXJzKSk7XG5cbiAgY29uc3QgZ2V0ID0gc291bCA9PlxuICAgIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGlmICghc291bCkgcmV0dXJuIHJlc29sdmUobnVsbCk7XG4gICAgICByZWRpcy5oZ2V0YWxsKHNvdWwsIGZ1bmN0aW9uKGVyciwgcmVzKSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiZ2V0IGVycm9yXCIsIGVycik7XG4gICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzb2x2ZShmcm9tUmVkaXMocmVzKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9KTtcblxuICBjb25zdCByZWFkID0gc291bCA9PlxuICAgIGdldChzb3VsKS50aGVuKHJhd0RhdGEgPT4ge1xuICAgICAgY29uc3QgZGF0YSA9IHJhd0RhdGEgPyB7IC4uLnJhd0RhdGEgfSA6IHJhd0RhdGE7XG5cbiAgICAgIGlmICghR3VuLlNFQSB8fCBzb3VsLmluZGV4T2YoXCJ+XCIpID09PSAtMSkgcmV0dXJuIHJhd0RhdGE7XG4gICAgICBSLndpdGhvdXQoW1wiX1wiXSwgUi5rZXlzKGRhdGEpKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgIEd1bi5TRUEudmVyaWZ5KFxuICAgICAgICAgIEd1bi5TRUEub3B0LnBhY2socmF3RGF0YVtrZXldLCBrZXksIHJhd0RhdGEsIHNvdWwpLFxuICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgIHJlcyA9PiAoZGF0YVtrZXldID0gR3VuLlNFQS5vcHQudW5wYWNrKHJlcywga2V5LCByYXdEYXRhKSlcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSk7XG5cbiAgY29uc3QgcmVhZEtleUJhdGNoID0gKHNvdWwsIGJhdGNoKSA9PlxuICAgIG5ldyBQcm9taXNlKChvaywgZmFpbCkgPT4ge1xuICAgICAgY29uc3QgYmF0Y2hNZXRhID0gYmF0Y2gubWFwKGtleSA9PiBgXy4+LiR7a2V5fWAucmVwbGFjZShlZGdlUmUsIFwiXCIpKTtcblxuICAgICAgcmV0dXJuIHJlZGlzLmhtZ2V0KHNvdWwsIGJhdGNoTWV0YSwgKGVyciwgbWV0YSkgPT4ge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoXCJobWdldCBlcnJcIiwgZXJyLnN0YWNrIHx8IGVycikgfHwgZmFpbChlcnIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG9iaiA9IHtcbiAgICAgICAgICBcIl8uI1wiOiBzb3VsXG4gICAgICAgIH07XG5cbiAgICAgICAgbWV0YS5mb3JFYWNoKCh2YWwsIGlkeCkgPT4gKG9ialtiYXRjaE1ldGFbaWR4XV0gPSB2YWwpKTtcbiAgICAgICAgcmV0dXJuIHJlZGlzLmhtZ2V0KHNvdWwsIGJhdGNoLCAoZXJyLCByZXMpID0+IHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS5lcnJvcihcImhtZ2V0IGVyclwiLCBlcnIuc3RhY2sgfHwgZXJyKSB8fCBmYWlsKGVycik7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlcy5mb3JFYWNoKCh2YWwsIGlkeCkgPT4gKG9ialtiYXRjaFtpZHhdXSA9IHZhbCkpO1xuICAgICAgICAgIHJldHVybiBvayhmcm9tUmVkaXMob2JqKSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgY29uc3QgYmF0Y2hlZEdldCA9IChzb3VsLCBjYikgPT5cbiAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICByZWRpcy5oa2V5cyhzb3VsLCAoZXJyLCBub2RlS2V5cykgPT4ge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcImVycm9yXCIsIGVyci5zdGFjayB8fCBlcnIpO1xuICAgICAgICAgIHJldHVybiByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm9kZUtleXMubGVuZ3RoIDw9IEdFVF9CQVRDSF9TSVpFKSB7XG4gICAgICAgICAgcmV0dXJuIGdldChzb3VsKS50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgICBjYihyZXMpO1xuICAgICAgICAgICAgcmVzb2x2ZShyZXMpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKFwiZ2V0IGJpZyBzb3VsXCIsIHNvdWwsIG5vZGVLZXlzLmxlbmd0aCk7XG4gICAgICAgIGNvbnN0IGF0dHJLZXlzID0gbm9kZUtleXMuZmlsdGVyKGtleSA9PiAha2V5Lm1hdGNoKG1ldGFSZSkpO1xuICAgICAgICBjb25zdCByZWFkQmF0Y2ggPSAoKSA9PlxuICAgICAgICAgIG5ldyBQcm9taXNlKChvaywgZmFpbCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYmF0Y2ggPSBhdHRyS2V5cy5zcGxpY2UoMCwgR0VUX0JBVENIX1NJWkUpO1xuXG4gICAgICAgICAgICBpZiAoIWJhdGNoLmxlbmd0aCkgcmV0dXJuIG9rKHRydWUpO1xuXG4gICAgICAgICAgICByZXR1cm4gcmVhZEtleUJhdGNoKHNvdWwsIGJhdGNoKS50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgIGNiKHJlc3VsdCk7XG4gICAgICAgICAgICAgIHJldHVybiBvaygpO1xuICAgICAgICAgICAgfSwgZmFpbCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHJlYWROZXh0QmF0Y2ggPSAoKSA9PlxuICAgICAgICAgIHJlYWRCYXRjaCgpLnRoZW4oZG9uZSA9PiAhZG9uZSAmJiByZWFkTmV4dEJhdGNoKTtcblxuICAgICAgICByZXR1cm4gcmVhZE5leHRCYXRjaCgpXG4gICAgICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgICAgIHJlc29sdmUocmVzKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaChyZWplY3QpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgY29uc3Qgd3JpdGUgPSBwdXQgPT5cbiAgICBQcm9taXNlLmFsbChcbiAgICAgIFIua2V5cyhwdXQpLm1hcChcbiAgICAgICAgc291bCA9PlxuICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBwdXRbc291bF07XG4gICAgICAgICAgICBjb25zdCBtZXRhID0gUi5wYXRoKFtcIl9cIiwgXCI+XCJdLCBub2RlKSB8fCB7fTtcbiAgICAgICAgICAgIGNvbnN0IG5vZGVLZXlzID0gUi5rZXlzKG1ldGEpO1xuICAgICAgICAgICAgY29uc3Qgd3JpdGVOZXh0QmF0Y2ggPSAoKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IGJhdGNoID0gbm9kZUtleXMuc3BsaWNlKDAsIFBVVF9CQVRDSF9TSVpFKTtcblxuICAgICAgICAgICAgICBpZiAoIWJhdGNoLmxlbmd0aCkgcmV0dXJuIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZCA9IHtcbiAgICAgICAgICAgICAgICBfOiB7XG4gICAgICAgICAgICAgICAgICBcIiNcIjogc291bCxcbiAgICAgICAgICAgICAgICAgIFwiPlwiOiBSLnBpY2soYmF0Y2gsIG1ldGEpXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAuLi5SLnBpY2soYmF0Y2gsIG5vZGUpXG4gICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgLy8gcmV0dXJuIHJlYWRLZXlCYXRjaChzb3VsLCBiYXRjaCkudGhlbihleGlzdGluZyA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiBnZXQoc291bCkudGhlbihleGlzdGluZyA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbW9kaWZpZWRLZXlzID0gYmF0Y2guZmlsdGVyKGtleSA9PiB7XG4gICAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVkVmFsID0gUi5wcm9wKGtleSwgdXBkYXRlZCk7XG4gICAgICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ1ZhbCA9IFIucHJvcChrZXksIGV4aXN0aW5nKTtcblxuICAgICAgICAgICAgICAgICAgaWYgKHVwZGF0ZWRWYWwgPT09IGV4aXN0aW5nVmFsKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVkU291bCA9IFIucGF0aChba2V5LCBcIiNcIl0sIHVwZGF0ZWQpO1xuICAgICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdTb3VsID0gUi5wYXRoKFtrZXksIFwiI1wiXSwgZXhpc3RpbmcpO1xuXG4gICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgICh1cGRhdGVkU291bCB8fCBleGlzdGluZ1NvdWwpICYmXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRTb3VsID09PSBleGlzdGluZ1NvdWxcbiAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgIHR5cGVvZiB1cGRhdGVkVmFsID09PSBcIm51bWJlclwiICYmXG4gICAgICAgICAgICAgICAgICAgIHBhcnNlRmxvYXQoZXhpc3RpbmdWYWwpID09PSB1cGRhdGVkVmFsXG4gICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmICghbW9kaWZpZWRLZXlzLmxlbmd0aCkgcmV0dXJuIHdyaXRlTmV4dEJhdGNoKCk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBkaWZmID0ge1xuICAgICAgICAgICAgICAgICAgXzogUi5hc3NvYyhcIj5cIiwgUi5waWNrKG1vZGlmaWVkS2V5cywgbWV0YSksIHVwZGF0ZWQuXyksXG4gICAgICAgICAgICAgICAgICAuLi5SLnBpY2sobW9kaWZpZWRLZXlzLCB1cGRhdGVkKVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVkaXMuaG1zZXQoc291bCwgdG9SZWRpcyhkaWZmKSwgZXJyID0+IHtcbiAgICAgICAgICAgICAgICAgIGVyciA/IHJlamVjdChlcnIpIDogd3JpdGVOZXh0QmF0Y2goKTtcbiAgICAgICAgICAgICAgICAgIG5vdGlmeUNoYW5nZVN1YnNjcmliZXJzKHNvdWwsIGRpZmYsIGV4aXN0aW5nKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXR1cm4gd3JpdGVOZXh0QmF0Y2goKTtcbiAgICAgICAgICB9KVxuICAgICAgKVxuICAgICk7XG5cbiAgb25DaGFuZ2UoKHNvdWwsIGRpZmYpID0+IGNvbnNvbGUubG9nKFwibW9kaWZ5XCIsIHNvdWwsIFIua2V5cyhkaWZmKSkpO1xuXG4gIHJldHVybiB7IGdldCwgcmVhZCwgYmF0Y2hlZEdldCwgd3JpdGUsIG9uQ2hhbmdlLCBvZmZDaGFuZ2UgfTtcbn07XG4iLCJpbXBvcnQgKiBhcyByZWNlaXZlckZucyBmcm9tIFwiLi9yZWNlaXZlclwiO1xuZXhwb3J0IHsgYXR0YWNoVG9HdW4gfSBmcm9tIFwiLi9ndW5cIjtcblxuZXhwb3J0IGNvbnN0IHJlY2VpdmVyID0gcmVjZWl2ZXJGbnM7XG4iLCJpbXBvcnQgKiBhcyBSIGZyb20gXCJyYW1kYVwiO1xuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSBcIi4vY2xpZW50XCI7XG5cbmV4cG9ydCBjb25zdCByZXNwb25kVG9HZXRzID0gKFxuICBHdW4sXG4gIHsgZGlzYWJsZVJlbGF5ID0gdHJ1ZSwgc2tpcFZhbGlkYXRpb24gPSB0cnVlIH0gPSB7fVxuKSA9PiBkYiA9PiB7XG4gIGNvbnN0IHJlZGlzID0gKEd1bi5yZWRpcyA9IEd1bi5yZWRpcyB8fCBjcmVhdGVDbGllbnQoR3VuKSk7XG5cbiAgZGIub25Jbihtc2cgPT4ge1xuICAgIGNvbnN0IHsgZnJvbSwganNvbiwgZnJvbUNsdXN0ZXIgfSA9IG1zZztcbiAgICBjb25zdCBzb3VsID0gUi5wYXRoKFtcImdldFwiLCBcIiNcIl0sIGpzb24pO1xuICAgIGNvbnN0IGRlZHVwSWQgPSBSLnByb3AoXCIjXCIsIGpzb24pO1xuXG4gICAgaWYgKCFzb3VsIHx8IGZyb21DbHVzdGVyKSByZXR1cm4gbXNnO1xuICAgIHJldHVybiByZWRpc1xuICAgICAgLmJhdGNoZWRHZXQoc291bCwgcmVzdWx0ID0+IHtcbiAgICAgICAgY29uc3QganNvbiA9IHtcbiAgICAgICAgICBcIiNcIjogZnJvbS5tc2dJZCgpLFxuICAgICAgICAgIFwiQFwiOiBkZWR1cElkLFxuICAgICAgICAgIHB1dDogcmVzdWx0ID8geyBbc291bF06IHJlc3VsdCB9IDogbnVsbFxuICAgICAgICB9O1xuXG4gICAgICAgIGZyb20uc2VuZCh7XG4gICAgICAgICAganNvbixcbiAgICAgICAgICBpZ25vcmVMZWVjaGluZzogdHJ1ZSxcbiAgICAgICAgICBza2lwVmFsaWRhdGlvbjogIXJlc3VsdCB8fCBza2lwVmFsaWRhdGlvblxuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgICAudGhlbigoKSA9PiAoZGlzYWJsZVJlbGF5ID8gUi5hc3NvYyhcIm5vUmVsYXlcIiwgdHJ1ZSwgbXNnKSA6IG1zZykpXG4gICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgY29uc3QganNvbiA9IHtcbiAgICAgICAgICBcIiNcIjogZnJvbS5tc2dJZCgpLFxuICAgICAgICAgIFwiQFwiOiBkZWR1cElkLFxuICAgICAgICAgIGVycjogYCR7ZXJyfWBcbiAgICAgICAgfTtcblxuICAgICAgICBmcm9tLnNlbmQoeyBqc29uLCBpZ25vcmVMZWVjaGluZzogdHJ1ZSwgc2tpcFZhbGlkYXRpb24gfSk7XG4gICAgICAgIHJldHVybiBtc2c7XG4gICAgICB9KTtcbiAgfSk7XG5cbiAgcmV0dXJuIGRiO1xufTtcblxuZXhwb3J0IGNvbnN0IGFjY2VwdFdyaXRlcyA9IChHdW4sIHsgZGlzYWJsZVJlbGF5ID0gZmFsc2UgfSA9IHt9KSA9PiBkYiA9PiB7XG4gIGNvbnN0IHJlZGlzID0gKEd1bi5yZWRpcyA9IEd1bi5yZWRpcyB8fCBjcmVhdGVDbGllbnQoR3VuKSk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcblxuICBkYi5vbkluKG1zZyA9PiB7XG4gICAgaWYgKG1zZy5mcm9tQ2x1c3RlcikgcmV0dXJuIG1zZztcbiAgICBpZiAobXNnLmpzb24ucHV0KSB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLmdldERpZmYobXNnLmpzb24ucHV0KVxuICAgICAgICAudGhlbihkaWZmID0+IHtcbiAgICAgICAgICBjb25zdCBzb3VscyA9IFIua2V5cyhkaWZmKTtcblxuICAgICAgICAgIGlmICghc291bHMubGVuZ3RoKSByZXR1cm4gbXNnO1xuICAgICAgICAgIC8vIHJldHVybiBjb25zb2xlLmxvZyhcIndvdWxkIHdyaXRlXCIsIGRpZmYpIHx8IG1zZztcbiAgICAgICAgICByZXR1cm4gcmVkaXNcbiAgICAgICAgICAgIC53cml0ZShkaWZmKVxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICBjb25zdCBqc29uID0geyBcIkBcIjogbXNnLmpzb25bXCIjXCJdLCBvazogdHJ1ZSwgZXJyOiBudWxsIH07XG5cbiAgICAgICAgICAgICAgbXNnLmZyb20gJiZcbiAgICAgICAgICAgICAgICBtc2cuZnJvbS5zZW5kICYmXG4gICAgICAgICAgICAgICAgbXNnLmZyb20uc2VuZCh7XG4gICAgICAgICAgICAgICAgICBqc29uLFxuICAgICAgICAgICAgICAgICAgbm9SZWxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIGlnbm9yZUxlZWNoaW5nOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgc2tpcFZhbGlkYXRpb246IHRydWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgcmV0dXJuIGRpc2FibGVSZWxheSA/IFIuYXNzb2MoXCJub1JlbGF5XCIsIHRydWUsIG1zZykgOiBtc2c7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IGpzb24gPSB7IFwiQFwiOiBtc2cuanNvbltcIiNcIl0sIG9rOiBmYWxzZSwgZXJyOiBgJHtlcnJ9YCB9O1xuXG4gICAgICAgICAgICAgIG1zZy5mcm9tICYmXG4gICAgICAgICAgICAgICAgbXNnLmZyb20uc2VuZCAmJlxuICAgICAgICAgICAgICAgIG1zZy5mcm9tLnNlbmQoe1xuICAgICAgICAgICAgICAgICAganNvbixcbiAgICAgICAgICAgICAgICAgIG5vUmVsYXk6IGRpc2FibGVSZWxheSxcbiAgICAgICAgICAgICAgICAgIGlnbm9yZUxlZWNoaW5nOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgc2tpcFZhbGlkYXRpb246IHRydWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgcmV0dXJuIG1zZztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZXJyID0+XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcImVycm9yIGFjY2VwdGluZyB3cml0ZXNcIiwgZXJyLnN0YWNrIHx8IGVycilcbiAgICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIG1zZztcbiAgfSk7XG5cbiAgcmV0dXJuIGRiO1xufTtcbiIsIm1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fNF9fOyIsImltcG9ydCB7IGtleXMgfSBmcm9tIFwicmFtZGFcIjtcbmNvbnN0IGZsYXR0ZW4gPSByZXF1aXJlKFwiZmxhdFwiKTtcblxuY29uc3QgRklFTERfU0laRV9MSU1JVCA9IDEwMDAwMDtcblxuZnVuY3Rpb24gcG9zdFVuZmxhdHRlbihvYmopIHtcbiAgLy8gVGhpcyBpcyBwcm9iYWJseSBvbmx5IG5lY2Vzc2FyeSBpZiB5b3UgYXJlIHN0dXBpZCBsaWtlIG1lIGFuZCB1c2UgdGhlIGRlZmF1bHQgLiBkZWxpbWl0ZXIgZm9yIGZsYXR0ZW5cbiAgaWYgKCFvYmopIHJldHVybiBvYmo7XG4gIGxldCBhcnJvdyA9IChvYmouXyAmJiBvYmouX1tcIj5cIl0pIHx8IHt9O1xuXG4gIGtleXMoYXJyb3cpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG4gICAgbGV0IHZhbHVlID0gYXJyb3dba2V5XTtcblxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgIGxldCB2YWxLZXlzID0ga2V5cyh2YWx1ZSk7XG4gICAgICBsZXQgcmVtYWluZGVyID0gdmFsS2V5c1swXTtcblxuICAgICAgaWYgKHJlbWFpbmRlcikge1xuICAgICAgICBsZXQgcmVhbEtleSA9IFtrZXksIHZhbEtleXNdLmpvaW4oXCIuXCIpO1xuICAgICAgICBsZXQgcmVhbFZhbHVlID0gdmFsdWVbcmVtYWluZGVyXTtcblxuICAgICAgICBkZWxldGUgYXJyb3dba2V5XTtcbiAgICAgICAgYXJyb3dbcmVhbEtleV0gPSByZWFsVmFsdWU7XG4gICAgICAgIHJlYWxWYWx1ZSA9IChvYmpba2V5XSAmJiBvYmpba2V5XVtyZW1haW5kZXJdKSB8fCBudWxsO1xuICAgICAgICBkZWxldGUgb2JqW2tleV07XG4gICAgICAgIG9ialtyZWFsS2V5XSA9IHJlYWxWYWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuICBrZXlzKG9iaikuZm9yRWFjaChrZXkgPT4ge1xuICAgIGlmIChrZXlbMF0gPT09IFwiLlwiKSBkZWxldGUgW2tleV07XG4gIH0pO1xuICByZXR1cm4gb2JqO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZnJvbVJlZGlzKG9iaikge1xuICBpZiAoIW9iaikgcmV0dXJuIG9iajtcbiAgY29uc3Qgc29ydGVkID0ge307XG5cbiAga2V5cyhvYmopLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG4gICAgaWYgKGtleVswXSA9PT0gXCIuXCIpIGRlbGV0ZSBvYmpba2V5XTtcblxuICAgIGlmIChvYmpba2V5XSA9PT0gXCJ8TlVMTHxcIikge1xuICAgICAgb2JqW2tleV0gPSBudWxsO1xuICAgIH1cbiAgICBpZiAob2JqW2tleV0gPT09IFwifFVOREVGSU5FRHxcIikge1xuICAgICAgb2JqW2tleV0gPSB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgaWYgKC8+XFwuLy50ZXN0KGtleSkpIHtcbiAgICAgIG9ialtrZXldID0gcGFyc2VGbG9hdChvYmpba2V5XSwgMTApIHx8IG9ialtrZXldO1xuICAgIH1cbiAgICBpZiAob2JqW2tleV0gJiYgb2JqW2tleV0ubGVuZ3RoID4gRklFTERfU0laRV9MSU1JVCkge1xuICAgICAgb2JqW2tleV0gPSBvYmpba2V5XS5zbGljZSgwLCBGSUVMRF9TSVpFX0xJTUlUKTtcbiAgICAgIGNvbnNvbGUubG9nKFwidHJ1bmNhdGVkXCIsIGtleSk7XG4gICAgfVxuICB9KTtcblxuICBvYmogPSBwb3N0VW5mbGF0dGVuKGZsYXR0ZW4udW5mbGF0dGVuKG9iaikpO1xuXG4gIE9iamVjdC5rZXlzKG9iailcbiAgICAuc29ydCgpXG4gICAgLmZvckVhY2goa2V5ID0+IChzb3J0ZWRba2V5XSA9IG9ialtrZXldKSk7XG5cbiAgcmV0dXJuIHNvcnRlZDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRvUmVkaXMob2JqKSB7XG4gIGlmICghb2JqKSByZXR1cm4gb2JqO1xuICBvYmogPSBmbGF0dGVuKG9iaik7XG4gIGtleXMob2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgIGlmIChvYmpba2V5XSA9PT0gbnVsbCkge1xuICAgICAgb2JqW2tleV0gPSBcInxOVUxMfFwiO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIG9ialtrZXldID09PSB1bmRlZmluZWQpIHtcbiAgICAgIG9ialtrZXldID0gXCJ8VU5ERUZJTkVEfFwiO1xuICAgIH1cbiAgICBpZiAob2JqW2tleV0gJiYgb2JqW2tleV0ubGVuZ3RoID4gRklFTERfU0laRV9MSU1JVCkge1xuICAgICAgb2JqW2tleV0gPSBvYmpba2V5XS5zbGljZSgwLCBGSUVMRF9TSVpFX0xJTUlUKTtcbiAgICAgIGNvbnNvbGUubG9nKFwidHJ1bmNhdGVkIGlucHV0XCIsIGtleSk7XG4gICAgfVxuICAgIGlmIChrZXlbMF0gPT09IFwiLlwiKSBkZWxldGUgb2JqW2tleV07XG4gIH0pO1xuICByZXR1cm4gb2JqO1xufVxuIiwibW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX182X187IiwiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSBcIi4vY2xpZW50XCI7XG5cbmV4cG9ydCBjb25zdCBhdHRhY2hUb0d1biA9IEd1biA9PiBHdW4ub24oXCJjcmVhdGVcIiwgZnVuY3Rpb24oZGIpIHtcbiAgdGhpcy50by5uZXh0KGRiKTtcbiAgY29uc3QgcmVkaXMgPSBHdW4ucmVkaXMgPSBkYi5yZWRpcyA9IGNyZWF0ZUNsaWVudChHdW4pO1xuXG4gIGRiLm9uKFwiZ2V0XCIsIGZ1bmN0aW9uKHJlcXVlc3QpIHtcbiAgICB0aGlzLnRvLm5leHQocmVxdWVzdCk7XG4gICAgY29uc3QgZGVkdXBJZCA9IHJlcXVlc3RbXCIjXCJdO1xuICAgIGNvbnN0IGdldCA9IHJlcXVlc3QuZ2V0O1xuICAgIGNvbnN0IHNvdWwgPSBnZXRbXCIjXCJdO1xuXG4gICAgcmVkaXMuYmF0Y2hlZEdldChzb3VsLCByZXN1bHQgPT4gZGIub24oXCJpblwiLCB7XG4gICAgICBcIkBcIjogZGVkdXBJZCxcbiAgICAgIHB1dDogcmVzdWx0ID8geyBbc291bF06IHJlc3VsdCB9IDogbnVsbCxcbiAgICAgIGVycjogbnVsbFxuICAgIH0pKS5jYXRjaChlcnIgPT5cbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJlcnJvclwiLCBlcnIuc3RhY2sgfHwgZXJyKSB8fFxuICAgICAgZGIub24oXCJpblwiLCB7XG4gICAgICAgIFwiQFwiOiBkZWR1cElkLFxuICAgICAgICBwdXQ6IG51bGwsXG4gICAgICAgIGVyclxuICAgICAgfSlcbiAgICApO1xuICB9KTtcblxuICBkYi5vbihcInB1dFwiLCBmdW5jdGlvbihyZXF1ZXN0KSB7XG4gICAgdGhpcy50by5uZXh0KHJlcXVlc3QpO1xuICAgIGNvbnN0IGRlZHVwSWQgPSByZXF1ZXN0W1wiI1wiXTtcblxuICAgIHJlZGlzLndyaXRlKHJlcXVlc3QucHV0KVxuICAgICAgLnRoZW4oKCkgPT5cbiAgICAgICAgZGIub24oXCJpblwiLCB7XG4gICAgICAgICAgXCJAXCI6IGRlZHVwSWQsXG4gICAgICAgICAgb2s6IHRydWUsXG4gICAgICAgICAgZXJyOiBudWxsXG4gICAgICAgIH0pXG4gICAgICApXG4gICAgICAuY2F0Y2goZXJyID0+XG4gICAgICAgIGRiLm9uKFwiaW5cIiwge1xuICAgICAgICAgIFwiQFwiOiBkZWR1cElkLFxuICAgICAgICAgIG9rOiBmYWxzZSxcbiAgICAgICAgICBlcnI6IGVyclxuICAgICAgICB9KVxuICAgICAgKTtcbiAgfSk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiIn0=