!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("ramda"),require("redis"),require("flat")):"function"==typeof define&&define.amd?define("gun-redis",["ramda","redis","flat"],r):"object"==typeof exports?exports["gun-redis"]=r(require("ramda"),require("redis"),require("flat")):e["gun-redis"]=r(e.ramda,e.redis,e.flat)}("undefined"!=typeof self?self:this,function(e,r,t){return function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=2)}([function(r,t){r.exports=e},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createClient=void 0;var n=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};n.get||n.set?Object.defineProperty(r,t,n):r[t]=e[t]}return r.default=e,r}(t(0)),o=t(4),i=t(5);var u=/^_\..*/,c=/(\.#$)/;r.createClient=function(e){for(var r=[],t=arguments.length,f=new Array(t>1?t-1:0),a=1;a<t;a++)f[a-1]=arguments[a];var l=o.createClient.apply(void 0,f),s=function(e){return new Promise(function(r,t){if(!e)return r(null);l.hgetall(e,function(e,n){e?(console.error("get error",e),t(e)):r((0,i.fromRedis)(n))})})};return{get:s,read:function(r){return s(r).then(function(t){var o=t?{...t}:t;return e.SEA&&-1!==r.indexOf("~")?(n.without(["_"],n.keys(o)).forEach(function(n){e.SEA.verify(e.SEA.opt.pack(t[n],n,t,r),!1,function(r){return o[n]=e.SEA.opt.unpack(r,n,t)})}),o):t})},batchedGet:function(e,r){return new Promise(function(t,n){l.hkeys(e,function(o,f){if(o)return console.error("error",o.stack||o),n(o);if(f.length<=1e4)return s(e).then(function(e){r(e),t(e)});console.log("get big soul",e,f.length);var a=f.filter(function(e){return!e.match(u)}),p=function(){return new Promise(function(t,n){var o=a.splice(0,1e4);return o.length?function(e,r){return new Promise(function(t,n){var o=r.map(function(e){return"_.>.".concat(e).replace(c,"")});return l.hmget(e,o,function(u,c){if(u)return console.error("hmget err",u.stack||u)||n(u);var f={"_.#":e};return c.forEach(function(e,r){return f[o[r]]=e}),l.hmget(e,r,function(e,o){return e?console.error("hmget err",e.stack||e)||n(e):(o.forEach(function(e,t){return f[r[t]]=e}),t((0,i.fromRedis)(f)))})})})}(e,o).then(function(e){return r(e),t()},n):t(!0)})};return function e(){return p().then(function(r){return!r&&e})}().then(function(e){t(e)}).catch(n)})})},write:function(e){return Promise.all(n.keys(e).map(function(t){return new Promise(function(o,u){var c=e[t],f=n.path(["_",">"],c)||{},a=n.keys(f);return function e(){var p=a.splice(0,1e4);if(!p.length)return o();var d={_:{"#":t,">":n.pick(p,f)},...n.pick(p,c)};return s(t).then(function(o){var c=p.filter(function(e){var r=n.prop(e,d),t=n.prop(e,o);if(r===t)return!1;var i=n.path([e,"#"],d),u=n.path([e,"#"],o);return!((i||u)&&i===u||"number"==typeof r&&parseFloat(t)===r)});if(!c.length)return e();var a={_:n.assoc(">",n.pick(c,f),d._),...n.pick(c,d)};return l.hmset(t,(0,i.toRedis)(a),function(n){n?u(n):e(),function(e,t,n){r.map(function(r){return r(e,t,n)})}(t,a,o)})})}()})}))},onChange:function(e){return r.push(e)},offChange:function(e){return r=n.without([e],r)}}}},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"attachToGun",{enumerable:!0,get:function(){return o.attachToGun}}),r.receiver=void 0;var n=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};n.get||n.set?Object.defineProperty(r,t,n):r[t]=e[t]}return r.default=e,r}(t(3)),o=t(7);var i=n;r.receiver=i},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.acceptWrites=r.respondToGets=void 0;var n=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};n.get||n.set?Object.defineProperty(r,t,n):r[t]=e[t]}return r.default=e,r}(t(0)),o=t(1);r.respondToGets=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=r.disableRelay,i=void 0===t||t,u=r.skipValidation,c=void 0===u||u;return function(r){var t=e.redis=e.redis||(0,o.createClient)(e);return r.onIn(function(e){var r=e.from,o=e.json,u=e.fromCluster,f=n.path(["get","#"],o),a=n.prop("#",o);return!f||u?e:t.batchedGet(f,function(e){var t,n,o,i={"#":r.msgId(),"@":a,put:e?(t={},n=f,o=e,n in t?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o,t):null};r.send({json:i,ignoreLeeching:!0,skipValidation:!e||c})}).then(function(){return i?n.assoc("noRelay",!0,e):e}).catch(function(t){var n={"#":r.msgId(),"@":a,err:"".concat(t)};return r.send({json:n,ignoreLeeching:!0,skipValidation:c}),e})}),r}};r.acceptWrites=function(e){var r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).disableRelay,t=void 0!==r&&r;return function(r){var i=e.redis=e.redis||(0,o.createClient)(e);return r.onIn(function(e){return e.fromCluster?e:e.json.put?r.getDiff(e.json.put).then(function(r){return n.keys(r).length?i.write(r).then(function(){var r={"@":e.json["#"],ok:!0,err:null};return e.from&&e.from.send&&e.from.send({json:r,noRelay:!0,ignoreLeeching:!0,skipValidation:!0}),t?n.assoc("noRelay",!0,e):e}).catch(function(r){var n={"@":e.json["#"],ok:!1,err:"".concat(r)};return e.from&&e.from.send&&e.from.send({json:n,noRelay:t,ignoreLeeching:!0,skipValidation:!0}),e}):e}).catch(function(e){return console.error("error accepting writes",e.stack||e)}):e}),r}}},function(e,t){e.exports=r},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.fromRedis=function(e){if(!e)return e;var r={};return(0,n.keys)(e).forEach(function(r){"."===r[0]&&delete e[r],"|NULL|"===e[r]&&(e[r]=null),"|UNDEFINED|"===e[r]&&(e[r]=void 0),/>\./.test(r)&&(e[r]=parseFloat(e[r],10)||e[r]),e[r]&&e[r].length>u&&(e[r]=e[r].slice(0,u),console.log("truncated",r))}),e=function(e){if(!e)return e;var r=e._&&e._[">"]||{};return(0,n.keys)(r).forEach(function(t){var i=r[t];if("object"===o(i)){var u=(0,n.keys)(i),c=u[0];if(c){var f=[t,u].join("."),a=i[c];delete r[t],r[f]=a,a=e[t]&&e[t][c]||null,delete e[t],e[f]=a}}}),(0,n.keys)(e).forEach(function(e){e[0]}),e}(i.unflatten(e,{object:!0})),Object.keys(e).sort().forEach(function(t){return r[t]=e[t]}),r},r.toRedis=function(e){return e?(e=i(e),(0,n.keys)(e).forEach(function(r){null===e[r]&&(e[r]="|NULL|"),void 0===o(e[r])&&(e[r]="|UNDEFINED|"),e[r]&&e[r].length>u&&(e[r]=e[r].slice(0,u),console.log("truncated input",r)),"."===r[0]&&delete e[r]}),e):e};var n=t(0);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=t(6),u=1e5},function(e,r){e.exports=t},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.attachToGun=void 0;var n=t(1);r.attachToGun=function(e){return e.on("create",function(r){this.to.next(r);var t=e.redis=r.redis=(0,n.createClient)(e);r.on("get",function(e){this.to.next(e);var n=e["#"],o=e.get["#"];t.batchedGet(o,function(e){return r.on("in",{"@":n,put:e?(t={},i=o,u=e,i in t?Object.defineProperty(t,i,{value:u,enumerable:!0,configurable:!0,writable:!0}):t[i]=u,t):null,err:null});var t,i,u}).catch(function(e){return console.error("error",e.stack||e)||r.on("in",{"@":n,put:null,err:e})})}),r.on("put",function(e){this.to.next(e);var n=e["#"];t.write(e.put).then(function(){return r.on("in",{"@":n,ok:!0,err:null})}).catch(function(e){return r.on("in",{"@":n,ok:!1,err:e})})})})}}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ndW4tcmVkaXMvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL2d1bi1yZWRpcy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9ndW4tcmVkaXMvZXh0ZXJuYWwgXCJyYW1kYVwiIiwid2VicGFjazovL2d1bi1yZWRpcy8uL3NyYy9jbGllbnQuanMiLCJ3ZWJwYWNrOi8vZ3VuLXJlZGlzLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL2d1bi1yZWRpcy8uL3NyYy9yZWNlaXZlci5qcyIsIndlYnBhY2s6Ly9ndW4tcmVkaXMvZXh0ZXJuYWwgXCJyZWRpc1wiIiwid2VicGFjazovL2d1bi1yZWRpcy8uL3NyYy9zZXJpYWxpemUuanMiLCJ3ZWJwYWNrOi8vZ3VuLXJlZGlzL2V4dGVybmFsIFwiZmxhdFwiIiwid2VicGFjazovL2d1bi1yZWRpcy8uL3NyYy9ndW4uanMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwicmVxdWlyZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJ0aGlzIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMF9fIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fNF9fIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fNl9fIiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIlIiLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsIl9yZWRpcyIsIl9zZXJpYWxpemUiLCJtZXRhUmUiLCJlZGdlUmUiLCJHdW4iLCJjaGFuZ2VTdWJzY3JpYmVycyIsIl9sZW4iLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJjb25maWciLCJBcnJheSIsIl9rZXkiLCJyZWRpcyIsImNyZWF0ZUNsaWVudCIsImFwcGx5Iiwic291bCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiaGdldGFsbCIsImVyciIsInJlcyIsImNvbnNvbGUiLCJlcnJvciIsImZyb21SZWRpcyIsInJlYWQiLCJ0aGVuIiwicmF3RGF0YSIsImRhdGEiLCJTRUEiLCJpbmRleE9mIiwid2l0aG91dCIsImtleXMiLCJmb3JFYWNoIiwidmVyaWZ5Iiwib3B0IiwicGFjayIsInVucGFjayIsImJhdGNoZWRHZXQiLCJjYiIsImhrZXlzIiwibm9kZUtleXMiLCJzdGFjayIsImxvZyIsImF0dHJLZXlzIiwiZmlsdGVyIiwibWF0Y2giLCJyZWFkQmF0Y2giLCJvayIsImZhaWwiLCJiYXRjaCIsInNwbGljZSIsImJhdGNoTWV0YSIsIm1hcCIsImNvbmNhdCIsInJlcGxhY2UiLCJobWdldCIsIm1ldGEiLCJvYmoiLCJfLiMiLCJ2YWwiLCJpZHgiLCJyZWFkS2V5QmF0Y2giLCJyZXN1bHQiLCJyZWFkTmV4dEJhdGNoIiwiZG9uZSIsImNhdGNoIiwid3JpdGUiLCJwdXQiLCJhbGwiLCJub2RlIiwicGF0aCIsIndyaXRlTmV4dEJhdGNoIiwidXBkYXRlZCIsIl8iLCIjIiwiPiIsInBpY2siLCJleGlzdGluZyIsIm1vZGlmaWVkS2V5cyIsInVwZGF0ZWRWYWwiLCJwcm9wIiwiZXhpc3RpbmdWYWwiLCJ1cGRhdGVkU291bCIsImV4aXN0aW5nU291bCIsInBhcnNlRmxvYXQiLCJkaWZmIiwiYXNzb2MiLCJobXNldCIsInRvUmVkaXMiLCJvcmlnaW5hbCIsImZuIiwibm90aWZ5Q2hhbmdlU3Vic2NyaWJlcnMiLCJvbkNoYW5nZSIsInB1c2giLCJvZmZDaGFuZ2UiLCJyZWNlaXZlckZucyIsIl9ndW4iLCJyZWNlaXZlciIsIl9jbGllbnQiLCJfcmVmIiwidW5kZWZpbmVkIiwiX3JlZiRkaXNhYmxlUmVsYXkiLCJkaXNhYmxlUmVsYXkiLCJfcmVmJHNraXBWYWxpZGF0aW9uIiwic2tpcFZhbGlkYXRpb24iLCJkYiIsIm9uSW4iLCJtc2ciLCJmcm9tIiwianNvbiIsImZyb21DbHVzdGVyIiwiZGVkdXBJZCIsIm1zZ0lkIiwiQCIsInNlbmQiLCJpZ25vcmVMZWVjaGluZyIsIl9yZWYzJGRpc2FibGVSZWxheSIsImdldERpZmYiLCJub1JlbGF5Iiwic29ydGVkIiwiX3JhbWRhIiwidGVzdCIsIkZJRUxEX1NJWkVfTElNSVQiLCJzbGljZSIsImFycm93IiwiX3R5cGVvZiIsInZhbEtleXMiLCJyZW1haW5kZXIiLCJyZWFsS2V5Iiwiam9pbiIsInJlYWxWYWx1ZSIsInBvc3RVbmZsYXR0ZW4iLCJmbGF0dGVuIiwidW5mbGF0dGVuIiwic29ydCIsIm9uIiwidG8iLCJuZXh0IiwicmVxdWVzdCJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsR0FDQSxpQkFBQUMsU0FBQSxpQkFBQUMsT0FDQUEsT0FBQUQsUUFBQUQsRUFBQUcsUUFBQSxTQUFBQSxRQUFBLFNBQUFBLFFBQUEsU0FDQSxtQkFBQUMsZUFBQUMsSUFDQUQsT0FBQSxxQ0FBQUosR0FDQSxpQkFBQUMsUUFDQUEsUUFBQSxhQUFBRCxFQUFBRyxRQUFBLFNBQUFBLFFBQUEsU0FBQUEsUUFBQSxTQUVBSixFQUFBLGFBQUFDLEVBQUFELEVBQUEsTUFBQUEsRUFBQSxNQUFBQSxFQUFBLE1BUkEsQ0FTQyxvQkFBQU8sVUFBQUMsS0FBQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUNELG1CQ1RBLElBQUFDLEVBQUEsR0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQVosUUFHQSxJQUFBQyxFQUFBUyxFQUFBRSxHQUFBLENBQ0FD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SCxFQUFJc0IsT0FBU3RCLElBQ3BDc0YsRUFBRzhCLEdBQUcsS0FBTSxDQUNWdEIsSUFBS0YsRUFDTDVDLElBQUssS0FDTGhELFlBS05zRixFQUFHOEIsR0FBRyxNQUFPLFNBQVNHLEdBQ3BCcEwsS0FBS2tMLEdBQUdDLEtBQUtDLEdBQ2IsSUFBTTNCLEVBQVUyQixFQUFRLEtBRXhCL0gsRUFBTXVELE1BQU13RSxFQUFRdkUsS0FDakIxQyxLQUFLLGtCQUNKZ0YsRUFBRzhCLEdBQUcsS0FBTSxDQUNWdEIsSUFBS0YsRUFDTGhFLElBQUksRUFDSjVCLElBQUssU0FHUjhDLE1BQU0sU0FBQTlDLEdBQUcsT0FDUnNGLEVBQUc4QixHQUFHLEtBQU0sQ0FDVnRCLElBQUtGLEVBQ0xoRSxJQUFJLEVBQ0o1QixJQUFLQSIsImZpbGUiOiJndW4tcmVkaXMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKVxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShyZXF1aXJlKFwicmFtZGFcIiksIHJlcXVpcmUoXCJyZWRpc1wiKSwgcmVxdWlyZShcImZsYXRcIikpO1xuXHRlbHNlIGlmKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZClcblx0XHRkZWZpbmUoXCJndW4tcmVkaXNcIiwgW1wicmFtZGFcIiwgXCJyZWRpc1wiLCBcImZsYXRcIl0sIGZhY3RvcnkpO1xuXHRlbHNlIGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jylcblx0XHRleHBvcnRzW1wiZ3VuLXJlZGlzXCJdID0gZmFjdG9yeShyZXF1aXJlKFwicmFtZGFcIiksIHJlcXVpcmUoXCJyZWRpc1wiKSwgcmVxdWlyZShcImZsYXRcIikpO1xuXHRlbHNlXG5cdFx0cm9vdFtcImd1bi1yZWRpc1wiXSA9IGZhY3Rvcnkocm9vdFtcInJhbWRhXCJdLCByb290W1wicmVkaXNcIl0sIHJvb3RbXCJmbGF0XCJdKTtcbn0pKHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHRoaXMsIGZ1bmN0aW9uKF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzBfXywgX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fNF9fLCBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX182X18pIHtcbnJldHVybiAiLCIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMik7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzBfXzsiLCJpbXBvcnQgKiBhcyBSIGZyb20gXCJyYW1kYVwiO1xuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IGFzIGNyZWF0ZVJlZGlzQ2xpZW50IH0gZnJvbSBcInJlZGlzXCI7XG5pbXBvcnQgeyB0b1JlZGlzLCBmcm9tUmVkaXMgfSBmcm9tIFwiLi9zZXJpYWxpemVcIjtcblxuY29uc3QgR0VUX0JBVENIX1NJWkUgPSAxMDAwMDtcbmNvbnN0IFBVVF9CQVRDSF9TSVpFID0gMTAwMDA7XG5cbmNvbnN0IG1ldGFSZSA9IC9eX1xcLi4qLztcbmNvbnN0IGVkZ2VSZSA9IC8oXFwuIyQpLztcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUNsaWVudCA9IChHdW4sIC4uLmNvbmZpZykgPT4ge1xuICBsZXQgY2hhbmdlU3Vic2NyaWJlcnMgPSBbXTtcbiAgY29uc3QgcmVkaXMgPSBjcmVhdGVSZWRpc0NsaWVudCguLi5jb25maWcpO1xuICBjb25zdCBub3RpZnlDaGFuZ2VTdWJzY3JpYmVycyA9IChzb3VsLCBkaWZmLCBvcmlnaW5hbCkgPT5cbiAgICBjaGFuZ2VTdWJzY3JpYmVycy5tYXAoZm4gPT4gZm4oc291bCwgZGlmZiwgb3JpZ2luYWwpKTtcbiAgY29uc3Qgb25DaGFuZ2UgPSBmbiA9PiBjaGFuZ2VTdWJzY3JpYmVycy5wdXNoKGZuKTtcbiAgY29uc3Qgb2ZmQ2hhbmdlID0gZm4gPT5cbiAgICAoY2hhbmdlU3Vic2NyaWJlcnMgPSBSLndpdGhvdXQoW2ZuXSwgY2hhbmdlU3Vic2NyaWJlcnMpKTtcblxuICBjb25zdCBnZXQgPSBzb3VsID0+XG4gICAgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgaWYgKCFzb3VsKSByZXR1cm4gcmVzb2x2ZShudWxsKTtcbiAgICAgIHJlZGlzLmhnZXRhbGwoc291bCwgZnVuY3Rpb24oZXJyLCByZXMpIHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJnZXQgZXJyb3JcIiwgZXJyKTtcbiAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXNvbHZlKGZyb21SZWRpcyhyZXMpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH0pO1xuXG4gIGNvbnN0IHJlYWQgPSBzb3VsID0+XG4gICAgZ2V0KHNvdWwpLnRoZW4ocmF3RGF0YSA9PiB7XG4gICAgICBjb25zdCBkYXRhID0gcmF3RGF0YSA/IHsgLi4ucmF3RGF0YSB9IDogcmF3RGF0YTtcblxuICAgICAgaWYgKCFHdW4uU0VBIHx8IHNvdWwuaW5kZXhPZihcIn5cIikgPT09IC0xKSByZXR1cm4gcmF3RGF0YTtcbiAgICAgIFIud2l0aG91dChbXCJfXCJdLCBSLmtleXMoZGF0YSkpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgR3VuLlNFQS52ZXJpZnkoXG4gICAgICAgICAgR3VuLlNFQS5vcHQucGFjayhyYXdEYXRhW2tleV0sIGtleSwgcmF3RGF0YSwgc291bCksXG4gICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgcmVzID0+IChkYXRhW2tleV0gPSBHdW4uU0VBLm9wdC51bnBhY2socmVzLCBrZXksIHJhd0RhdGEpKVxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9KTtcblxuICBjb25zdCByZWFkS2V5QmF0Y2ggPSAoc291bCwgYmF0Y2gpID0+XG4gICAgbmV3IFByb21pc2UoKG9rLCBmYWlsKSA9PiB7XG4gICAgICBjb25zdCBiYXRjaE1ldGEgPSBiYXRjaC5tYXAoa2V5ID0+IGBfLj4uJHtrZXl9YC5yZXBsYWNlKGVkZ2VSZSwgXCJcIikpO1xuXG4gICAgICByZXR1cm4gcmVkaXMuaG1nZXQoc291bCwgYmF0Y2hNZXRhLCAoZXJyLCBtZXRhKSA9PiB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICByZXR1cm4gY29uc29sZS5lcnJvcihcImhtZ2V0IGVyclwiLCBlcnIuc3RhY2sgfHwgZXJyKSB8fCBmYWlsKGVycik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgb2JqID0ge1xuICAgICAgICAgIFwiXy4jXCI6IHNvdWxcbiAgICAgICAgfTtcblxuICAgICAgICBtZXRhLmZvckVhY2goKHZhbCwgaWR4KSA9PiAob2JqW2JhdGNoTWV0YVtpZHhdXSA9IHZhbCkpO1xuICAgICAgICByZXR1cm4gcmVkaXMuaG1nZXQoc291bCwgYmF0Y2gsIChlcnIsIHJlcykgPT4ge1xuICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLmVycm9yKFwiaG1nZXQgZXJyXCIsIGVyci5zdGFjayB8fCBlcnIpIHx8IGZhaWwoZXJyKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVzLmZvckVhY2goKHZhbCwgaWR4KSA9PiAob2JqW2JhdGNoW2lkeF1dID0gdmFsKSk7XG4gICAgICAgICAgcmV0dXJuIG9rKGZyb21SZWRpcyhvYmopKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICBjb25zdCBiYXRjaGVkR2V0ID0gKHNvdWwsIGNiKSA9PlxuICAgIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHJlZGlzLmhrZXlzKHNvdWwsIChlcnIsIG5vZGVLZXlzKSA9PiB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiZXJyb3JcIiwgZXJyLnN0YWNrIHx8IGVycik7XG4gICAgICAgICAgcmV0dXJuIHJlamVjdChlcnIpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlS2V5cy5sZW5ndGggPD0gR0VUX0JBVENIX1NJWkUpIHtcbiAgICAgICAgICByZXR1cm4gZ2V0KHNvdWwpLnRoZW4ocmVzID0+IHtcbiAgICAgICAgICAgIGNiKHJlcyk7XG4gICAgICAgICAgICByZXNvbHZlKHJlcyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coXCJnZXQgYmlnIHNvdWxcIiwgc291bCwgbm9kZUtleXMubGVuZ3RoKTtcbiAgICAgICAgY29uc3QgYXR0cktleXMgPSBub2RlS2V5cy5maWx0ZXIoa2V5ID0+ICFrZXkubWF0Y2gobWV0YVJlKSk7XG4gICAgICAgIGNvbnN0IHJlYWRCYXRjaCA9ICgpID0+XG4gICAgICAgICAgbmV3IFByb21pc2UoKG9rLCBmYWlsKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBiYXRjaCA9IGF0dHJLZXlzLnNwbGljZSgwLCBHRVRfQkFUQ0hfU0laRSk7XG5cbiAgICAgICAgICAgIGlmICghYmF0Y2gubGVuZ3RoKSByZXR1cm4gb2sodHJ1ZSk7XG5cbiAgICAgICAgICAgIHJldHVybiByZWFkS2V5QmF0Y2goc291bCwgYmF0Y2gpLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgY2IocmVzdWx0KTtcbiAgICAgICAgICAgICAgcmV0dXJuIG9rKCk7XG4gICAgICAgICAgICB9LCBmYWlsKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgcmVhZE5leHRCYXRjaCA9ICgpID0+XG4gICAgICAgICAgcmVhZEJhdGNoKCkudGhlbihkb25lID0+ICFkb25lICYmIHJlYWROZXh0QmF0Y2gpO1xuXG4gICAgICAgIHJldHVybiByZWFkTmV4dEJhdGNoKClcbiAgICAgICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICAgICAgcmVzb2x2ZShyZXMpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmNhdGNoKHJlamVjdCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICBjb25zdCB3cml0ZSA9IHB1dCA9PlxuICAgIFByb21pc2UuYWxsKFxuICAgICAgUi5rZXlzKHB1dCkubWFwKFxuICAgICAgICBzb3VsID0+XG4gICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgbm9kZSA9IHB1dFtzb3VsXTtcbiAgICAgICAgICAgIGNvbnN0IG1ldGEgPSBSLnBhdGgoW1wiX1wiLCBcIj5cIl0sIG5vZGUpIHx8IHt9O1xuICAgICAgICAgICAgY29uc3Qgbm9kZUtleXMgPSBSLmtleXMobWV0YSk7XG4gICAgICAgICAgICBjb25zdCB3cml0ZU5leHRCYXRjaCA9ICgpID0+IHtcbiAgICAgICAgICAgICAgY29uc3QgYmF0Y2ggPSBub2RlS2V5cy5zcGxpY2UoMCwgUFVUX0JBVENIX1NJWkUpO1xuXG4gICAgICAgICAgICAgIGlmICghYmF0Y2gubGVuZ3RoKSByZXR1cm4gcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICBjb25zdCB1cGRhdGVkID0ge1xuICAgICAgICAgICAgICAgIF86IHtcbiAgICAgICAgICAgICAgICAgIFwiI1wiOiBzb3VsLFxuICAgICAgICAgICAgICAgICAgXCI+XCI6IFIucGljayhiYXRjaCwgbWV0YSlcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIC4uLlIucGljayhiYXRjaCwgbm9kZSlcbiAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAvLyByZXR1cm4gcmVhZEtleUJhdGNoKHNvdWwsIGJhdGNoKS50aGVuKGV4aXN0aW5nID0+IHtcbiAgICAgICAgICAgICAgcmV0dXJuIGdldChzb3VsKS50aGVuKGV4aXN0aW5nID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBtb2RpZmllZEtleXMgPSBiYXRjaC5maWx0ZXIoa2V5ID0+IHtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRWYWwgPSBSLnByb3Aoa2V5LCB1cGRhdGVkKTtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nVmFsID0gUi5wcm9wKGtleSwgZXhpc3RpbmcpO1xuXG4gICAgICAgICAgICAgICAgICBpZiAodXBkYXRlZFZhbCA9PT0gZXhpc3RpbmdWYWwpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRTb3VsID0gUi5wYXRoKFtrZXksIFwiI1wiXSwgdXBkYXRlZCk7XG4gICAgICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ1NvdWwgPSBSLnBhdGgoW2tleSwgXCIjXCJdLCBleGlzdGluZyk7XG5cbiAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgKHVwZGF0ZWRTb3VsIHx8IGV4aXN0aW5nU291bCkgJiZcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlZFNvdWwgPT09IGV4aXN0aW5nU291bFxuICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgdHlwZW9mIHVwZGF0ZWRWYWwgPT09IFwibnVtYmVyXCIgJiZcbiAgICAgICAgICAgICAgICAgICAgcGFyc2VGbG9hdChleGlzdGluZ1ZhbCkgPT09IHVwZGF0ZWRWYWxcbiAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFtb2RpZmllZEtleXMubGVuZ3RoKSByZXR1cm4gd3JpdGVOZXh0QmF0Y2goKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGRpZmYgPSB7XG4gICAgICAgICAgICAgICAgICBfOiBSLmFzc29jKFwiPlwiLCBSLnBpY2sobW9kaWZpZWRLZXlzLCBtZXRhKSwgdXBkYXRlZC5fKSxcbiAgICAgICAgICAgICAgICAgIC4uLlIucGljayhtb2RpZmllZEtleXMsIHVwZGF0ZWQpXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHJldHVybiByZWRpcy5obXNldChzb3VsLCB0b1JlZGlzKGRpZmYpLCBlcnIgPT4ge1xuICAgICAgICAgICAgICAgICAgZXJyID8gcmVqZWN0KGVycikgOiB3cml0ZU5leHRCYXRjaCgpO1xuICAgICAgICAgICAgICAgICAgbm90aWZ5Q2hhbmdlU3Vic2NyaWJlcnMoc291bCwgZGlmZiwgZXhpc3RpbmcpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJldHVybiB3cml0ZU5leHRCYXRjaCgpO1xuICAgICAgICAgIH0pXG4gICAgICApXG4gICAgKTtcblxuICAvLyBvbkNoYW5nZSgoc291bCwgZGlmZikgPT4gY29uc29sZS5sb2coXCJtb2RpZnlcIiwgc291bCwgUi5rZXlzKGRpZmYpKSk7XG5cbiAgcmV0dXJuIHsgZ2V0LCByZWFkLCBiYXRjaGVkR2V0LCB3cml0ZSwgb25DaGFuZ2UsIG9mZkNoYW5nZSB9O1xufTtcbiIsImltcG9ydCAqIGFzIHJlY2VpdmVyRm5zIGZyb20gXCIuL3JlY2VpdmVyXCI7XG5leHBvcnQgeyBhdHRhY2hUb0d1biB9IGZyb20gXCIuL2d1blwiO1xuXG5leHBvcnQgY29uc3QgcmVjZWl2ZXIgPSByZWNlaXZlckZucztcbiIsImltcG9ydCAqIGFzIFIgZnJvbSBcInJhbWRhXCI7XG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tIFwiLi9jbGllbnRcIjtcblxuZXhwb3J0IGNvbnN0IHJlc3BvbmRUb0dldHMgPSAoXG4gIEd1bixcbiAgeyBkaXNhYmxlUmVsYXkgPSB0cnVlLCBza2lwVmFsaWRhdGlvbiA9IHRydWUgfSA9IHt9XG4pID0+IGRiID0+IHtcbiAgY29uc3QgcmVkaXMgPSAoR3VuLnJlZGlzID0gR3VuLnJlZGlzIHx8IGNyZWF0ZUNsaWVudChHdW4pKTtcblxuICBkYi5vbkluKG1zZyA9PiB7XG4gICAgY29uc3QgeyBmcm9tLCBqc29uLCBmcm9tQ2x1c3RlciB9ID0gbXNnO1xuICAgIGNvbnN0IHNvdWwgPSBSLnBhdGgoW1wiZ2V0XCIsIFwiI1wiXSwganNvbik7XG4gICAgY29uc3QgZGVkdXBJZCA9IFIucHJvcChcIiNcIiwganNvbik7XG5cbiAgICBpZiAoIXNvdWwgfHwgZnJvbUNsdXN0ZXIpIHJldHVybiBtc2c7XG4gICAgcmV0dXJuIHJlZGlzXG4gICAgICAuYmF0Y2hlZEdldChzb3VsLCByZXN1bHQgPT4ge1xuICAgICAgICBjb25zdCBqc29uID0ge1xuICAgICAgICAgIFwiI1wiOiBmcm9tLm1zZ0lkKCksXG4gICAgICAgICAgXCJAXCI6IGRlZHVwSWQsXG4gICAgICAgICAgcHV0OiByZXN1bHQgPyB7IFtzb3VsXTogcmVzdWx0IH0gOiBudWxsXG4gICAgICAgIH07XG5cbiAgICAgICAgZnJvbS5zZW5kKHtcbiAgICAgICAgICBqc29uLFxuICAgICAgICAgIGlnbm9yZUxlZWNoaW5nOiB0cnVlLFxuICAgICAgICAgIHNraXBWYWxpZGF0aW9uOiAhcmVzdWx0IHx8IHNraXBWYWxpZGF0aW9uXG4gICAgICAgIH0pO1xuICAgICAgfSlcbiAgICAgIC50aGVuKCgpID0+IChkaXNhYmxlUmVsYXkgPyBSLmFzc29jKFwibm9SZWxheVwiLCB0cnVlLCBtc2cpIDogbXNnKSlcbiAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICBjb25zdCBqc29uID0ge1xuICAgICAgICAgIFwiI1wiOiBmcm9tLm1zZ0lkKCksXG4gICAgICAgICAgXCJAXCI6IGRlZHVwSWQsXG4gICAgICAgICAgZXJyOiBgJHtlcnJ9YFxuICAgICAgICB9O1xuXG4gICAgICAgIGZyb20uc2VuZCh7IGpzb24sIGlnbm9yZUxlZWNoaW5nOiB0cnVlLCBza2lwVmFsaWRhdGlvbiB9KTtcbiAgICAgICAgcmV0dXJuIG1zZztcbiAgICAgIH0pO1xuICB9KTtcblxuICByZXR1cm4gZGI7XG59O1xuXG5leHBvcnQgY29uc3QgYWNjZXB0V3JpdGVzID0gKEd1biwgeyBkaXNhYmxlUmVsYXkgPSBmYWxzZSB9ID0ge30pID0+IGRiID0+IHtcbiAgY29uc3QgcmVkaXMgPSAoR3VuLnJlZGlzID0gR3VuLnJlZGlzIHx8IGNyZWF0ZUNsaWVudChHdW4pKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuXG4gIGRiLm9uSW4obXNnID0+IHtcbiAgICBpZiAobXNnLmZyb21DbHVzdGVyKSByZXR1cm4gbXNnO1xuICAgIGlmIChtc2cuanNvbi5wdXQpIHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAuZ2V0RGlmZihtc2cuanNvbi5wdXQpXG4gICAgICAgIC50aGVuKGRpZmYgPT4ge1xuICAgICAgICAgIGNvbnN0IHNvdWxzID0gUi5rZXlzKGRpZmYpO1xuXG4gICAgICAgICAgaWYgKCFzb3Vscy5sZW5ndGgpIHJldHVybiBtc2c7XG4gICAgICAgICAgLy8gcmV0dXJuIGNvbnNvbGUubG9nKFwid291bGQgd3JpdGVcIiwgZGlmZikgfHwgbXNnO1xuICAgICAgICAgIHJldHVybiByZWRpc1xuICAgICAgICAgICAgLndyaXRlKGRpZmYpXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IGpzb24gPSB7IFwiQFwiOiBtc2cuanNvbltcIiNcIl0sIG9rOiB0cnVlLCBlcnI6IG51bGwgfTtcblxuICAgICAgICAgICAgICBtc2cuZnJvbSAmJlxuICAgICAgICAgICAgICAgIG1zZy5mcm9tLnNlbmQgJiZcbiAgICAgICAgICAgICAgICBtc2cuZnJvbS5zZW5kKHtcbiAgICAgICAgICAgICAgICAgIGpzb24sXG4gICAgICAgICAgICAgICAgICBub1JlbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgaWdub3JlTGVlY2hpbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgICBza2lwVmFsaWRhdGlvbjogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICByZXR1cm4gZGlzYWJsZVJlbGF5ID8gUi5hc3NvYyhcIm5vUmVsYXlcIiwgdHJ1ZSwgbXNnKSA6IG1zZztcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICAgICAgY29uc3QganNvbiA9IHsgXCJAXCI6IG1zZy5qc29uW1wiI1wiXSwgb2s6IGZhbHNlLCBlcnI6IGAke2Vycn1gIH07XG5cbiAgICAgICAgICAgICAgbXNnLmZyb20gJiZcbiAgICAgICAgICAgICAgICBtc2cuZnJvbS5zZW5kICYmXG4gICAgICAgICAgICAgICAgbXNnLmZyb20uc2VuZCh7XG4gICAgICAgICAgICAgICAgICBqc29uLFxuICAgICAgICAgICAgICAgICAgbm9SZWxheTogZGlzYWJsZVJlbGF5LFxuICAgICAgICAgICAgICAgICAgaWdub3JlTGVlY2hpbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgICBza2lwVmFsaWRhdGlvbjogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICByZXR1cm4gbXNnO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChlcnIgPT5cbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiZXJyb3IgYWNjZXB0aW5nIHdyaXRlc1wiLCBlcnIuc3RhY2sgfHwgZXJyKVxuICAgICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gbXNnO1xuICB9KTtcblxuICByZXR1cm4gZGI7XG59O1xuIiwibW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX180X187IiwiaW1wb3J0IHsga2V5cyB9IGZyb20gXCJyYW1kYVwiO1xuY29uc3QgZmxhdHRlbiA9IHJlcXVpcmUoXCJmbGF0XCIpO1xuXG5jb25zdCBGSUVMRF9TSVpFX0xJTUlUID0gMTAwMDAwO1xuXG5mdW5jdGlvbiBwb3N0VW5mbGF0dGVuKG9iaikge1xuICAvLyBUaGlzIGlzIHByb2JhYmx5IG9ubHkgbmVjZXNzYXJ5IGlmIHlvdSBhcmUgc3R1cGlkIGxpa2UgbWUgYW5kIHVzZSB0aGUgZGVmYXVsdCAuIGRlbGltaXRlciBmb3IgZmxhdHRlblxuICBpZiAoIW9iaikgcmV0dXJuIG9iajtcbiAgbGV0IGFycm93ID0gKG9iai5fICYmIG9iai5fW1wiPlwiXSkgfHwge307XG5cbiAga2V5cyhhcnJvdykuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICBsZXQgdmFsdWUgPSBhcnJvd1trZXldO1xuXG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJvYmplY3RcIikge1xuICAgICAgbGV0IHZhbEtleXMgPSBrZXlzKHZhbHVlKTtcbiAgICAgIGxldCByZW1haW5kZXIgPSB2YWxLZXlzWzBdO1xuXG4gICAgICBpZiAocmVtYWluZGVyKSB7XG4gICAgICAgIGxldCByZWFsS2V5ID0gW2tleSwgdmFsS2V5c10uam9pbihcIi5cIik7XG4gICAgICAgIGxldCByZWFsVmFsdWUgPSB2YWx1ZVtyZW1haW5kZXJdO1xuXG4gICAgICAgIGRlbGV0ZSBhcnJvd1trZXldO1xuICAgICAgICBhcnJvd1tyZWFsS2V5XSA9IHJlYWxWYWx1ZTtcbiAgICAgICAgcmVhbFZhbHVlID0gKG9ialtrZXldICYmIG9ialtrZXldW3JlbWFpbmRlcl0pIHx8IG51bGw7XG4gICAgICAgIGRlbGV0ZSBvYmpba2V5XTtcbiAgICAgICAgb2JqW3JlYWxLZXldID0gcmVhbFZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIGtleXMob2JqKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgaWYgKGtleVswXSA9PT0gXCIuXCIpIGRlbGV0ZSBba2V5XTtcbiAgfSk7XG4gIHJldHVybiBvYmo7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmcm9tUmVkaXMob2JqKSB7XG4gIGlmICghb2JqKSByZXR1cm4gb2JqO1xuICBjb25zdCBzb3J0ZWQgPSB7fTtcblxuICBrZXlzKG9iaikuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICBpZiAoa2V5WzBdID09PSBcIi5cIikgZGVsZXRlIG9ialtrZXldO1xuXG4gICAgaWYgKG9ialtrZXldID09PSBcInxOVUxMfFwiKSB7XG4gICAgICBvYmpba2V5XSA9IG51bGw7XG4gICAgfVxuICAgIGlmIChvYmpba2V5XSA9PT0gXCJ8VU5ERUZJTkVEfFwiKSB7XG4gICAgICBvYmpba2V5XSA9IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBpZiAoLz5cXC4vLnRlc3Qoa2V5KSkge1xuICAgICAgb2JqW2tleV0gPSBwYXJzZUZsb2F0KG9ialtrZXldLCAxMCkgfHwgb2JqW2tleV07XG4gICAgfVxuICAgIGlmIChvYmpba2V5XSAmJiBvYmpba2V5XS5sZW5ndGggPiBGSUVMRF9TSVpFX0xJTUlUKSB7XG4gICAgICBvYmpba2V5XSA9IG9ialtrZXldLnNsaWNlKDAsIEZJRUxEX1NJWkVfTElNSVQpO1xuICAgICAgY29uc29sZS5sb2coXCJ0cnVuY2F0ZWRcIiwga2V5KTtcbiAgICB9XG4gIH0pO1xuXG4gIG9iaiA9IHBvc3RVbmZsYXR0ZW4oZmxhdHRlbi51bmZsYXR0ZW4ob2JqLCB7IG9iamVjdDogdHJ1ZSB9KSk7XG5cbiAgT2JqZWN0LmtleXMob2JqKVxuICAgIC5zb3J0KClcbiAgICAuZm9yRWFjaChrZXkgPT4gKHNvcnRlZFtrZXldID0gb2JqW2tleV0pKTtcblxuICByZXR1cm4gc29ydGVkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdG9SZWRpcyhvYmopIHtcbiAgaWYgKCFvYmopIHJldHVybiBvYmo7XG4gIG9iaiA9IGZsYXR0ZW4ob2JqKTtcbiAga2V5cyhvYmopLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG4gICAgaWYgKG9ialtrZXldID09PSBudWxsKSB7XG4gICAgICBvYmpba2V5XSA9IFwifE5VTEx8XCI7XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygb2JqW2tleV0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgb2JqW2tleV0gPSBcInxVTkRFRklORUR8XCI7XG4gICAgfVxuICAgIGlmIChvYmpba2V5XSAmJiBvYmpba2V5XS5sZW5ndGggPiBGSUVMRF9TSVpFX0xJTUlUKSB7XG4gICAgICBvYmpba2V5XSA9IG9ialtrZXldLnNsaWNlKDAsIEZJRUxEX1NJWkVfTElNSVQpO1xuICAgICAgY29uc29sZS5sb2coXCJ0cnVuY2F0ZWQgaW5wdXRcIiwga2V5KTtcbiAgICB9XG4gICAgaWYgKGtleVswXSA9PT0gXCIuXCIpIGRlbGV0ZSBvYmpba2V5XTtcbiAgfSk7XG4gIHJldHVybiBvYmo7XG59XG4iLCJtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzZfXzsiLCJpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tIFwiLi9jbGllbnRcIjtcblxuZXhwb3J0IGNvbnN0IGF0dGFjaFRvR3VuID0gR3VuID0+IEd1bi5vbihcImNyZWF0ZVwiLCBmdW5jdGlvbihkYikge1xuICB0aGlzLnRvLm5leHQoZGIpO1xuICBjb25zdCByZWRpcyA9IEd1bi5yZWRpcyA9IGRiLnJlZGlzID0gY3JlYXRlQ2xpZW50KEd1bik7XG5cbiAgZGIub24oXCJnZXRcIiwgZnVuY3Rpb24ocmVxdWVzdCkge1xuICAgIHRoaXMudG8ubmV4dChyZXF1ZXN0KTtcbiAgICBjb25zdCBkZWR1cElkID0gcmVxdWVzdFtcIiNcIl07XG4gICAgY29uc3QgZ2V0ID0gcmVxdWVzdC5nZXQ7XG4gICAgY29uc3Qgc291bCA9IGdldFtcIiNcIl07XG5cbiAgICByZWRpcy5iYXRjaGVkR2V0KHNvdWwsIHJlc3VsdCA9PiBkYi5vbihcImluXCIsIHtcbiAgICAgIFwiQFwiOiBkZWR1cElkLFxuICAgICAgcHV0OiByZXN1bHQgPyB7IFtzb3VsXTogcmVzdWx0IH0gOiBudWxsLFxuICAgICAgZXJyOiBudWxsXG4gICAgfSkpLmNhdGNoKGVyciA9PlxuICAgICAgY29uc29sZS5lcnJvcihcImVycm9yXCIsIGVyci5zdGFjayB8fCBlcnIpIHx8XG4gICAgICBkYi5vbihcImluXCIsIHtcbiAgICAgICAgXCJAXCI6IGRlZHVwSWQsXG4gICAgICAgIHB1dDogbnVsbCxcbiAgICAgICAgZXJyXG4gICAgICB9KVxuICAgICk7XG4gIH0pO1xuXG4gIGRiLm9uKFwicHV0XCIsIGZ1bmN0aW9uKHJlcXVlc3QpIHtcbiAgICB0aGlzLnRvLm5leHQocmVxdWVzdCk7XG4gICAgY29uc3QgZGVkdXBJZCA9IHJlcXVlc3RbXCIjXCJdO1xuXG4gICAgcmVkaXMud3JpdGUocmVxdWVzdC5wdXQpXG4gICAgICAudGhlbigoKSA9PlxuICAgICAgICBkYi5vbihcImluXCIsIHtcbiAgICAgICAgICBcIkBcIjogZGVkdXBJZCxcbiAgICAgICAgICBvazogdHJ1ZSxcbiAgICAgICAgICBlcnI6IG51bGxcbiAgICAgICAgfSlcbiAgICAgIClcbiAgICAgIC5jYXRjaChlcnIgPT5cbiAgICAgICAgZGIub24oXCJpblwiLCB7XG4gICAgICAgICAgXCJAXCI6IGRlZHVwSWQsXG4gICAgICAgICAgb2s6IGZhbHNlLFxuICAgICAgICAgIGVycjogZXJyXG4gICAgICAgIH0pXG4gICAgICApO1xuICB9KTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIifQ==