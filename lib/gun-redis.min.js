!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("ramda"),require("redis"),require("flat")):"function"==typeof define&&define.amd?define("gun-redis",["ramda","redis","flat"],t):"object"==typeof exports?exports["gun-redis"]=t(require("ramda"),require("redis"),require("flat")):e["gun-redis"]=t(e.ramda,e.redis,e.flat)}("undefined"!=typeof self?self:this,function(e,t,r){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(t,r){t.exports=e},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createClient=void 0;var n=r(0),o=r(4),u=r(5),i=/^_\..*/,c=/(\.#$)/;t.createClient=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),f=1;f<t;f++)r[f-1]=arguments[f];var a=o.createClient.apply(void 0,r),l=function(e){return new Promise(function(t,r){if(!e)return t(null);a.hgetall(e,function(e,n){e?(console.error("get error",e),r(e)):t((0,u.fromRedis)(n))})})};return{get:l,read:function(t){return l(t).then(function(r){var o=r?{...r}:r;return e.SEA&&-1!==t.indexOf("~")?((0,n.without)(["_"],(0,n.keys)(o)).forEach(function(n){e.SEA.verify(e.SEA.opt.pack(r[n],n,r,t),!1,function(t){return o[n]=e.SEA.opt.unpack(t,n,r)})}),o):r})},batchedGet:function(e,t){return new Promise(function(r,n){a.hkeys(e,function(o,f){if(o)return console.error("error",o.stack||o),n(o);if(f.length<=1e4)return l(e).then(function(e){t(e),r(e)});console.log("get big soul",e,f.length);var s=f.filter(function(e){return!e.match(i)});return function r(){return new Promise(function(r,n){var o=s.splice(0,1e4);if(!o.length)return r(!0);var i=o.map(function(e){return"_.>.".concat(e).replace(c,"")});return a.hmget(e,i,function(c,f){if(c)return console.error("hmget err",c.stack||c)||n(c);var l={"_.#":e};return f.forEach(function(e,t){return l[i[t]]=e}),a.hmget(e,o,function(e,i){if(e)return console.error("hmget err",e.stack||e)||n(e);i.forEach(function(e,t){return l[o[t]]=e});var c=(0,u.fromRedis)(l);return t(c),r()})})}).then(function(e){return!e&&r})}().then(function(e){r(e)}).catch(n)})})},write:function(e){return Promise.all((0,n.keys)(e).map(function(t){return new Promise(function(r,o){var i=e[t],c=(0,n.path)(["_",">"],i)||{},f=(0,n.keys)(c);return function e(){var l=f.splice(0,1e4);if(!l.length)return r();var s=(0,u.toRedis)({_:{"#":t,">":(0,n.pick)(l,c)},...(0,n.pick)(l,i)});return a.hmset(t,(0,u.toRedis)(s),function(t){return t?o(t):e()})}()})}))}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"attachToGun",{enumerable:!0,get:function(){return o.attachToGun}}),t.receiver=void 0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(3)),o=r(7);var u=n;t.receiver=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.respondToGets=void 0;var n=r(0),o=r(1);t.respondToGets=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).skipValidation,r=void 0===t||t;return function(t){var u=(0,o.createClient)(e);return t.onIn(function(e){var t=e.from,o=e.json,i=e.fromCluster,c=(0,n.path)(["get","#"],o),f=(0,n.prop)("#",o);return!c||i?e:u.batchedGet(c,function(e){var n,o,u,i={"#":t.msgId(),"@":f,put:e?(n={},o=c,u=e,o in n?Object.defineProperty(n,o,{value:u,enumerable:!0,configurable:!0,writable:!0}):n[o]=u,n):null};t.send({json:i,ignoreLeeching:!0,skipValidation:!e||r})}).catch(function(e){var n={"#":t.msgId(),"@":f,err:"".concat(e)};t.send({json:n,ignoreLeeching:!0,skipValidation:r})}).then(function(){return e})}),t}}},function(e,r){e.exports=t},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fromRedis=function(e){if(!e)return e;var t={};return(0,n.keys)(e).forEach(function(t){"."===t[0]&&delete e[t],"|NULL|"===e[t]&&(e[t]=null),"|UNDEFINED|"===e[t]&&(e[t]=void 0),/>\./.test(t)&&(e[t]=parseFloat(e[t],10)||e[t]),e[t]&&e[t].length>i&&(e[t]=e[t].slice(0,i),console.log("truncated",t))}),e=function(e){if(!e)return e;var t=e._&&e._[">"]||{};return(0,n.keys)(t).forEach(function(r){var u=t[r];if("object"===o(u)){var i=(0,n.keys)(u),c=i[0];if(c){var f=[r,i].join("."),a=u[c];delete t[r],t[f]=a,a=e[r]&&e[r][c]||null,delete e[r],e[f]=a}}}),(0,n.keys)(e).forEach(function(e){e[0]}),e}(u.unflatten(e)),Object.keys(e).sort().forEach(function(r){return t[r]=e[r]}),t},t.toRedis=function(e){return e?(e=u(e),(0,n.keys)(e).forEach(function(t){null===e[t]&&(e[t]="|NULL|"),void 0===e[t]&&(e[t]="|UNDEFINED|"),e[t]&&e[t].length>i&&(e[t]=e[t].slice(0,i),console.log("truncated input",t)),"."===t[0]&&delete e[t]}),e):e};var n=r(0);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var u=r(6),i=1e5},function(e,t){e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.attachToGun=void 0;var n=r(1);t.attachToGun=function(e){return e.on("create",function(t){this.to.next(t);var r=e.redis=t.redis=(0,n.createClient)(e);t.on("get",function(e){this.to.next(e);var n=e["#"],o=e.get["#"];r.batchedGet(o,function(e){return t.on("in",{"@":n,put:e?(r={},u=o,i=e,u in r?Object.defineProperty(r,u,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[u]=i,r):null,err:null});var r,u,i}).catch(function(e){return console.error("error",e.stack||e)||t.on("in",{"@":n,put:null,err:e})})}),t.on("put",function(e){this.to.next(e);var n=e["#"];r.write(e.put).then(function(){return t.on("in",{"@":n,ok:!0,err:null})}).catch(function(e){return t.on("in",{"@":n,ok:!1,err:e})})})})}}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ndW4tcmVkaXMvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL2d1bi1yZWRpcy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9ndW4tcmVkaXMvZXh0ZXJuYWwgXCJyYW1kYVwiIiwid2VicGFjazovL2d1bi1yZWRpcy8uL3NyYy9jbGllbnQuanMiLCJ3ZWJwYWNrOi8vZ3VuLXJlZGlzLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL2d1bi1yZWRpcy8uL3NyYy9yZWNlaXZlci5qcyIsIndlYnBhY2s6Ly9ndW4tcmVkaXMvZXh0ZXJuYWwgXCJyZWRpc1wiIiwid2VicGFjazovL2d1bi1yZWRpcy8uL3NyYy9zZXJpYWxpemUuanMiLCJ3ZWJwYWNrOi8vZ3VuLXJlZGlzL2V4dGVybmFsIFwiZmxhdFwiIiwid2VicGFjazovL2d1bi1yZWRpcy8uL3NyYy9ndW4uanMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwicmVxdWlyZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJ0aGlzIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMF9fIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fNF9fIiwiX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fNl9fIiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIl9yYW1kYSIsIl9yZWRpcyIsIl9zZXJpYWxpemUiLCJtZXRhUmUiLCJlZGdlUmUiLCJHdW4iLCJfbGVuIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiY29uZmlnIiwiQXJyYXkiLCJfa2V5IiwicmVkaXMiLCJjcmVhdGVDbGllbnQiLCJhcHBseSIsInNvdWwiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImhnZXRhbGwiLCJlcnIiLCJyZXMiLCJjb25zb2xlIiwiZXJyb3IiLCJmcm9tUmVkaXMiLCJyZWFkIiwidGhlbiIsInJhd0RhdGEiLCJkYXRhIiwiU0VBIiwiaW5kZXhPZiIsIndpdGhvdXQiLCJrZXlzIiwiZm9yRWFjaCIsInZlcmlmeSIsIm9wdCIsInBhY2siLCJ1bnBhY2siLCJiYXRjaGVkR2V0IiwiY2IiLCJoa2V5cyIsIm5vZGVLZXlzIiwic3RhY2siLCJsb2ciLCJhdHRyS2V5cyIsImZpbHRlciIsIm1hdGNoIiwicmVhZE5leHRCYXRjaCIsIm9rIiwiZmFpbCIsImJhdGNoIiwic3BsaWNlIiwiYmF0Y2hNZXRhIiwibWFwIiwiY29uY2F0IiwicmVwbGFjZSIsImhtZ2V0IiwibWV0YSIsIm9iaiIsIl8uIyIsInZhbCIsImlkeCIsInJlc3VsdCIsImRvbmUiLCJjYXRjaCIsIndyaXRlIiwicHV0IiwiYWxsIiwibm9kZSIsInBhdGgiLCJ3cml0ZU5leHRCYXRjaCIsInVwZGF0ZXMiLCJ0b1JlZGlzIiwiXyIsIiMiLCI+IiwicGljayIsImhtc2V0IiwicmVjZWl2ZXJGbnMiLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsIl9ndW4iLCJyZWNlaXZlciIsIl9jbGllbnQiLCJfcmVmJHNraXBWYWxpZGF0aW9uIiwidW5kZWZpbmVkIiwic2tpcFZhbGlkYXRpb24iLCJkYiIsIm9uSW4iLCJtc2ciLCJmcm9tIiwianNvbiIsImZyb21DbHVzdGVyIiwiZGVkdXBJZCIsInByb3AiLCJtc2dJZCIsIkAiLCJzZW5kIiwiaWdub3JlTGVlY2hpbmciLCJzb3J0ZWQiLCJ0ZXN0IiwicGFyc2VGbG9hdCIsIkZJRUxEX1NJWkVfTElNSVQiLCJzbGljZSIsImFycm93IiwiX3R5cGVvZiIsInZhbEtleXMiLCJyZW1haW5kZXIiLCJyZWFsS2V5Iiwiam9pbiIsInJlYWxWYWx1ZSIsInBvc3RVbmZsYXR0ZW4iLCJmbGF0dGVuIiwidW5mbGF0dGVuIiwic29ydCIsIm9uIiwidG8iLCJuZXh0IiwicmVxdWVzdCJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsR0FDQSxpQkFBQUMsU0FBQSxpQkFBQUMsT0FDQUEsT0FBQUQsUUFBQUQsRUFBQUcsUUFBQSxTQUFBQSxRQUFBLFNBQUFBLFFBQUEsU0FDQSxtQkFBQUMsZUFBQUMsSUFDQUQsT0FBQSxxQ0FBQUosR0FDQSxpQkFBQUMsUUFDQUEsUUFBQSxhQUFBRCxFQUFBRyxRQUFBLFNBQUFBLFFBQUEsU0FBQUEsUUFBQSxTQUVBSixFQUFBLGFBQUFDLEVBQUFELEVBQUEsTUFBQUEsRUFBQSxNQUFBQSxFQUFBLE1BUkEsQ0FTQyxvQkFBQU8sVUFBQUMsS0FBQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUNELG1CQ1RBLElBQUFDLEVBQUEsR0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQVosUUFHQSxJQUFBQyxFQUFBUyxFQUFBRSxHQUFBLENBQ0FDLEVBQUFELEVBQ0FFLEdBQUEsRUFDQWQsUUFBQSxJQVVBLE9BTkFlLEVBQUFILEdBQUFJLEtBQUFmLEVBQUFELFFBQUFDLElBQUFELFFBQUFXLEdBR0FWLEVBQUFhLEdBQUEsRUFHQWIsRUFBQUQsUUEwREEsT0FyREFXLEVBQUFNLEVBQUFGLEVBR0FKLEVBQUFPLEVBQUFSLEVBR0FDLEVBQUFRLEVBQUEsU0FBQW5CLEVBQUFvQixFQUFBQyxHQUNBVixFQUFBVyxFQUFBdEIsRUFBQW9CLElBQ0FHLE9BQUFDLGVBQUF4QixFQUFBb0IsRUFBQSxDQUEwQ0ssWUFBQSxFQUFBQyxJQUFBTCxLQUsxQ1YsRUFBQWdCLEVBQUEsU0FBQTNCLEdBQ0Es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Q1ZuQixJQUFLSCxFQUNMNUMsSUFBSSxFQUNKNUIsSUFBS0EiLCJmaWxlIjoiZ3VuLXJlZGlzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZShcInJhbWRhXCIpLCByZXF1aXJlKFwicmVkaXNcIiksIHJlcXVpcmUoXCJmbGF0XCIpKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFwiZ3VuLXJlZGlzXCIsIFtcInJhbWRhXCIsIFwicmVkaXNcIiwgXCJmbGF0XCJdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcImd1bi1yZWRpc1wiXSA9IGZhY3RvcnkocmVxdWlyZShcInJhbWRhXCIpLCByZXF1aXJlKFwicmVkaXNcIiksIHJlcXVpcmUoXCJmbGF0XCIpKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJndW4tcmVkaXNcIl0gPSBmYWN0b3J5KHJvb3RbXCJyYW1kYVwiXSwgcm9vdFtcInJlZGlzXCJdLCByb290W1wiZmxhdFwiXSk7XG59KSh0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0aGlzLCBmdW5jdGlvbihfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX18wX18sIF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzRfXywgX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fNl9fKSB7XG5yZXR1cm4gIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDIpO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX18wX187IiwiaW1wb3J0IHsgd2l0aG91dCwga2V5cywgcGF0aCwgcGljayB9IGZyb20gXCJyYW1kYVwiO1xuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IGFzIGNyZWF0ZVJlZGlzQ2xpZW50IH0gZnJvbSBcInJlZGlzXCI7XG5pbXBvcnQgeyB0b1JlZGlzLCBmcm9tUmVkaXMgfSBmcm9tIFwiLi9zZXJpYWxpemVcIjtcblxuY29uc3QgR0VUX0JBVENIX1NJWkUgPSAxMDAwMDtcbmNvbnN0IFBVVF9CQVRDSF9TSVpFID0gMTAwMDA7XG5cbmNvbnN0IG1ldGFSZSA9IC9eX1xcLi4qLztcbmNvbnN0IGVkZ2VSZSA9IC8oXFwuIyQpLztcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUNsaWVudCA9IChHdW4sIC4uLmNvbmZpZykgPT4ge1xuICBjb25zdCByZWRpcyA9IGNyZWF0ZVJlZGlzQ2xpZW50KC4uLmNvbmZpZyk7XG5cbiAgY29uc3QgZ2V0ID0gc291bCA9PlxuICAgIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGlmICghc291bCkgcmV0dXJuIHJlc29sdmUobnVsbCk7XG4gICAgICByZWRpcy5oZ2V0YWxsKHNvdWwsIGZ1bmN0aW9uKGVyciwgcmVzKSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiZ2V0IGVycm9yXCIsIGVycik7XG4gICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzb2x2ZShmcm9tUmVkaXMocmVzKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9KTtcblxuICBjb25zdCByZWFkID0gc291bCA9PlxuICAgIGdldChzb3VsKS50aGVuKHJhd0RhdGEgPT4ge1xuICAgICAgY29uc3QgZGF0YSA9IHJhd0RhdGEgPyB7IC4uLnJhd0RhdGEgfSA6IHJhd0RhdGE7XG5cbiAgICAgIGlmICghR3VuLlNFQSB8fCBzb3VsLmluZGV4T2YoXCJ+XCIpID09PSAtMSkgcmV0dXJuIHJhd0RhdGE7XG4gICAgICB3aXRob3V0KFtcIl9cIl0sIGtleXMoZGF0YSkpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgR3VuLlNFQS52ZXJpZnkoXG4gICAgICAgICAgR3VuLlNFQS5vcHQucGFjayhyYXdEYXRhW2tleV0sIGtleSwgcmF3RGF0YSwgc291bCksXG4gICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgcmVzID0+IChkYXRhW2tleV0gPSBHdW4uU0VBLm9wdC51bnBhY2socmVzLCBrZXksIHJhd0RhdGEpKVxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9KTtcblxuICBjb25zdCBiYXRjaGVkR2V0ID0gKHNvdWwsIGNiKSA9PlxuICAgIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHJlZGlzLmhrZXlzKHNvdWwsIChlcnIsIG5vZGVLZXlzKSA9PiB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiZXJyb3JcIiwgZXJyLnN0YWNrIHx8IGVycik7XG4gICAgICAgICAgcmV0dXJuIHJlamVjdChlcnIpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlS2V5cy5sZW5ndGggPD0gR0VUX0JBVENIX1NJWkUpIHtcbiAgICAgICAgICByZXR1cm4gZ2V0KHNvdWwpLnRoZW4ocmVzID0+IHtcbiAgICAgICAgICAgIGNiKHJlcyk7XG4gICAgICAgICAgICByZXNvbHZlKHJlcyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coXCJnZXQgYmlnIHNvdWxcIiwgc291bCwgbm9kZUtleXMubGVuZ3RoKTtcbiAgICAgICAgY29uc3QgYXR0cktleXMgPSBub2RlS2V5cy5maWx0ZXIoa2V5ID0+ICFrZXkubWF0Y2gobWV0YVJlKSk7XG4gICAgICAgIGNvbnN0IHJlYWRCYXRjaCA9ICgpID0+XG4gICAgICAgICAgbmV3IFByb21pc2UoKG9rLCBmYWlsKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBiYXRjaCA9IGF0dHJLZXlzLnNwbGljZSgwLCBHRVRfQkFUQ0hfU0laRSk7XG5cbiAgICAgICAgICAgIGlmICghYmF0Y2gubGVuZ3RoKSByZXR1cm4gb2sodHJ1ZSk7XG4gICAgICAgICAgICBjb25zdCBiYXRjaE1ldGEgPSBiYXRjaC5tYXAoa2V5ID0+XG4gICAgICAgICAgICAgIGBfLj4uJHtrZXl9YC5yZXBsYWNlKGVkZ2VSZSwgXCJcIilcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIHJldHVybiByZWRpcy5obWdldChzb3VsLCBiYXRjaE1ldGEsIChlcnIsIG1ldGEpID0+IHtcbiAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiaG1nZXQgZXJyXCIsIGVyci5zdGFjayB8fCBlcnIpIHx8IGZhaWwoZXJyKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY29uc3Qgb2JqID0ge1xuICAgICAgICAgICAgICAgIFwiXy4jXCI6IHNvdWxcbiAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICBtZXRhLmZvckVhY2goKHZhbCwgaWR4KSA9PiAob2JqW2JhdGNoTWV0YVtpZHhdXSA9IHZhbCkpO1xuICAgICAgICAgICAgICByZXR1cm4gcmVkaXMuaG1nZXQoc291bCwgYmF0Y2gsIChlcnIsIHJlcykgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJobWdldCBlcnJcIiwgZXJyLnN0YWNrIHx8IGVycikgfHwgZmFpbChlcnIpXG4gICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXMuZm9yRWFjaCgodmFsLCBpZHgpID0+IChvYmpbYmF0Y2hbaWR4XV0gPSB2YWwpKTtcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmcm9tUmVkaXMob2JqKTtcblxuICAgICAgICAgICAgICAgIGNiKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9rKCk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHJlYWROZXh0QmF0Y2ggPSAoKSA9PlxuICAgICAgICAgIHJlYWRCYXRjaCgpLnRoZW4oZG9uZSA9PiAhZG9uZSAmJiByZWFkTmV4dEJhdGNoKTtcblxuICAgICAgICByZXR1cm4gcmVhZE5leHRCYXRjaCgpXG4gICAgICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgICAgIHJlc29sdmUocmVzKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaChyZWplY3QpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgY29uc3Qgd3JpdGUgPSBwdXQgPT5cbiAgICBQcm9taXNlLmFsbChcbiAgICAgIGtleXMocHV0KS5tYXAoXG4gICAgICAgIHNvdWwgPT5cbiAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBub2RlID0gcHV0W3NvdWxdO1xuICAgICAgICAgICAgY29uc3QgbWV0YSA9IHBhdGgoW1wiX1wiLCBcIj5cIl0sIG5vZGUpIHx8IHt9O1xuICAgICAgICAgICAgY29uc3Qgbm9kZUtleXMgPSBrZXlzKG1ldGEpO1xuICAgICAgICAgICAgY29uc3Qgd3JpdGVOZXh0QmF0Y2ggPSAoKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IGJhdGNoID0gbm9kZUtleXMuc3BsaWNlKDAsIFBVVF9CQVRDSF9TSVpFKTtcblxuICAgICAgICAgICAgICBpZiAoIWJhdGNoLmxlbmd0aCkgcmV0dXJuIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgY29uc3QgdXBkYXRlcyA9IHRvUmVkaXMoe1xuICAgICAgICAgICAgICAgIF86IHtcbiAgICAgICAgICAgICAgICAgIFwiI1wiOiBzb3VsLFxuICAgICAgICAgICAgICAgICAgXCI+XCI6IHBpY2soYmF0Y2gsIG1ldGEpXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAuLi5waWNrKGJhdGNoLCBub2RlKVxuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICByZXR1cm4gcmVkaXMuaG1zZXQoc291bCwgdG9SZWRpcyh1cGRhdGVzKSwgZXJyID0+XG4gICAgICAgICAgICAgICAgZXJyID8gcmVqZWN0KGVycikgOiB3cml0ZU5leHRCYXRjaCgpXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXR1cm4gd3JpdGVOZXh0QmF0Y2goKTtcbiAgICAgICAgICB9KVxuICAgICAgKVxuICAgICk7XG5cbiAgcmV0dXJuIHsgZ2V0LCByZWFkLCBiYXRjaGVkR2V0LCB3cml0ZSB9O1xufTtcbiIsImltcG9ydCAqIGFzIHJlY2VpdmVyRm5zIGZyb20gXCIuL3JlY2VpdmVyXCI7XG5leHBvcnQgeyBhdHRhY2hUb0d1biB9IGZyb20gXCIuL2d1blwiO1xuXG5leHBvcnQgY29uc3QgcmVjZWl2ZXIgPSByZWNlaXZlckZucztcbiIsImltcG9ydCB7IHBhdGgsIHByb3AgfSBmcm9tIFwicmFtZGFcIjtcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCIuL2NsaWVudFwiO1xuXG5leHBvcnQgY29uc3QgcmVzcG9uZFRvR2V0cyA9IChHdW4sIHsgc2tpcFZhbGlkYXRpb24gPSB0cnVlIH0gPSB7fSkgPT4gZGIgPT4ge1xuICBjb25zdCByZWRpcyA9IGNyZWF0ZUNsaWVudChHdW4pO1xuXG4gIGRiLm9uSW4obXNnID0+IHtcbiAgICBjb25zdCB7IGZyb20sIGpzb24sIGZyb21DbHVzdGVyIH0gPSBtc2c7XG4gICAgY29uc3Qgc291bCA9IHBhdGgoW1wiZ2V0XCIsIFwiI1wiXSwganNvbik7XG4gICAgY29uc3QgZGVkdXBJZCA9IHByb3AoXCIjXCIsIGpzb24pO1xuXG4gICAgaWYgKCFzb3VsIHx8IGZyb21DbHVzdGVyKSByZXR1cm4gbXNnO1xuICAgIHJldHVybiByZWRpc1xuICAgICAgLmJhdGNoZWRHZXQoc291bCwgcmVzdWx0ID0+IHtcbiAgICAgICAgY29uc3QganNvbiA9IHtcbiAgICAgICAgICBcIiNcIjogZnJvbS5tc2dJZCgpLFxuICAgICAgICAgIFwiQFwiOiBkZWR1cElkLFxuICAgICAgICAgIHB1dDogcmVzdWx0ID8geyBbc291bF06IHJlc3VsdCB9IDogbnVsbFxuICAgICAgICB9O1xuXG4gICAgICAgIGZyb20uc2VuZCh7XG4gICAgICAgICAganNvbixcbiAgICAgICAgICBpZ25vcmVMZWVjaGluZzogdHJ1ZSxcbiAgICAgICAgICBza2lwVmFsaWRhdGlvbjogIXJlc3VsdCB8fCBza2lwVmFsaWRhdGlvblxuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgY29uc3QganNvbiA9IHtcbiAgICAgICAgICBcIiNcIjogZnJvbS5tc2dJZCgpLFxuICAgICAgICAgIFwiQFwiOiBkZWR1cElkLFxuICAgICAgICAgIGVycjogYCR7ZXJyfWBcbiAgICAgICAgfTtcblxuICAgICAgICBmcm9tLnNlbmQoeyBqc29uLCBpZ25vcmVMZWVjaGluZzogdHJ1ZSwgc2tpcFZhbGlkYXRpb24gfSk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oKCkgPT4gbXNnKTtcbiAgfSk7XG5cbiAgcmV0dXJuIGRiO1xufTtcbiIsIm1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fNF9fOyIsImltcG9ydCB7IGtleXMgfSBmcm9tIFwicmFtZGFcIjtcbmNvbnN0IGZsYXR0ZW4gPSByZXF1aXJlKFwiZmxhdFwiKTtcblxuY29uc3QgRklFTERfU0laRV9MSU1JVCA9IDEwMDAwMDtcblxuZnVuY3Rpb24gcG9zdFVuZmxhdHRlbihvYmopIHtcbiAgLy8gVGhpcyBpcyBwcm9iYWJseSBvbmx5IG5lY2Vzc2FyeSBpZiB5b3UgYXJlIHN0dXBpZCBsaWtlIG1lIGFuZCB1c2UgdGhlIGRlZmF1bHQgLiBkZWxpbWl0ZXIgZm9yIGZsYXR0ZW5cbiAgaWYgKCFvYmopIHJldHVybiBvYmo7XG4gIGxldCBhcnJvdyA9IChvYmouXyAmJiBvYmouX1tcIj5cIl0pIHx8IHt9O1xuXG4gIGtleXMoYXJyb3cpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG4gICAgbGV0IHZhbHVlID0gYXJyb3dba2V5XTtcblxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgIGxldCB2YWxLZXlzID0ga2V5cyh2YWx1ZSk7XG4gICAgICBsZXQgcmVtYWluZGVyID0gdmFsS2V5c1swXTtcblxuICAgICAgaWYgKHJlbWFpbmRlcikge1xuICAgICAgICBsZXQgcmVhbEtleSA9IFtrZXksIHZhbEtleXNdLmpvaW4oXCIuXCIpO1xuICAgICAgICBsZXQgcmVhbFZhbHVlID0gdmFsdWVbcmVtYWluZGVyXTtcblxuICAgICAgICBkZWxldGUgYXJyb3dba2V5XTtcbiAgICAgICAgYXJyb3dbcmVhbEtleV0gPSByZWFsVmFsdWU7XG4gICAgICAgIHJlYWxWYWx1ZSA9IChvYmpba2V5XSAmJiBvYmpba2V5XVtyZW1haW5kZXJdKSB8fCBudWxsO1xuICAgICAgICBkZWxldGUgb2JqW2tleV07XG4gICAgICAgIG9ialtyZWFsS2V5XSA9IHJlYWxWYWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuICBrZXlzKG9iaikuZm9yRWFjaChrZXkgPT4ge1xuICAgIGlmIChrZXlbMF0gPT09IFwiLlwiKSBkZWxldGUgW2tleV07XG4gIH0pO1xuICByZXR1cm4gb2JqO1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGZyb21SZWRpcyhvYmopIHtcbiAgaWYgKCFvYmopIHJldHVybiBvYmo7XG4gIGNvbnN0IHNvcnRlZCA9IHt9O1xuXG4gIGtleXMob2JqKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgIGlmIChrZXlbMF0gPT09IFwiLlwiKSBkZWxldGUgb2JqW2tleV07XG5cbiAgICBpZiAob2JqW2tleV0gPT09IFwifE5VTEx8XCIpIHtcbiAgICAgIG9ialtrZXldID0gbnVsbDtcbiAgICB9XG4gICAgaWYgKG9ialtrZXldID09PSBcInxVTkRFRklORUR8XCIpIHtcbiAgICAgIG9ialtrZXldID0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGlmICgvPlxcLi8udGVzdChrZXkpKSB7XG4gICAgICBvYmpba2V5XSA9IHBhcnNlRmxvYXQob2JqW2tleV0sIDEwKSB8fCBvYmpba2V5XTtcbiAgICB9XG4gICAgaWYgKG9ialtrZXldICYmIG9ialtrZXldLmxlbmd0aCA+IEZJRUxEX1NJWkVfTElNSVQpIHtcbiAgICAgIG9ialtrZXldID0gb2JqW2tleV0uc2xpY2UoMCwgRklFTERfU0laRV9MSU1JVCk7XG4gICAgICBjb25zb2xlLmxvZyhcInRydW5jYXRlZFwiLCBrZXkpO1xuICAgIH1cbiAgfSk7XG5cbiAgb2JqID0gcG9zdFVuZmxhdHRlbihmbGF0dGVuLnVuZmxhdHRlbihvYmopKTtcblxuICBPYmplY3Qua2V5cyhvYmopXG4gICAgLnNvcnQoKVxuICAgIC5mb3JFYWNoKGtleSA9PiAoc29ydGVkW2tleV0gPSBvYmpba2V5XSkpO1xuXG4gIHJldHVybiBzb3J0ZWQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0b1JlZGlzKG9iaikge1xuICBpZiAoIW9iaikgcmV0dXJuIG9iajtcbiAgb2JqID0gZmxhdHRlbihvYmopO1xuICBrZXlzKG9iaikuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICBpZiAob2JqW2tleV0gPT09IG51bGwpIHtcbiAgICAgIG9ialtrZXldID0gXCJ8TlVMTHxcIjtcbiAgICB9XG4gICAgaWYgKG9ialtrZXldID09PSB1bmRlZmluZWQpIHtcbiAgICAgIG9ialtrZXldID0gXCJ8VU5ERUZJTkVEfFwiO1xuICAgIH1cbiAgICBpZiAob2JqW2tleV0gJiYgb2JqW2tleV0ubGVuZ3RoID4gRklFTERfU0laRV9MSU1JVCkge1xuICAgICAgb2JqW2tleV0gPSBvYmpba2V5XS5zbGljZSgwLCBGSUVMRF9TSVpFX0xJTUlUKTtcbiAgICAgIGNvbnNvbGUubG9nKFwidHJ1bmNhdGVkIGlucHV0XCIsIGtleSk7XG4gICAgfVxuICAgIGlmIChrZXlbMF0gPT09IFwiLlwiKSBkZWxldGUgb2JqW2tleV07XG4gIH0pO1xuICByZXR1cm4gb2JqO1xufVxuIiwibW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX182X187IiwiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSBcIi4vY2xpZW50XCI7XG5cbmV4cG9ydCBjb25zdCBhdHRhY2hUb0d1biA9IEd1biA9PiBHdW4ub24oXCJjcmVhdGVcIiwgZnVuY3Rpb24oZGIpIHtcbiAgdGhpcy50by5uZXh0KGRiKTtcbiAgY29uc3QgcmVkaXMgPSBHdW4ucmVkaXMgPSBkYi5yZWRpcyA9IGNyZWF0ZUNsaWVudChHdW4pO1xuXG4gIGRiLm9uKFwiZ2V0XCIsIGZ1bmN0aW9uKHJlcXVlc3QpIHtcbiAgICB0aGlzLnRvLm5leHQocmVxdWVzdCk7XG4gICAgY29uc3QgZGVkdXBJZCA9IHJlcXVlc3RbXCIjXCJdO1xuICAgIGNvbnN0IGdldCA9IHJlcXVlc3QuZ2V0O1xuICAgIGNvbnN0IHNvdWwgPSBnZXRbXCIjXCJdO1xuXG4gICAgcmVkaXMuYmF0Y2hlZEdldChzb3VsLCByZXN1bHQgPT4gZGIub24oXCJpblwiLCB7XG4gICAgICBcIkBcIjogZGVkdXBJZCxcbiAgICAgIHB1dDogcmVzdWx0ID8geyBbc291bF06IHJlc3VsdCB9IDogbnVsbCxcbiAgICAgIGVycjogbnVsbFxuICAgIH0pKS5jYXRjaChlcnIgPT5cbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJlcnJvclwiLCBlcnIuc3RhY2sgfHwgZXJyKSB8fFxuICAgICAgZGIub24oXCJpblwiLCB7XG4gICAgICAgIFwiQFwiOiBkZWR1cElkLFxuICAgICAgICBwdXQ6IG51bGwsXG4gICAgICAgIGVyclxuICAgICAgfSlcbiAgICApO1xuICB9KTtcblxuICBkYi5vbihcInB1dFwiLCBmdW5jdGlvbihyZXF1ZXN0KSB7XG4gICAgdGhpcy50by5uZXh0KHJlcXVlc3QpO1xuICAgIGNvbnN0IGRlZHVwSWQgPSByZXF1ZXN0W1wiI1wiXTtcblxuICAgIHJlZGlzLndyaXRlKHJlcXVlc3QucHV0KVxuICAgICAgLnRoZW4oKCkgPT5cbiAgICAgICAgZGIub24oXCJpblwiLCB7XG4gICAgICAgICAgXCJAXCI6IGRlZHVwSWQsXG4gICAgICAgICAgb2s6IHRydWUsXG4gICAgICAgICAgZXJyOiBudWxsXG4gICAgICAgIH0pXG4gICAgICApXG4gICAgICAuY2F0Y2goZXJyID0+XG4gICAgICAgIGRiLm9uKFwiaW5cIiwge1xuICAgICAgICAgIFwiQFwiOiBkZWR1cElkLFxuICAgICAgICAgIG9rOiBmYWxzZSxcbiAgICAgICAgICBlcnI6IGVyclxuICAgICAgICB9KVxuICAgICAgKTtcbiAgfSk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiIn0=